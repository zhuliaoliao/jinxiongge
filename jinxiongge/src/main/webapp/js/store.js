var Handlebars=function(){var a=function(){"use strict";function a(a){this.string=a}var b;return a.prototype.toString=function(){return""+this.string},b=a}(),b=function(a){"use strict";function b(a){return h[a]||"&amp;"}function c(a,b){for(var c in b)Object.prototype.hasOwnProperty.call(b,c)&&(a[c]=b[c])}function d(a){return a instanceof g?a.toString():a||0===a?(a=""+a,j.test(a)?a.replace(i,b):a):""}function e(a){return a||0===a?m(a)&&0===a.length?!0:!1:!0}var f={},g=a,h={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},i=/[&<>"'`]/g,j=/[&<>"'`]/;f.extend=c;var k=Object.prototype.toString;f.toString=k;var l=function(a){return"function"==typeof a};l(/x/)&&(l=function(a){return"function"==typeof a&&"[object Function]"===k.call(a)});var l;f.isFunction=l;var m=Array.isArray||function(a){return a&&"object"==typeof a?"[object Array]"===k.call(a):!1};return f.isArray=m,f.escapeExpression=d,f.isEmpty=e,f}(a),c=function(){"use strict";function a(a,b){var d;b&&b.firstLine&&(d=b.firstLine,a+=" - "+d+":"+b.firstColumn);for(var e=Error.prototype.constructor.call(this,a),f=0;f<c.length;f++)this[c[f]]=e[c[f]];d&&(this.lineNumber=d,this.column=b.firstColumn)}var b,c=["description","fileName","lineNumber","message","name","number","stack"];return a.prototype=new Error,b=a}(),d=function(a,b){"use strict";function c(a,b){this.helpers=a||{},this.partials=b||{},d(this)}function d(a){a.registerHelper("helperMissing",function(a){if(2===arguments.length)return void 0;throw new h("Missing helper: '"+a+"'")}),a.registerHelper("blockHelperMissing",function(b,c){var d=c.inverse||function(){},e=c.fn;return m(b)&&(b=b.call(this)),b===!0?e(this):b===!1||null==b?d(this):l(b)?b.length>0?a.helpers.each(b,c):d(this):e(b)}),a.registerHelper("each",function(a,b){var c,d=b.fn,e=b.inverse,f=0,g="";if(m(a)&&(a=a.call(this)),b.data&&(c=q(b.data)),a&&"object"==typeof a)if(l(a))for(var h=a.length;h>f;f++)c&&(c.index=f,c.first=0===f,c.last=f===a.length-1),g+=d(a[f],{data:c});else for(var i in a)a.hasOwnProperty(i)&&(c&&(c.key=i,c.index=f,c.first=0===f),g+=d(a[i],{data:c}),f++);return 0===f&&(g=e(this)),g}),a.registerHelper("if",function(a,b){return m(a)&&(a=a.call(this)),!b.hash.includeZero&&!a||g.isEmpty(a)?b.inverse(this):b.fn(this)}),a.registerHelper("unless",function(b,c){return a.helpers["if"].call(this,b,{fn:c.inverse,inverse:c.fn,hash:c.hash})}),a.registerHelper("with",function(a,b){return m(a)&&(a=a.call(this)),g.isEmpty(a)?void 0:b.fn(a)}),a.registerHelper("log",function(b,c){var d=c.data&&null!=c.data.level?parseInt(c.data.level,10):1;a.log(d,b)})}function e(a,b){p.log(a,b)}var f={},g=a,h=b,i="1.3.0";f.VERSION=i;var j=4;f.COMPILER_REVISION=j;var k={1:"<= 1.0.rc.2",2:"== 1.0.0-rc.3",3:"== 1.0.0-rc.4",4:">= 1.0.0"};f.REVISION_CHANGES=k;var l=g.isArray,m=g.isFunction,n=g.toString,o="[object Object]";f.HandlebarsEnvironment=c,c.prototype={constructor:c,logger:p,log:e,registerHelper:function(a,b,c){if(n.call(a)===o){if(c||b)throw new h("Arg not supported with multiple helpers");g.extend(this.helpers,a)}else c&&(b.not=c),this.helpers[a]=b},registerPartial:function(a,b){n.call(a)===o?g.extend(this.partials,a):this.partials[a]=b}};var p={methodMap:{0:"debug",1:"info",2:"warn",3:"error"},DEBUG:0,INFO:1,WARN:2,ERROR:3,level:3,log:function(a,b){if(p.level<=a){var c=p.methodMap[a];"undefined"!=typeof console&&console[c]&&console[c].call(console,b)}}};f.logger=p,f.log=e;var q=function(a){var b={};return g.extend(b,a),b};return f.createFrame=q,f}(b,c),e=function(a,b,c){"use strict";function d(a){var b=a&&a[0]||1,c=m;if(b!==c){if(c>b){var d=n[c],e=n[b];throw new l("Template was precompiled with an older version of Handlebars than the current runtime. Please update your precompiler to a newer version ("+d+") or downgrade your runtime to an older version ("+e+").")}throw new l("Template was precompiled with a newer version of Handlebars than the current runtime. Please update your runtime to a newer version ("+a[1]+").")}}function e(a,b){if(!b)throw new l("No environment passed to template");var c=function(a,c,d,e,f,g){var h=b.VM.invokePartial.apply(this,arguments);if(null!=h)return h;if(b.compile){var i={helpers:e,partials:f,data:g};return f[c]=b.compile(a,{data:void 0!==g},b),f[c](d,i)}throw new l("The partial "+c+" could not be compiled when running in runtime-only mode")},d={escapeExpression:k.escapeExpression,invokePartial:c,programs:[],program:function(a,b,c){var d=this.programs[a];return c?d=g(a,b,c):d||(d=this.programs[a]=g(a,b)),d},merge:function(a,b){var c=a||b;return a&&b&&a!==b&&(c={},k.extend(c,b),k.extend(c,a)),c},programWithDepth:b.VM.programWithDepth,noop:b.VM.noop,compilerInfo:null};return function(c,e){e=e||{};var f,g,h=e.partial?e:b;e.partial||(f=e.helpers,g=e.partials);var i=a.call(d,h,c,f,g,e.data);return e.partial||b.VM.checkRevision(d.compilerInfo),i}}function f(a,b,c){var d=Array.prototype.slice.call(arguments,3),e=function(a,e){return e=e||{},b.apply(this,[a,e.data||c].concat(d))};return e.program=a,e.depth=d.length,e}function g(a,b,c){var d=function(a,d){return d=d||{},b(a,d.data||c)};return d.program=a,d.depth=0,d}function h(a,b,c,d,e,f){var g={partial:!0,helpers:d,partials:e,data:f};if(void 0===a)throw new l("The partial "+b+" could not be found");return a instanceof Function?a(c,g):void 0}function i(){return""}var j={},k=a,l=b,m=c.COMPILER_REVISION,n=c.REVISION_CHANGES;return j.checkRevision=d,j.template=e,j.programWithDepth=f,j.program=g,j.invokePartial=h,j.noop=i,j}(b,c,d),f=function(a,b,c,d,e){"use strict";var f,g=a,h=b,i=c,j=d,k=e,l=function(){var a=new g.HandlebarsEnvironment;return j.extend(a,g),a.SafeString=h,a.Exception=i,a.Utils=j,a.VM=k,a.template=function(b){return k.template(b,a)},a},m=l();return m.create=l,f=m}(d,a,c,b,e),g=function(a){"use strict";function b(a){a=a||{},this.firstLine=a.first_line,this.firstColumn=a.first_column,this.lastColumn=a.last_column,this.lastLine=a.last_line}var c,d=a,e={ProgramNode:function(a,c,d,f){var g,h;3===arguments.length?(f=d,d=null):2===arguments.length&&(f=c,c=null),b.call(this,f),this.type="program",this.statements=a,this.strip={},d?(h=d[0],h?(g={first_line:h.firstLine,last_line:h.lastLine,last_column:h.lastColumn,first_column:h.firstColumn},this.inverse=new e.ProgramNode(d,c,g)):this.inverse=new e.ProgramNode(d,c),this.strip.right=c.left):c&&(this.strip.left=c.right)},MustacheNode:function(a,c,d,f,g){if(b.call(this,g),this.type="mustache",this.strip=f,null!=d&&d.charAt){var h=d.charAt(3)||d.charAt(2);this.escaped="{"!==h&&"&"!==h}else this.escaped=!!d;this.sexpr=a instanceof e.SexprNode?a:new e.SexprNode(a,c),this.sexpr.isRoot=!0,this.id=this.sexpr.id,this.params=this.sexpr.params,this.hash=this.sexpr.hash,this.eligibleHelper=this.sexpr.eligibleHelper,this.isHelper=this.sexpr.isHelper},SexprNode:function(a,c,d){b.call(this,d),this.type="sexpr",this.hash=c;var e=this.id=a[0],f=this.params=a.slice(1),g=this.eligibleHelper=e.isSimple;this.isHelper=g&&(f.length||c)},PartialNode:function(a,c,d,e){b.call(this,e),this.type="partial",this.partialName=a,this.context=c,this.strip=d},BlockNode:function(a,c,e,f,g){if(b.call(this,g),a.sexpr.id.original!==f.path.original)throw new d(a.sexpr.id.original+" doesn't match "+f.path.original,this);this.type="block",this.mustache=a,this.program=c,this.inverse=e,this.strip={left:a.strip.left,right:f.strip.right},(c||e).strip.left=a.strip.right,(e||c).strip.right=f.strip.left,e&&!c&&(this.isInverse=!0)},ContentNode:function(a,c){b.call(this,c),this.type="content",this.string=a},HashNode:function(a,c){b.call(this,c),this.type="hash",this.pairs=a},IdNode:function(a,c){b.call(this,c),this.type="ID";for(var e="",f=[],g=0,h=0,i=a.length;i>h;h++){var j=a[h].part;if(e+=(a[h].separator||"")+j,".."===j||"."===j||"this"===j){if(f.length>0)throw new d("Invalid path: "+e,this);".."===j?g++:this.isScoped=!0}else f.push(j)}this.original=e,this.parts=f,this.string=f.join("."),this.depth=g,this.isSimple=1===a.length&&!this.isScoped&&0===g,this.stringModeValue=this.string},PartialNameNode:function(a,c){b.call(this,c),this.type="PARTIAL_NAME",this.name=a.original},DataNode:function(a,c){b.call(this,c),this.type="DATA",this.id=a},StringNode:function(a,c){b.call(this,c),this.type="STRING",this.original=this.string=this.stringModeValue=a},IntegerNode:function(a,c){b.call(this,c),this.type="INTEGER",this.original=this.integer=a,this.stringModeValue=Number(a)},BooleanNode:function(a,c){b.call(this,c),this.type="BOOLEAN",this.bool=a,this.stringModeValue="true"===a},CommentNode:function(a,c){b.call(this,c),this.type="comment",this.comment=a}};return c=e}(c),h=function(){"use strict";var a,b=function(){function a(a,b){return{left:"~"===a.charAt(2),right:"~"===b.charAt(0)||"~"===b.charAt(1)}}function b(){this.yy={}}var c={trace:function(){},yy:{},symbols_:{error:2,root:3,statements:4,EOF:5,program:6,simpleInverse:7,statement:8,openInverse:9,closeBlock:10,openBlock:11,mustache:12,partial:13,CONTENT:14,COMMENT:15,OPEN_BLOCK:16,sexpr:17,CLOSE:18,OPEN_INVERSE:19,OPEN_ENDBLOCK:20,path:21,OPEN:22,OPEN_UNESCAPED:23,CLOSE_UNESCAPED:24,OPEN_PARTIAL:25,partialName:26,partial_option0:27,sexpr_repetition0:28,sexpr_option0:29,dataName:30,param:31,STRING:32,INTEGER:33,BOOLEAN:34,OPEN_SEXPR:35,CLOSE_SEXPR:36,hash:37,hash_repetition_plus0:38,hashSegment:39,ID:40,EQUALS:41,DATA:42,pathSegments:43,SEP:44,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",14:"CONTENT",15:"COMMENT",16:"OPEN_BLOCK",18:"CLOSE",19:"OPEN_INVERSE",20:"OPEN_ENDBLOCK",22:"OPEN",23:"OPEN_UNESCAPED",24:"CLOSE_UNESCAPED",25:"OPEN_PARTIAL",32:"STRING",33:"INTEGER",34:"BOOLEAN",35:"OPEN_SEXPR",36:"CLOSE_SEXPR",40:"ID",41:"EQUALS",42:"DATA",44:"SEP"},productions_:[0,[3,2],[3,1],[6,2],[6,3],[6,2],[6,1],[6,1],[6,0],[4,1],[4,2],[8,3],[8,3],[8,1],[8,1],[8,1],[8,1],[11,3],[9,3],[10,3],[12,3],[12,3],[13,4],[7,2],[17,3],[17,1],[31,1],[31,1],[31,1],[31,1],[31,1],[31,3],[37,1],[39,3],[26,1],[26,1],[26,1],[30,2],[21,1],[43,3],[43,1],[27,0],[27,1],[28,0],[28,2],[29,0],[29,1],[38,1],[38,2]],performAction:function(b,c,d,e,f,g){var h=g.length-1;switch(f){case 1:return new e.ProgramNode(g[h-1],this._$);case 2:return new e.ProgramNode([],this._$);case 3:this.$=new e.ProgramNode([],g[h-1],g[h],this._$);break;case 4:this.$=new e.ProgramNode(g[h-2],g[h-1],g[h],this._$);break;case 5:this.$=new e.ProgramNode(g[h-1],g[h],[],this._$);break;case 6:this.$=new e.ProgramNode(g[h],this._$);break;case 7:this.$=new e.ProgramNode([],this._$);break;case 8:this.$=new e.ProgramNode([],this._$);break;case 9:this.$=[g[h]];break;case 10:g[h-1].push(g[h]),this.$=g[h-1];break;case 11:this.$=new e.BlockNode(g[h-2],g[h-1].inverse,g[h-1],g[h],this._$);break;case 12:this.$=new e.BlockNode(g[h-2],g[h-1],g[h-1].inverse,g[h],this._$);break;case 13:this.$=g[h];break;case 14:this.$=g[h];break;case 15:this.$=new e.ContentNode(g[h],this._$);break;case 16:this.$=new e.CommentNode(g[h],this._$);break;case 17:this.$=new e.MustacheNode(g[h-1],null,g[h-2],a(g[h-2],g[h]),this._$);break;case 18:this.$=new e.MustacheNode(g[h-1],null,g[h-2],a(g[h-2],g[h]),this._$);break;case 19:this.$={path:g[h-1],strip:a(g[h-2],g[h])};break;case 20:this.$=new e.MustacheNode(g[h-1],null,g[h-2],a(g[h-2],g[h]),this._$);break;case 21:this.$=new e.MustacheNode(g[h-1],null,g[h-2],a(g[h-2],g[h]),this._$);break;case 22:this.$=new e.PartialNode(g[h-2],g[h-1],a(g[h-3],g[h]),this._$);break;case 23:this.$=a(g[h-1],g[h]);break;case 24:this.$=new e.SexprNode([g[h-2]].concat(g[h-1]),g[h],this._$);break;case 25:this.$=new e.SexprNode([g[h]],null,this._$);break;case 26:this.$=g[h];break;case 27:this.$=new e.StringNode(g[h],this._$);break;case 28:this.$=new e.IntegerNode(g[h],this._$);break;case 29:this.$=new e.BooleanNode(g[h],this._$);break;case 30:this.$=g[h];break;case 31:g[h-1].isHelper=!0,this.$=g[h-1];break;case 32:this.$=new e.HashNode(g[h],this._$);break;case 33:this.$=[g[h-2],g[h]];break;case 34:this.$=new e.PartialNameNode(g[h],this._$);break;case 35:this.$=new e.PartialNameNode(new e.StringNode(g[h],this._$),this._$);break;case 36:this.$=new e.PartialNameNode(new e.IntegerNode(g[h],this._$));break;case 37:this.$=new e.DataNode(g[h],this._$);break;case 38:this.$=new e.IdNode(g[h],this._$);break;case 39:g[h-2].push({part:g[h],separator:g[h-1]}),this.$=g[h-2];break;case 40:this.$=[{part:g[h]}];break;case 43:this.$=[];break;case 44:g[h-1].push(g[h]);break;case 47:this.$=[g[h]];break;case 48:g[h-1].push(g[h])}},table:[{3:1,4:2,5:[1,3],8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],22:[1,13],23:[1,14],25:[1,15]},{1:[3]},{5:[1,16],8:17,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],22:[1,13],23:[1,14],25:[1,15]},{1:[2,2]},{5:[2,9],14:[2,9],15:[2,9],16:[2,9],19:[2,9],20:[2,9],22:[2,9],23:[2,9],25:[2,9]},{4:20,6:18,7:19,8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,21],20:[2,8],22:[1,13],23:[1,14],25:[1,15]},{4:20,6:22,7:19,8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,21],20:[2,8],22:[1,13],23:[1,14],25:[1,15]},{5:[2,13],14:[2,13],15:[2,13],16:[2,13],19:[2,13],20:[2,13],22:[2,13],23:[2,13],25:[2,13]},{5:[2,14],14:[2,14],15:[2,14],16:[2,14],19:[2,14],20:[2,14],22:[2,14],23:[2,14],25:[2,14]},{5:[2,15],14:[2,15],15:[2,15],16:[2,15],19:[2,15],20:[2,15],22:[2,15],23:[2,15],25:[2,15]},{5:[2,16],14:[2,16],15:[2,16],16:[2,16],19:[2,16],20:[2,16],22:[2,16],23:[2,16],25:[2,16]},{17:23,21:24,30:25,40:[1,28],42:[1,27],43:26},{17:29,21:24,30:25,40:[1,28],42:[1,27],43:26},{17:30,21:24,30:25,40:[1,28],42:[1,27],43:26},{17:31,21:24,30:25,40:[1,28],42:[1,27],43:26},{21:33,26:32,32:[1,34],33:[1,35],40:[1,28],43:26},{1:[2,1]},{5:[2,10],14:[2,10],15:[2,10],16:[2,10],19:[2,10],20:[2,10],22:[2,10],23:[2,10],25:[2,10]},{10:36,20:[1,37]},{4:38,8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],20:[2,7],22:[1,13],23:[1,14],25:[1,15]},{7:39,8:17,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,21],20:[2,6],22:[1,13],23:[1,14],25:[1,15]},{17:23,18:[1,40],21:24,30:25,40:[1,28],42:[1,27],43:26},{10:41,20:[1,37]},{18:[1,42]},{18:[2,43],24:[2,43],28:43,32:[2,43],33:[2,43],34:[2,43],35:[2,43],36:[2,43],40:[2,43],42:[2,43]},{18:[2,25],24:[2,25],36:[2,25]},{18:[2,38],24:[2,38],32:[2,38],33:[2,38],34:[2,38],35:[2,38],36:[2,38],40:[2,38],42:[2,38],44:[1,44]},{21:45,40:[1,28],43:26},{18:[2,40],24:[2,40],32:[2,40],33:[2,40],34:[2,40],35:[2,40],36:[2,40],40:[2,40],42:[2,40],44:[2,40]},{18:[1,46]},{18:[1,47]},{24:[1,48]},{18:[2,41],21:50,27:49,40:[1,28],43:26},{18:[2,34],40:[2,34]},{18:[2,35],40:[2,35]},{18:[2,36],40:[2,36]},{5:[2,11],14:[2,11],15:[2,11],16:[2,11],19:[2,11],20:[2,11],22:[2,11],23:[2,11],25:[2,11]},{21:51,40:[1,28],43:26},{8:17,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],20:[2,3],22:[1,13],23:[1,14],25:[1,15]},{4:52,8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],20:[2,5],22:[1,13],23:[1,14],25:[1,15]},{14:[2,23],15:[2,23],16:[2,23],19:[2,23],20:[2,23],22:[2,23],23:[2,23],25:[2,23]},{5:[2,12],14:[2,12],15:[2,12],16:[2,12],19:[2,12],20:[2,12],22:[2,12],23:[2,12],25:[2,12]},{14:[2,18],15:[2,18],16:[2,18],19:[2,18],20:[2,18],22:[2,18],23:[2,18],25:[2,18]},{18:[2,45],21:56,24:[2,45],29:53,30:60,31:54,32:[1,57],33:[1,58],34:[1,59],35:[1,61],36:[2,45],37:55,38:62,39:63,40:[1,64],42:[1,27],43:26},{40:[1,65]},{18:[2,37],24:[2,37],32:[2,37],33:[2,37],34:[2,37],35:[2,37],36:[2,37],40:[2,37],42:[2,37]},{14:[2,17],15:[2,17],16:[2,17],19:[2,17],20:[2,17],22:[2,17],23:[2,17],25:[2,17]},{5:[2,20],14:[2,20],15:[2,20],16:[2,20],19:[2,20],20:[2,20],22:[2,20],23:[2,20],25:[2,20]},{5:[2,21],14:[2,21],15:[2,21],16:[2,21],19:[2,21],20:[2,21],22:[2,21],23:[2,21],25:[2,21]},{18:[1,66]},{18:[2,42]},{18:[1,67]},{8:17,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],20:[2,4],22:[1,13],23:[1,14],25:[1,15]},{18:[2,24],24:[2,24],36:[2,24]},{18:[2,44],24:[2,44],32:[2,44],33:[2,44],34:[2,44],35:[2,44],36:[2,44],40:[2,44],42:[2,44]},{18:[2,46],24:[2,46],36:[2,46]},{18:[2,26],24:[2,26],32:[2,26],33:[2,26],34:[2,26],35:[2,26],36:[2,26],40:[2,26],42:[2,26]},{18:[2,27],24:[2,27],32:[2,27],33:[2,27],34:[2,27],35:[2,27],36:[2,27],40:[2,27],42:[2,27]},{18:[2,28],24:[2,28],32:[2,28],33:[2,28],34:[2,28],35:[2,28],36:[2,28],40:[2,28],42:[2,28]},{18:[2,29],24:[2,29],32:[2,29],33:[2,29],34:[2,29],35:[2,29],36:[2,29],40:[2,29],42:[2,29]},{18:[2,30],24:[2,30],32:[2,30],33:[2,30],34:[2,30],35:[2,30],36:[2,30],40:[2,30],42:[2,30]},{17:68,21:24,30:25,40:[1,28],42:[1,27],43:26},{18:[2,32],24:[2,32],36:[2,32],39:69,40:[1,70]},{18:[2,47],24:[2,47],36:[2,47],40:[2,47]},{18:[2,40],24:[2,40],32:[2,40],33:[2,40],34:[2,40],35:[2,40],36:[2,40],40:[2,40],41:[1,71],42:[2,40],44:[2,40]},{18:[2,39],24:[2,39],32:[2,39],33:[2,39],34:[2,39],35:[2,39],36:[2,39],40:[2,39],42:[2,39],44:[2,39]},{5:[2,22],14:[2,22],15:[2,22],16:[2,22],19:[2,22],20:[2,22],22:[2,22],23:[2,22],25:[2,22]},{5:[2,19],14:[2,19],15:[2,19],16:[2,19],19:[2,19],20:[2,19],22:[2,19],23:[2,19],25:[2,19]},{36:[1,72]},{18:[2,48],24:[2,48],36:[2,48],40:[2,48]},{41:[1,71]},{21:56,30:60,31:73,32:[1,57],33:[1,58],34:[1,59],35:[1,61],40:[1,28],42:[1,27],43:26},{18:[2,31],24:[2,31],32:[2,31],33:[2,31],34:[2,31],35:[2,31],36:[2,31],40:[2,31],42:[2,31]},{18:[2,33],24:[2,33],36:[2,33],40:[2,33]}],defaultActions:{3:[2,2],16:[2,1],50:[2,42]},parseError:function(a){throw new Error(a)},parse:function(a){function b(){var a;return a=c.lexer.lex()||1,"number"!=typeof a&&(a=c.symbols_[a]||a),a}var c=this,d=[0],e=[null],f=[],g=this.table,h="",i=0,j=0,k=0;this.lexer.setInput(a),this.lexer.yy=this.yy,this.yy.lexer=this.lexer,this.yy.parser=this,"undefined"==typeof this.lexer.yylloc&&(this.lexer.yylloc={});var l=this.lexer.yylloc;f.push(l);var m=this.lexer.options&&this.lexer.options.ranges;"function"==typeof this.yy.parseError&&(this.parseError=this.yy.parseError);for(var n,o,p,q,r,s,t,u,v,w={};;){if(p=d[d.length-1],this.defaultActions[p]?q=this.defaultActions[p]:((null===n||"undefined"==typeof n)&&(n=b()),q=g[p]&&g[p][n]),"undefined"==typeof q||!q.length||!q[0]){var x="";if(!k){v=[];for(s in g[p])this.terminals_[s]&&s>2&&v.push("'"+this.terminals_[s]+"'");x=this.lexer.showPosition?"Parse error on line "+(i+1)+":\n"+this.lexer.showPosition()+"\nExpecting "+v.join(", ")+", got '"+(this.terminals_[n]||n)+"'":"Parse error on line "+(i+1)+": Unexpected "+(1==n?"end of input":"'"+(this.terminals_[n]||n)+"'"),this.parseError(x,{text:this.lexer.match,token:this.terminals_[n]||n,line:this.lexer.yylineno,loc:l,expected:v})}}if(q[0]instanceof Array&&q.length>1)throw new Error("Parse Error: multiple actions possible at state: "+p+", token: "+n);switch(q[0]){case 1:d.push(n),e.push(this.lexer.yytext),f.push(this.lexer.yylloc),d.push(q[1]),n=null,o?(n=o,o=null):(j=this.lexer.yyleng,h=this.lexer.yytext,i=this.lexer.yylineno,l=this.lexer.yylloc,k>0&&k--);break;case 2:if(t=this.productions_[q[1]][1],w.$=e[e.length-t],w._$={first_line:f[f.length-(t||1)].first_line,last_line:f[f.length-1].last_line,first_column:f[f.length-(t||1)].first_column,last_column:f[f.length-1].last_column},m&&(w._$.range=[f[f.length-(t||1)].range[0],f[f.length-1].range[1]]),r=this.performAction.call(w,h,j,i,this.yy,q[1],e,f),"undefined"!=typeof r)return r;t&&(d=d.slice(0,-1*t*2),e=e.slice(0,-1*t),f=f.slice(0,-1*t)),d.push(this.productions_[q[1]][0]),e.push(w.$),f.push(w._$),u=g[d[d.length-2]][d[d.length-1]],d.push(u);break;case 3:return!0}}return!0}},d=function(){var a={EOF:1,parseError:function(a,b){if(!this.yy.parser)throw new Error(a);this.yy.parser.parseError(a,b)},setInput:function(a){return this._input=a,this._more=this._less=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var a=this._input[0];this.yytext+=a,this.yyleng++,this.offset++,this.match+=a,this.matched+=a;var b=a.match(/(?:\r\n?|\n).*/g);return b?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),a},unput:function(a){var b=a.length,c=a.split(/(?:\r\n?|\n)/g);this._input=a+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-b-1),this.offset-=b;var d=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),c.length-1&&(this.yylineno-=c.length-1);var e=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:c?(c.length===d.length?this.yylloc.first_column:0)+d[d.length-c.length].length-c[0].length:this.yylloc.first_column-b},this.options.ranges&&(this.yylloc.range=[e[0],e[0]+this.yyleng-b]),this},more:function(){return this._more=!0,this},less:function(a){this.unput(this.match.slice(a))},pastInput:function(){var a=this.matched.substr(0,this.matched.length-this.match.length);return(a.length>20?"...":"")+a.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var a=this.match;return a.length<20&&(a+=this._input.substr(0,20-a.length)),(a.substr(0,20)+(a.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var a=this.pastInput(),b=new Array(a.length+1).join("-");return a+this.upcomingInput()+"\n"+b+"^"},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var a,b,c,d,e;this._more||(this.yytext="",this.match="");for(var f=this._currentRules(),g=0;g<f.length&&(c=this._input.match(this.rules[f[g]]),!c||b&&!(c[0].length>b[0].length)||(b=c,d=g,this.options.flex));g++);return b?(e=b[0].match(/(?:\r\n?|\n).*/g),e&&(this.yylineno+=e.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:e?e[e.length-1].length-e[e.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+b[0].length},this.yytext+=b[0],this.match+=b[0],this.matches=b,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._input=this._input.slice(b[0].length),this.matched+=b[0],a=this.performAction.call(this,this.yy,this,f[d],this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),a?a:void 0):""===this._input?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var a=this.next();return"undefined"!=typeof a?a:this.lex()},begin:function(a){this.conditionStack.push(a)},popState:function(){return this.conditionStack.pop()},_currentRules:function(){return this.conditions[this.conditionStack[this.conditionStack.length-1]].rules},topState:function(){return this.conditionStack[this.conditionStack.length-2]},pushState:function(a){this.begin(a)}};return a.options={},a.performAction=function(a,b,c,d){function e(a,c){return b.yytext=b.yytext.substr(a,b.yyleng-c)}switch(c){case 0:if("\\\\"===b.yytext.slice(-2)?(e(0,1),this.begin("mu")):"\\"===b.yytext.slice(-1)?(e(0,1),this.begin("emu")):this.begin("mu"),b.yytext)return 14;break;case 1:return 14;case 2:return this.popState(),14;case 3:return e(0,4),this.popState(),15;case 4:return 35;case 5:return 36;case 6:return 25;case 7:return 16;case 8:return 20;case 9:return 19;case 10:return 19;case 11:return 23;case 12:return 22;case 13:this.popState(),this.begin("com");break;case 14:return e(3,5),this.popState(),15;case 15:return 22;case 16:return 41;case 17:return 40;case 18:return 40;case 19:return 44;case 20:break;case 21:return this.popState(),24;case 22:return this.popState(),18;case 23:return b.yytext=e(1,2).replace(/\\"/g,'"'),32;case 24:return b.yytext=e(1,2).replace(/\\'/g,"'"),32;case 25:return 42;case 26:return 34;case 27:return 34;case 28:return 33;case 29:return 40;case 30:return b.yytext=e(1,2),40;case 31:return"INVALID";case 32:return 5}},a.rules=[/^(?:[^\x00]*?(?=(\{\{)))/,/^(?:[^\x00]+)/,/^(?:[^\x00]{2,}?(?=(\{\{|\\\{\{|\\\\\{\{|$)))/,/^(?:[\s\S]*?--\}\})/,/^(?:\()/,/^(?:\))/,/^(?:\{\{(~)?>)/,/^(?:\{\{(~)?#)/,/^(?:\{\{(~)?\/)/,/^(?:\{\{(~)?\^)/,/^(?:\{\{(~)?\s*else\b)/,/^(?:\{\{(~)?\{)/,/^(?:\{\{(~)?&)/,/^(?:\{\{!--)/,/^(?:\{\{![\s\S]*?\}\})/,/^(?:\{\{(~)?)/,/^(?:=)/,/^(?:\.\.)/,/^(?:\.(?=([=~}\s\/.)])))/,/^(?:[\/.])/,/^(?:\s+)/,/^(?:\}(~)?\}\})/,/^(?:(~)?\}\})/,/^(?:"(\\["]|[^"])*")/,/^(?:'(\\[']|[^'])*')/,/^(?:@)/,/^(?:true(?=([~}\s)])))/,/^(?:false(?=([~}\s)])))/,/^(?:-?[0-9]+(?=([~}\s)])))/,/^(?:([^\s!"#%-,\.\/;->@\[-\^`\{-~]+(?=([=~}\s\/.)]))))/,/^(?:\[[^\]]*\])/,/^(?:.)/,/^(?:$)/],a.conditions={mu:{rules:[4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32],inclusive:!1},emu:{rules:[2],inclusive:!1},com:{rules:[3],inclusive:!1},INITIAL:{rules:[0,1,32],inclusive:!0}},a}();return c.lexer=d,b.prototype=c,c.Parser=b,new b}();return a=b}(),i=function(a,b){"use strict";function c(a){return a.constructor===f.ProgramNode?a:(e.yy=f,e.parse(a))}var d={},e=a,f=b;return d.parser=e,d.parse=c,d}(h,g),j=function(a){"use strict";function b(){}function c(a,b,c){if(null==a||"string"!=typeof a&&a.constructor!==c.AST.ProgramNode)throw new f("You must pass a string or Handlebars AST to Handlebars.precompile. You passed "+a);b=b||{},"data"in b||(b.data=!0);var d=c.parse(a),e=(new c.Compiler).compile(d,b);return(new c.JavaScriptCompiler).compile(e,b)}function d(a,b,c){function d(){var d=c.parse(a),e=(new c.Compiler).compile(d,b),f=(new c.JavaScriptCompiler).compile(e,b,void 0,!0);return c.template(f)}if(null==a||"string"!=typeof a&&a.constructor!==c.AST.ProgramNode)throw new f("You must pass a string or Handlebars AST to Handlebars.compile. You passed "+a);b=b||{},"data"in b||(b.data=!0);var e;return function(a,b){return e||(e=d()),e.call(this,a,b)}}var e={},f=a;return e.Compiler=b,b.prototype={compiler:b,disassemble:function(){for(var a,b,c,d=this.opcodes,e=[],f=0,g=d.length;g>f;f++)if(a=d[f],"DECLARE"===a.opcode)e.push("DECLARE "+a.name+"="+a.value);else{b=[];for(var h=0;h<a.args.length;h++)c=a.args[h],"string"==typeof c&&(c='"'+c.replace("\n","\\n")+'"'),b.push(c);e.push(a.opcode+" "+b.join(" "))}return e.join("\n")},equals:function(a){var b=this.opcodes.length;if(a.opcodes.length!==b)return!1;for(var c=0;b>c;c++){var d=this.opcodes[c],e=a.opcodes[c];if(d.opcode!==e.opcode||d.args.length!==e.args.length)return!1;for(var f=0;f<d.args.length;f++)if(d.args[f]!==e.args[f])return!1}if(b=this.children.length,a.children.length!==b)return!1;for(c=0;b>c;c++)if(!this.children[c].equals(a.children[c]))return!1;return!0},guid:0,compile:function(a,b){this.opcodes=[],this.children=[],this.depths={list:[]},this.options=b;var c=this.options.knownHelpers;if(this.options.knownHelpers={helperMissing:!0,blockHelperMissing:!0,each:!0,"if":!0,unless:!0,"with":!0,log:!0},c)for(var d in c)this.options.knownHelpers[d]=c[d];return this.accept(a)},accept:function(a){var b,c=a.strip||{};return c.left&&this.opcode("strip"),b=this[a.type](a),c.right&&this.opcode("strip"),b},program:function(a){for(var b=a.statements,c=0,d=b.length;d>c;c++)this.accept(b[c]);return this.isSimple=1===d,this.depths.list=this.depths.list.sort(function(a,b){return a-b}),this},compileProgram:function(a){var b,c=(new this.compiler).compile(a,this.options),d=this.guid++;this.usePartial=this.usePartial||c.usePartial,this.children[d]=c;for(var e=0,f=c.depths.list.length;f>e;e++)b=c.depths.list[e],2>b||this.addDepth(b-1);return d},block:function(a){var b=a.mustache,c=a.program,d=a.inverse;c&&(c=this.compileProgram(c)),d&&(d=this.compileProgram(d));var e=b.sexpr,f=this.classifySexpr(e);"helper"===f?this.helperSexpr(e,c,d):"simple"===f?(this.simpleSexpr(e),this.opcode("pushProgram",c),this.opcode("pushProgram",d),this.opcode("emptyHash"),this.opcode("blockValue")):(this.ambiguousSexpr(e,c,d),this.opcode("pushProgram",c),this.opcode("pushProgram",d),this.opcode("emptyHash"),this.opcode("ambiguousBlockValue")),this.opcode("append")},hash:function(a){var b,c,d=a.pairs;this.opcode("pushHash");for(var e=0,f=d.length;f>e;e++)b=d[e],c=b[1],this.options.stringParams?(c.depth&&this.addDepth(c.depth),this.opcode("getContext",c.depth||0),this.opcode("pushStringParam",c.stringModeValue,c.type),"sexpr"===c.type&&this.sexpr(c)):this.accept(c),this.opcode("assignToHash",b[0]);this.opcode("popHash")},partial:function(a){var b=a.partialName;this.usePartial=!0,a.context?this.ID(a.context):this.opcode("push","depth0"),this.opcode("invokePartial",b.name),this.opcode("append")},content:function(a){this.opcode("appendContent",a.string)},mustache:function(a){this.sexpr(a.sexpr),this.opcode(a.escaped&&!this.options.noEscape?"appendEscaped":"append")},ambiguousSexpr:function(a,b,c){var d=a.id,e=d.parts[0],f=null!=b||null!=c;this.opcode("getContext",d.depth),this.opcode("pushProgram",b),this.opcode("pushProgram",c),this.opcode("invokeAmbiguous",e,f)},simpleSexpr:function(a){var b=a.id;"DATA"===b.type?this.DATA(b):b.parts.length?this.ID(b):(this.addDepth(b.depth),this.opcode("getContext",b.depth),this.opcode("pushContext")),this.opcode("resolvePossibleLambda")},helperSexpr:function(a,b,c){var d=this.setupFullMustacheParams(a,b,c),e=a.id.parts[0];if(this.options.knownHelpers[e])this.opcode("invokeKnownHelper",d.length,e);else{if(this.options.knownHelpersOnly)throw new f("You specified knownHelpersOnly, but used the unknown helper "+e,a);this.opcode("invokeHelper",d.length,e,a.isRoot)}},sexpr:function(a){var b=this.classifySexpr(a);"simple"===b?this.simpleSexpr(a):"helper"===b?this.helperSexpr(a):this.ambiguousSexpr(a)},ID:function(a){this.addDepth(a.depth),this.opcode("getContext",a.depth);var b=a.parts[0];b?this.opcode("lookupOnContext",a.parts[0]):this.opcode("pushContext");for(var c=1,d=a.parts.length;d>c;c++)this.opcode("lookup",a.parts[c])},DATA:function(a){if(this.options.data=!0,a.id.isScoped||a.id.depth)throw new f("Scoped data references are not supported: "+a.original,a);this.opcode("lookupData");for(var b=a.id.parts,c=0,d=b.length;d>c;c++)this.opcode("lookup",b[c])},STRING:function(a){this.opcode("pushString",a.string)},INTEGER:function(a){this.opcode("pushLiteral",a.integer)},BOOLEAN:function(a){this.opcode("pushLiteral",a.bool)},comment:function(){},opcode:function(a){this.opcodes.push({opcode:a,args:[].slice.call(arguments,1)})},declare:function(a,b){this.opcodes.push({opcode:"DECLARE",name:a,value:b})},addDepth:function(a){0!==a&&(this.depths[a]||(this.depths[a]=!0,this.depths.list.push(a)))},classifySexpr:function(a){var b=a.isHelper,c=a.eligibleHelper,d=this.options;if(c&&!b){var e=a.id.parts[0];d.knownHelpers[e]?b=!0:d.knownHelpersOnly&&(c=!1)}return b?"helper":c?"ambiguous":"simple"},pushParams:function(a){for(var b,c=a.length;c--;)b=a[c],this.options.stringParams?(b.depth&&this.addDepth(b.depth),this.opcode("getContext",b.depth||0),this.opcode("pushStringParam",b.stringModeValue,b.type),"sexpr"===b.type&&this.sexpr(b)):this[b.type](b)},setupFullMustacheParams:function(a,b,c){var d=a.params;return this.pushParams(d),this.opcode("pushProgram",b),this.opcode("pushProgram",c),a.hash?this.hash(a.hash):this.opcode("emptyHash"),d}},e.precompile=c,e.compile=d,e}(c),k=function(a,b){"use strict";function c(a){this.value=a}function d(){}var e,f=a.COMPILER_REVISION,g=a.REVISION_CHANGES,h=a.log,i=b;d.prototype={nameLookup:function(a,b){var c,e;return 0===a.indexOf("depth")&&(c=!0),e=/^[0-9]+$/.test(b)?a+"["+b+"]":d.isValidJavaScriptVariableName(b)?a+"."+b:a+"['"+b+"']",c?"("+a+" && "+e+")":e},compilerInfo:function(){var a=f,b=g[a];return"this.compilerInfo = ["+a+",'"+b+"'];\n"},appendToBuffer:function(a){return this.environment.isSimple?"return "+a+";":{appendToBuffer:!0,content:a,toString:function(){return"buffer += "+a+";"}}},initializeBuffer:function(){return this.quotedString("")},namespace:"Handlebars",compile:function(a,b,c,d){this.environment=a,this.options=b||{},h("debug",this.environment.disassemble()+"\n\n"),this.name=this.environment.name,this.isChild=!!c,this.context=c||{programs:[],environments:[],aliases:{}},this.preamble(),this.stackSlot=0,this.stackVars=[],this.registers={list:[]},this.hashes=[],this.compileStack=[],this.inlineStack=[],this.compileChildren(a,b);
var e,f=a.opcodes;this.i=0;for(var g=f.length;this.i<g;this.i++)e=f[this.i],"DECLARE"===e.opcode?this[e.name]=e.value:this[e.opcode].apply(this,e.args),e.opcode!==this.stripNext&&(this.stripNext=!1);if(this.pushSource(""),this.stackSlot||this.inlineStack.length||this.compileStack.length)throw new i("Compile completed with content left on stack");return this.createFunctionContext(d)},preamble:function(){var a=[];if(this.isChild)a.push("");else{var b=this.namespace,c="helpers = this.merge(helpers, "+b+".helpers);";this.environment.usePartial&&(c=c+" partials = this.merge(partials, "+b+".partials);"),this.options.data&&(c+=" data = data || {};"),a.push(c)}a.push(this.environment.isSimple?"":", buffer = "+this.initializeBuffer()),this.lastContext=0,this.source=a},createFunctionContext:function(a){var b=this.stackVars.concat(this.registers.list);if(b.length>0&&(this.source[1]=this.source[1]+", "+b.join(", ")),!this.isChild)for(var c in this.context.aliases)this.context.aliases.hasOwnProperty(c)&&(this.source[1]=this.source[1]+", "+c+"="+this.context.aliases[c]);this.source[1]&&(this.source[1]="var "+this.source[1].substring(2)+";"),this.isChild||(this.source[1]+="\n"+this.context.programs.join("\n")+"\n"),this.environment.isSimple||this.pushSource("return buffer;");for(var d=this.isChild?["depth0","data"]:["Handlebars","depth0","helpers","partials","data"],e=0,f=this.environment.depths.list.length;f>e;e++)d.push("depth"+this.environment.depths.list[e]);var g=this.mergeSource();if(this.isChild||(g=this.compilerInfo()+g),a)return d.push(g),Function.apply(this,d);var i="function "+(this.name||"")+"("+d.join(",")+") {\n  "+g+"}";return h("debug",i+"\n\n"),i},mergeSource:function(){for(var a,b="",c=0,d=this.source.length;d>c;c++){var e=this.source[c];e.appendToBuffer?a=a?a+"\n    + "+e.content:e.content:(a&&(b+="buffer += "+a+";\n  ",a=void 0),b+=e+"\n  ")}return b},blockValue:function(){this.context.aliases.blockHelperMissing="helpers.blockHelperMissing";var a=["depth0"];this.setupParams(0,a),this.replaceStack(function(b){return a.splice(1,0,b),"blockHelperMissing.call("+a.join(", ")+")"})},ambiguousBlockValue:function(){this.context.aliases.blockHelperMissing="helpers.blockHelperMissing";var a=["depth0"];this.setupParams(0,a);var b=this.topStack();a.splice(1,0,b),this.pushSource("if (!"+this.lastHelper+") { "+b+" = blockHelperMissing.call("+a.join(", ")+"); }")},appendContent:function(a){this.pendingContent&&(a=this.pendingContent+a),this.stripNext&&(a=a.replace(/^\s+/,"")),this.pendingContent=a},strip:function(){this.pendingContent&&(this.pendingContent=this.pendingContent.replace(/\s+$/,"")),this.stripNext="strip"},append:function(){this.flushInline();var a=this.popStack();this.pushSource("if("+a+" || "+a+" === 0) { "+this.appendToBuffer(a)+" }"),this.environment.isSimple&&this.pushSource("else { "+this.appendToBuffer("''")+" }")},appendEscaped:function(){this.context.aliases.escapeExpression="this.escapeExpression",this.pushSource(this.appendToBuffer("escapeExpression("+this.popStack()+")"))},getContext:function(a){this.lastContext!==a&&(this.lastContext=a)},lookupOnContext:function(a){this.push(this.nameLookup("depth"+this.lastContext,a,"context"))},pushContext:function(){this.pushStackLiteral("depth"+this.lastContext)},resolvePossibleLambda:function(){this.context.aliases.functionType='"function"',this.replaceStack(function(a){return"typeof "+a+" === functionType ? "+a+".apply(depth0) : "+a})},lookup:function(a){this.replaceStack(function(b){return b+" == null || "+b+" === false ? "+b+" : "+this.nameLookup(b,a,"context")})},lookupData:function(){this.pushStackLiteral("data")},pushStringParam:function(a,b){this.pushStackLiteral("depth"+this.lastContext),this.pushString(b),"sexpr"!==b&&("string"==typeof a?this.pushString(a):this.pushStackLiteral(a))},emptyHash:function(){this.pushStackLiteral("{}"),this.options.stringParams&&(this.push("{}"),this.push("{}"))},pushHash:function(){this.hash&&this.hashes.push(this.hash),this.hash={values:[],types:[],contexts:[]}},popHash:function(){var a=this.hash;this.hash=this.hashes.pop(),this.options.stringParams&&(this.push("{"+a.contexts.join(",")+"}"),this.push("{"+a.types.join(",")+"}")),this.push("{\n    "+a.values.join(",\n    ")+"\n  }")},pushString:function(a){this.pushStackLiteral(this.quotedString(a))},push:function(a){return this.inlineStack.push(a),a},pushLiteral:function(a){this.pushStackLiteral(a)},pushProgram:function(a){this.pushStackLiteral(null!=a?this.programExpression(a):null)},invokeHelper:function(a,b,c){this.context.aliases.helperMissing="helpers.helperMissing",this.useRegister("helper");var d=this.lastHelper=this.setupHelper(a,b,!0),e=this.nameLookup("depth"+this.lastContext,b,"context"),f="helper = "+d.name+" || "+e;d.paramsInit&&(f+=","+d.paramsInit),this.push("("+f+",helper ? helper.call("+d.callParams+") : helperMissing.call("+d.helperMissingParams+"))"),c||this.flushInline()},invokeKnownHelper:function(a,b){var c=this.setupHelper(a,b);this.push(c.name+".call("+c.callParams+")")},invokeAmbiguous:function(a,b){this.context.aliases.functionType='"function"',this.useRegister("helper"),this.emptyHash();var c=this.setupHelper(0,a,b),d=this.lastHelper=this.nameLookup("helpers",a,"helper"),e=this.nameLookup("depth"+this.lastContext,a,"context"),f=this.nextStack();c.paramsInit&&this.pushSource(c.paramsInit),this.pushSource("if (helper = "+d+") { "+f+" = helper.call("+c.callParams+"); }"),this.pushSource("else { helper = "+e+"; "+f+" = typeof helper === functionType ? helper.call("+c.callParams+") : helper; }")},invokePartial:function(a){var b=[this.nameLookup("partials",a,"partial"),"'"+a+"'",this.popStack(),"helpers","partials"];this.options.data&&b.push("data"),this.context.aliases.self="this",this.push("self.invokePartial("+b.join(", ")+")")},assignToHash:function(a){var b,c,d=this.popStack();this.options.stringParams&&(c=this.popStack(),b=this.popStack());var e=this.hash;b&&e.contexts.push("'"+a+"': "+b),c&&e.types.push("'"+a+"': "+c),e.values.push("'"+a+"': ("+d+")")},compiler:d,compileChildren:function(a,b){for(var c,d,e=a.children,f=0,g=e.length;g>f;f++){c=e[f],d=new this.compiler;var h=this.matchExistingProgram(c);null==h?(this.context.programs.push(""),h=this.context.programs.length,c.index=h,c.name="program"+h,this.context.programs[h]=d.compile(c,b,this.context),this.context.environments[h]=c):(c.index=h,c.name="program"+h)}},matchExistingProgram:function(a){for(var b=0,c=this.context.environments.length;c>b;b++){var d=this.context.environments[b];if(d&&d.equals(a))return b}},programExpression:function(a){if(this.context.aliases.self="this",null==a)return"self.noop";for(var b,c=this.environment.children[a],d=c.depths.list,e=[c.index,c.name,"data"],f=0,g=d.length;g>f;f++)b=d[f],e.push(1===b?"depth0":"depth"+(b-1));return(0===d.length?"self.program(":"self.programWithDepth(")+e.join(", ")+")"},register:function(a,b){this.useRegister(a),this.pushSource(a+" = "+b+";")},useRegister:function(a){this.registers[a]||(this.registers[a]=!0,this.registers.list.push(a))},pushStackLiteral:function(a){return this.push(new c(a))},pushSource:function(a){this.pendingContent&&(this.source.push(this.appendToBuffer(this.quotedString(this.pendingContent))),this.pendingContent=void 0),a&&this.source.push(a)},pushStack:function(a){this.flushInline();var b=this.incrStack();return a&&this.pushSource(b+" = "+a+";"),this.compileStack.push(b),b},replaceStack:function(a){var b,d,e,f="",g=this.isInline();if(g){var h=this.popStack(!0);if(h instanceof c)b=h.value,e=!0;else{d=!this.stackSlot;var i=d?this.incrStack():this.topStackName();f="("+this.push(i)+" = "+h+"),",b=this.topStack()}}else b=this.topStack();var j=a.call(this,b);return g?(e||this.popStack(),d&&this.stackSlot--,this.push("("+f+j+")")):(/^stack/.test(b)||(b=this.nextStack()),this.pushSource(b+" = ("+f+j+");")),b},nextStack:function(){return this.pushStack()},incrStack:function(){return this.stackSlot++,this.stackSlot>this.stackVars.length&&this.stackVars.push("stack"+this.stackSlot),this.topStackName()},topStackName:function(){return"stack"+this.stackSlot},flushInline:function(){var a=this.inlineStack;if(a.length){this.inlineStack=[];for(var b=0,d=a.length;d>b;b++){var e=a[b];e instanceof c?this.compileStack.push(e):this.pushStack(e)}}},isInline:function(){return this.inlineStack.length},popStack:function(a){var b=this.isInline(),d=(b?this.inlineStack:this.compileStack).pop();if(!a&&d instanceof c)return d.value;if(!b){if(!this.stackSlot)throw new i("Invalid stack pop");this.stackSlot--}return d},topStack:function(a){var b=this.isInline()?this.inlineStack:this.compileStack,d=b[b.length-1];return!a&&d instanceof c?d.value:d},quotedString:function(a){return'"'+a.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")+'"'},setupHelper:function(a,b,c){var d=[],e=this.setupParams(a,d,c),f=this.nameLookup("helpers",b,"helper");return{params:d,paramsInit:e,name:f,callParams:["depth0"].concat(d).join(", "),helperMissingParams:c&&["depth0",this.quotedString(b)].concat(d).join(", ")}},setupOptions:function(a,b){var c,d,e,f=[],g=[],h=[];f.push("hash:"+this.popStack()),this.options.stringParams&&(f.push("hashTypes:"+this.popStack()),f.push("hashContexts:"+this.popStack())),d=this.popStack(),e=this.popStack(),(e||d)&&(e||(this.context.aliases.self="this",e="self.noop"),d||(this.context.aliases.self="this",d="self.noop"),f.push("inverse:"+d),f.push("fn:"+e));for(var i=0;a>i;i++)c=this.popStack(),b.push(c),this.options.stringParams&&(h.push(this.popStack()),g.push(this.popStack()));return this.options.stringParams&&(f.push("contexts:["+g.join(",")+"]"),f.push("types:["+h.join(",")+"]")),this.options.data&&f.push("data:data"),f},setupParams:function(a,b,c){var d="{"+this.setupOptions(a,b).join(",")+"}";return c?(this.useRegister("options"),b.push("options"),"options="+d):(b.push(d),"")}};for(var j="break else new var case finally return void catch for switch while continue function this with default if throw delete in try do instanceof typeof abstract enum int short boolean export interface static byte extends long super char final native synchronized class float package throws const goto private transient debugger implements protected volatile double import public let yield".split(" "),k=d.RESERVED_WORDS={},l=0,m=j.length;m>l;l++)k[j[l]]=!0;return d.isValidJavaScriptVariableName=function(a){return!d.RESERVED_WORDS[a]&&/^[a-zA-Z_$][0-9a-zA-Z_$]*$/.test(a)?!0:!1},e=d}(d,c),l=function(a,b,c,d,e){"use strict";var f,g=a,h=b,i=c.parser,j=c.parse,k=d.Compiler,l=d.compile,m=d.precompile,n=e,o=g.create,p=function(){var a=o();return a.compile=function(b,c){return l(b,c,a)},a.precompile=function(b,c){return m(b,c,a)},a.AST=h,a.Compiler=k,a.JavaScriptCompiler=n,a.Parser=i,a.parse=j,a};return g=p(),g.create=p,f=g}(f,g,i,j,k);return l}();(function(){var a=this,b=a._,c={},d=Array.prototype,e=Object.prototype,f=Function.prototype,g=d.push,h=d.slice,i=d.concat,j=e.toString,k=e.hasOwnProperty,l=d.forEach,m=d.map,n=d.reduce,o=d.reduceRight,p=d.filter,q=d.every,r=d.some,s=d.indexOf,t=d.lastIndexOf,u=Array.isArray,v=Object.keys,w=f.bind,x=function(a){return a instanceof x?a:this instanceof x?void(this._wrapped=a):new x(a)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=x),exports._=x):a._=x,x.VERSION="1.6.0";var y=x.each=x.forEach=function(a,b,d){if(null==a)return a;if(l&&a.forEach===l)a.forEach(b,d);else if(a.length===+a.length){for(var e=0,f=a.length;f>e;e++)if(b.call(d,a[e],e,a)===c)return}else for(var g=x.keys(a),e=0,f=g.length;f>e;e++)if(b.call(d,a[g[e]],g[e],a)===c)return;return a};x.map=x.collect=function(a,b,c){var d=[];return null==a?d:m&&a.map===m?a.map(b,c):(y(a,function(a,e,f){d.push(b.call(c,a,e,f))}),d)};var z="Reduce of empty array with no initial value";x.reduce=x.foldl=x.inject=function(a,b,c,d){var e=arguments.length>2;if(null==a&&(a=[]),n&&a.reduce===n)return d&&(b=x.bind(b,d)),e?a.reduce(b,c):a.reduce(b);if(y(a,function(a,f,g){e?c=b.call(d,c,a,f,g):(c=a,e=!0)}),!e)throw new TypeError(z);return c},x.reduceRight=x.foldr=function(a,b,c,d){var e=arguments.length>2;if(null==a&&(a=[]),o&&a.reduceRight===o)return d&&(b=x.bind(b,d)),e?a.reduceRight(b,c):a.reduceRight(b);var f=a.length;if(f!==+f){var g=x.keys(a);f=g.length}if(y(a,function(h,i,j){i=g?g[--f]:--f,e?c=b.call(d,c,a[i],i,j):(c=a[i],e=!0)}),!e)throw new TypeError(z);return c},x.find=x.detect=function(a,b,c){var d;return A(a,function(a,e,f){return b.call(c,a,e,f)?(d=a,!0):void 0}),d},x.filter=x.select=function(a,b,c){var d=[];return null==a?d:p&&a.filter===p?a.filter(b,c):(y(a,function(a,e,f){b.call(c,a,e,f)&&d.push(a)}),d)},x.reject=function(a,b,c){return x.filter(a,function(a,d,e){return!b.call(c,a,d,e)},c)},x.every=x.all=function(a,b,d){b||(b=x.identity);var e=!0;return null==a?e:q&&a.every===q?a.every(b,d):(y(a,function(a,f,g){return(e=e&&b.call(d,a,f,g))?void 0:c}),!!e)};var A=x.some=x.any=function(a,b,d){b||(b=x.identity);var e=!1;return null==a?e:r&&a.some===r?a.some(b,d):(y(a,function(a,f,g){return e||(e=b.call(d,a,f,g))?c:void 0}),!!e)};x.contains=x.include=function(a,b){return null==a?!1:s&&a.indexOf===s?-1!=a.indexOf(b):A(a,function(a){return a===b})},x.invoke=function(a,b){var c=h.call(arguments,2),d=x.isFunction(b);return x.map(a,function(a){return(d?b:a[b]).apply(a,c)})},x.pluck=function(a,b){return x.map(a,x.property(b))},x.where=function(a,b){return x.filter(a,x.matches(b))},x.findWhere=function(a,b){return x.find(a,x.matches(b))},x.max=function(a,b,c){if(!b&&x.isArray(a)&&a[0]===+a[0]&&a.length<65535)return Math.max.apply(Math,a);var d=-1/0,e=-1/0;return y(a,function(a,f,g){var h=b?b.call(c,a,f,g):a;h>e&&(d=a,e=h)}),d},x.min=function(a,b,c){if(!b&&x.isArray(a)&&a[0]===+a[0]&&a.length<65535)return Math.min.apply(Math,a);var d=1/0,e=1/0;return y(a,function(a,f,g){var h=b?b.call(c,a,f,g):a;e>h&&(d=a,e=h)}),d},x.shuffle=function(a){var b,c=0,d=[];return y(a,function(a){b=x.random(c++),d[c-1]=d[b],d[b]=a}),d},x.sample=function(a,b,c){return null==b||c?(a.length!==+a.length&&(a=x.values(a)),a[x.random(a.length-1)]):x.shuffle(a).slice(0,Math.max(0,b))};var B=function(a){return null==a?x.identity:x.isFunction(a)?a:x.property(a)};x.sortBy=function(a,b,c){return b=B(b),x.pluck(x.map(a,function(a,d,e){return{value:a,index:d,criteria:b.call(c,a,d,e)}}).sort(function(a,b){var c=a.criteria,d=b.criteria;if(c!==d){if(c>d||void 0===c)return 1;if(d>c||void 0===d)return-1}return a.index-b.index}),"value")};var C=function(a){return function(b,c,d){var e={};return c=B(c),y(b,function(f,g){var h=c.call(d,f,g,b);a(e,h,f)}),e}};x.groupBy=C(function(a,b,c){x.has(a,b)?a[b].push(c):a[b]=[c]}),x.indexBy=C(function(a,b,c){a[b]=c}),x.countBy=C(function(a,b){x.has(a,b)?a[b]++:a[b]=1}),x.sortedIndex=function(a,b,c,d){c=B(c);for(var e=c.call(d,b),f=0,g=a.length;g>f;){var h=f+g>>>1;c.call(d,a[h])<e?f=h+1:g=h}return f},x.toArray=function(a){return a?x.isArray(a)?h.call(a):a.length===+a.length?x.map(a,x.identity):x.values(a):[]},x.size=function(a){return null==a?0:a.length===+a.length?a.length:x.keys(a).length},x.first=x.head=x.take=function(a,b,c){return null==a?void 0:null==b||c?a[0]:0>b?[]:h.call(a,0,b)},x.initial=function(a,b,c){return h.call(a,0,a.length-(null==b||c?1:b))},x.last=function(a,b,c){return null==a?void 0:null==b||c?a[a.length-1]:h.call(a,Math.max(a.length-b,0))},x.rest=x.tail=x.drop=function(a,b,c){return h.call(a,null==b||c?1:b)},x.compact=function(a){return x.filter(a,x.identity)};var D=function(a,b,c){return b&&x.every(a,x.isArray)?i.apply(c,a):(y(a,function(a){x.isArray(a)||x.isArguments(a)?b?g.apply(c,a):D(a,b,c):c.push(a)}),c)};x.flatten=function(a,b){return D(a,b,[])},x.without=function(a){return x.difference(a,h.call(arguments,1))},x.partition=function(a,b,c){b=B(b);var d=[],e=[];return y(a,function(a){(b.call(c,a)?d:e).push(a)}),[d,e]},x.uniq=x.unique=function(a,b,c,d){x.isFunction(b)&&(d=c,c=b,b=!1);var e=c?x.map(a,c,d):a,f=[],g=[];return y(e,function(c,d){(b?d&&g[g.length-1]===c:x.contains(g,c))||(g.push(c),f.push(a[d]))}),f},x.union=function(){return x.uniq(x.flatten(arguments,!0))},x.intersection=function(a){var b=h.call(arguments,1);return x.filter(x.uniq(a),function(a){return x.every(b,function(b){return x.contains(b,a)})})},x.difference=function(a){var b=i.apply(d,h.call(arguments,1));return x.filter(a,function(a){return!x.contains(b,a)})},x.zip=function(){for(var a=x.max(x.pluck(arguments,"length").concat(0)),b=new Array(a),c=0;a>c;c++)b[c]=x.pluck(arguments,""+c);return b},x.object=function(a,b){if(null==a)return{};for(var c={},d=0,e=a.length;e>d;d++)b?c[a[d]]=b[d]:c[a[d][0]]=a[d][1];return c},x.indexOf=function(a,b,c){if(null==a)return-1;var d=0,e=a.length;if(c){if("number"!=typeof c)return d=x.sortedIndex(a,b),a[d]===b?d:-1;d=0>c?Math.max(0,e+c):c}if(s&&a.indexOf===s)return a.indexOf(b,c);for(;e>d;d++)if(a[d]===b)return d;return-1},x.lastIndexOf=function(a,b,c){if(null==a)return-1;var d=null!=c;if(t&&a.lastIndexOf===t)return d?a.lastIndexOf(b,c):a.lastIndexOf(b);for(var e=d?c:a.length;e--;)if(a[e]===b)return e;return-1},x.range=function(a,b,c){arguments.length<=1&&(b=a||0,a=0),c=arguments[2]||1;for(var d=Math.max(Math.ceil((b-a)/c),0),e=0,f=new Array(d);d>e;)f[e++]=a,a+=c;return f};var E=function(){};x.bind=function(a,b){var c,d;if(w&&a.bind===w)return w.apply(a,h.call(arguments,1));if(!x.isFunction(a))throw new TypeError;return c=h.call(arguments,2),d=function(){if(!(this instanceof d))return a.apply(b,c.concat(h.call(arguments)));E.prototype=a.prototype;var e=new E;E.prototype=null;var f=a.apply(e,c.concat(h.call(arguments)));return Object(f)===f?f:e}},x.partial=function(a){var b=h.call(arguments,1);return function(){for(var c=0,d=b.slice(),e=0,f=d.length;f>e;e++)d[e]===x&&(d[e]=arguments[c++]);for(;c<arguments.length;)d.push(arguments[c++]);return a.apply(this,d)}},x.bindAll=function(a){var b=h.call(arguments,1);if(0===b.length)throw new Error("bindAll must be passed function names");return y(b,function(b){a[b]=x.bind(a[b],a)}),a},x.memoize=function(a,b){var c={};return b||(b=x.identity),function(){var d=b.apply(this,arguments);return x.has(c,d)?c[d]:c[d]=a.apply(this,arguments)}},x.delay=function(a,b){var c=h.call(arguments,2);return setTimeout(function(){return a.apply(null,c)},b)},x.defer=function(a){return x.delay.apply(x,[a,1].concat(h.call(arguments,1)))},x.throttle=function(a,b,c){var d,e,f,g=null,h=0;c||(c={});var i=function(){h=c.leading===!1?0:x.now(),g=null,f=a.apply(d,e),d=e=null};return function(){var j=x.now();h||c.leading!==!1||(h=j);var k=b-(j-h);return d=this,e=arguments,0>=k?(clearTimeout(g),g=null,h=j,f=a.apply(d,e),d=e=null):g||c.trailing===!1||(g=setTimeout(i,k)),f}},x.debounce=function(a,b,c){var d,e,f,g,h,i=function(){var j=x.now()-g;b>j?d=setTimeout(i,b-j):(d=null,c||(h=a.apply(f,e),f=e=null))};return function(){f=this,e=arguments,g=x.now();var j=c&&!d;return d||(d=setTimeout(i,b)),j&&(h=a.apply(f,e),f=e=null),h}},x.once=function(a){var b,c=!1;return function(){return c?b:(c=!0,b=a.apply(this,arguments),a=null,b)}},x.wrap=function(a,b){return x.partial(b,a)},x.compose=function(){var a=arguments;return function(){for(var b=arguments,c=a.length-1;c>=0;c--)b=[a[c].apply(this,b)];return b[0]}},x.after=function(a,b){return function(){return--a<1?b.apply(this,arguments):void 0}},x.keys=function(a){if(!x.isObject(a))return[];if(v)return v(a);var b=[];for(var c in a)x.has(a,c)&&b.push(c);return b},x.values=function(a){for(var b=x.keys(a),c=b.length,d=new Array(c),e=0;c>e;e++)d[e]=a[b[e]];return d},x.pairs=function(a){for(var b=x.keys(a),c=b.length,d=new Array(c),e=0;c>e;e++)d[e]=[b[e],a[b[e]]];return d},x.invert=function(a){for(var b={},c=x.keys(a),d=0,e=c.length;e>d;d++)b[a[c[d]]]=c[d];return b},x.functions=x.methods=function(a){var b=[];for(var c in a)x.isFunction(a[c])&&b.push(c);return b.sort()},x.extend=function(a){return y(h.call(arguments,1),function(b){if(b)for(var c in b)a[c]=b[c]}),a},x.pick=function(a){var b={},c=i.apply(d,h.call(arguments,1));return y(c,function(c){c in a&&(b[c]=a[c])}),b},x.omit=function(a){var b={},c=i.apply(d,h.call(arguments,1));for(var e in a)x.contains(c,e)||(b[e]=a[e]);return b},x.defaults=function(a){return y(h.call(arguments,1),function(b){if(b)for(var c in b)void 0===a[c]&&(a[c]=b[c])}),a},x.clone=function(a){return x.isObject(a)?x.isArray(a)?a.slice():x.extend({},a):a},x.tap=function(a,b){return b(a),a};var F=function(a,b,c,d){if(a===b)return 0!==a||1/a==1/b;if(null==a||null==b)return a===b;a instanceof x&&(a=a._wrapped),b instanceof x&&(b=b._wrapped);var e=j.call(a);if(e!=j.call(b))return!1;switch(e){case"[object String]":return a==String(b);case"[object Number]":return a!=+a?b!=+b:0==a?1/a==1/b:a==+b;case"[object Date]":case"[object Boolean]":return+a==+b;case"[object RegExp]":return a.source==b.source&&a.global==b.global&&a.multiline==b.multiline&&a.ignoreCase==b.ignoreCase}if("object"!=typeof a||"object"!=typeof b)return!1;for(var f=c.length;f--;)if(c[f]==a)return d[f]==b;var g=a.constructor,h=b.constructor;if(g!==h&&!(x.isFunction(g)&&g instanceof g&&x.isFunction(h)&&h instanceof h)&&"constructor"in a&&"constructor"in b)return!1;c.push(a),d.push(b);var i=0,k=!0;if("[object Array]"==e){if(i=a.length,k=i==b.length)for(;i--&&(k=F(a[i],b[i],c,d)););}else{for(var l in a)if(x.has(a,l)&&(i++,!(k=x.has(b,l)&&F(a[l],b[l],c,d))))break;if(k){for(l in b)if(x.has(b,l)&&!i--)break;k=!i}}return c.pop(),d.pop(),k};x.isEqual=function(a,b){return F(a,b,[],[])},x.isEmpty=function(a){if(null==a)return!0;if(x.isArray(a)||x.isString(a))return 0===a.length;for(var b in a)if(x.has(a,b))return!1;return!0},x.isElement=function(a){return!(!a||1!==a.nodeType)},x.isArray=u||function(a){return"[object Array]"==j.call(a)},x.isObject=function(a){return a===Object(a)},y(["Arguments","Function","String","Number","Date","RegExp"],function(a){x["is"+a]=function(b){return j.call(b)=="[object "+a+"]"}}),x.isArguments(arguments)||(x.isArguments=function(a){return!(!a||!x.has(a,"callee"))}),"function"!=typeof/./&&(x.isFunction=function(a){return"function"==typeof a}),x.isFinite=function(a){return isFinite(a)&&!isNaN(parseFloat(a))},x.isNaN=function(a){return x.isNumber(a)&&a!=+a},x.isBoolean=function(a){return a===!0||a===!1||"[object Boolean]"==j.call(a)},x.isNull=function(a){return null===a},x.isUndefined=function(a){return void 0===a},x.has=function(a,b){return k.call(a,b)},x.noConflict=function(){return a._=b,this},x.identity=function(a){return a},x.constant=function(a){return function(){return a}},x.property=function(a){return function(b){return b[a]}},x.matches=function(a){return function(b){if(b===a)return!0;for(var c in a)if(a[c]!==b[c])return!1;return!0}},x.times=function(a,b,c){for(var d=Array(Math.max(0,a)),e=0;a>e;e++)d[e]=b.call(c,e);return d},x.random=function(a,b){return null==b&&(b=a,a=0),a+Math.floor(Math.random()*(b-a+1))},x.now=Date.now||function(){return(new Date).getTime()};var G={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"}};G.unescape=x.invert(G.escape);var H={escape:new RegExp("["+x.keys(G.escape).join("")+"]","g"),unescape:new RegExp("("+x.keys(G.unescape).join("|")+")","g")};x.each(["escape","unescape"],function(a){x[a]=function(b){return null==b?"":(""+b).replace(H[a],function(b){return G[a][b]})}}),x.result=function(a,b){if(null==a)return void 0;var c=a[b];return x.isFunction(c)?c.call(a):c},x.mixin=function(a){y(x.functions(a),function(b){var c=x[b]=a[b];x.prototype[b]=function(){var a=[this._wrapped];return g.apply(a,arguments),M.call(this,c.apply(x,a))}})};var I=0;x.uniqueId=function(a){var b=++I+"";return a?a+b:b},x.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var J=/(.)^/,K={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},L=/\\|'|\r|\n|\t|\u2028|\u2029/g;x.template=function(a,b,c){var d;c=x.defaults({},c,x.templateSettings);var e=new RegExp([(c.escape||J).source,(c.interpolate||J).source,(c.evaluate||J).source].join("|")+"|$","g"),f=0,g="__p+='";a.replace(e,function(b,c,d,e,h){return g+=a.slice(f,h).replace(L,function(a){return"\\"+K[a]}),c&&(g+="'+\n((__t=("+c+"))==null?'':_.escape(__t))+\n'"),d&&(g+="'+\n((__t=("+d+"))==null?'':__t)+\n'"),e&&(g+="';\n"+e+"\n__p+='"),f=h+b.length,b}),g+="';\n",c.variable||(g="with(obj||{}){\n"+g+"}\n"),g="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+g+"return __p;\n";try{d=new Function(c.variable||"obj","_",g)}catch(h){throw h.source=g,h}if(b)return d(b,x);var i=function(a){return d.call(this,a,x)};return i.source="function("+(c.variable||"obj")+"){\n"+g+"}",i},x.chain=function(a){return x(a).chain()};var M=function(a){return this._chain?x(a).chain():a};x.mixin(x),y(["pop","push","reverse","shift","sort","splice","unshift"],function(a){var b=d[a];x.prototype[a]=function(){var c=this._wrapped;return b.apply(c,arguments),"shift"!=a&&"splice"!=a||0!==c.length||delete c[0],M.call(this,c)}}),y(["concat","join","slice"],function(a){var b=d[a];x.prototype[a]=function(){return M.call(this,b.apply(this._wrapped,arguments))}}),x.extend(x.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}}),"function"==typeof define&&define.amd&&define("underscore",[],function(){return x})}).call(this),function(a,b){if("function"==typeof define&&define.amd)define(["underscore","jquery","exports"],function(c,d,e){a.Backbone=b(a,e,c,d)});else if("undefined"!=typeof exports){var c=require("underscore");b(a,exports,c)}else a.Backbone=b(a,{},a._,a.jQuery||a.Zepto||a.ender||a.$)}(this,function(a,b,c,d){var e=a.Backbone,f=[],g=f.slice;b.VERSION="1.1.2",b.$=d,b.noConflict=function(){return a.Backbone=e,this},b.emulateHTTP=!1,b.emulateJSON=!1;var h=b.Events={on:function(a,b,c){if(!j(this,"on",a,[b,c])||!b)return this;this._events||(this._events={});var d=this._events[a]||(this._events[a]=[]);return d.push({callback:b,context:c,ctx:c||this}),this},once:function(a,b,d){if(!j(this,"once",a,[b,d])||!b)return this;var e=this,f=c.once(function(){e.off(a,f),b.apply(this,arguments)});return f._callback=b,this.on(a,f,d)},off:function(a,b,d){if(!this._events||!j(this,"off",a,[b,d]))return this;if(!a&&!b&&!d)return this._events=void 0,this;for(var e=a?[a]:c.keys(this._events),f=0,g=e.length;g>f;f++){a=e[f];var h=this._events[a];if(h)if(b||d){for(var i=[],k=0,l=h.length;l>k;k++){var m=h[k];(b&&b!==m.callback&&b!==m.callback._callback||d&&d!==m.context)&&i.push(m)}i.length?this._events[a]=i:delete this._events[a]}else delete this._events[a]}return this},trigger:function(a){if(!this._events)return this;var b=g.call(arguments,1);if(!j(this,"trigger",a,b))return this;var c=this._events[a],d=this._events.all;return c&&k(c,b),d&&k(d,arguments),this},stopListening:function(a,b,d){var e=this._listeningTo;if(!e)return this;var f=!b&&!d;d||"object"!=typeof b||(d=this),a&&((e={})[a._listenId]=a);for(var g in e)a=e[g],a.off(b,d,this),(f||c.isEmpty(a._events))&&delete this._listeningTo[g];return this}},i=/\s+/,j=function(a,b,c,d){if(!c)return!0;if("object"==typeof c){for(var e in c)a[b].apply(a,[e,c[e]].concat(d));return!1}if(i.test(c)){for(var f=c.split(i),g=0,h=f.length;h>g;g++)a[b].apply(a,[f[g]].concat(d));return!1}return!0},k=function(a,b){var c,d=-1,e=a.length,f=b[0],g=b[1],h=b[2];switch(b.length){case 0:for(;++d<e;)(c=a[d]).callback.call(c.ctx);return;case 1:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f);return;case 2:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f,g);return;case 3:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f,g,h);return;default:for(;++d<e;)(c=a[d]).callback.apply(c.ctx,b);return}},l={listenTo:"on",listenToOnce:"once"};c.each(l,function(a,b){h[b]=function(b,d,e){var f=this._listeningTo||(this._listeningTo={}),g=b._listenId||(b._listenId=c.uniqueId("l"));return f[g]=b,e||"object"!=typeof d||(e=this),b[a](d,e,this),this}}),h.bind=h.on,h.unbind=h.off,c.extend(b,h);var m=b.Model=function(a,b){var d=a||{};b||(b={}),this.cid=c.uniqueId("c"),this.attributes={},b.collection&&(this.collection=b.collection),b.parse&&(d=this.parse(d,b)||{}),d=c.defaults({},d,c.result(this,"defaults")),this.set(d,b),this.changed={},this.initialize.apply(this,arguments)};c.extend(m.prototype,h,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(){return c.clone(this.attributes)},sync:function(){return b.sync.apply(this,arguments)},get:function(a){return this.attributes[a]},escape:function(a){return c.escape(this.get(a))},has:function(a){return null!=this.get(a)},set:function(a,b,d){var e,f,g,h,i,j,k,l;if(null==a)return this;if("object"==typeof a?(f=a,d=b):(f={})[a]=b,d||(d={}),!this._validate(f,d))return!1;g=d.unset,i=d.silent,h=[],j=this._changing,this._changing=!0,j||(this._previousAttributes=c.clone(this.attributes),this.changed={}),l=this.attributes,k=this._previousAttributes,this.idAttribute in f&&(this.id=f[this.idAttribute]);for(e in f)b=f[e],c.isEqual(l[e],b)||h.push(e),c.isEqual(k[e],b)?delete this.changed[e]:this.changed[e]=b,g?delete l[e]:l[e]=b;if(!i){h.length&&(this._pending=d);for(var m=0,n=h.length;n>m;m++)this.trigger("change:"+h[m],this,l[h[m]],d)}if(j)return this;if(!i)for(;this._pending;)d=this._pending,this._pending=!1,this.trigger("change",this,d);return this._pending=!1,this._changing=!1,this},unset:function(a,b){return this.set(a,void 0,c.extend({},b,{unset:!0}))},clear:function(a){var b={};for(var d in this.attributes)b[d]=void 0;return this.set(b,c.extend({},a,{unset:!0}))},hasChanged:function(a){return null==a?!c.isEmpty(this.changed):c.has(this.changed,a)},changedAttributes:function(a){if(!a)return this.hasChanged()?c.clone(this.changed):!1;var b,d=!1,e=this._changing?this._previousAttributes:this.attributes;for(var f in a)c.isEqual(e[f],b=a[f])||((d||(d={}))[f]=b);return d},previous:function(a){return null!=a&&this._previousAttributes?this._previousAttributes[a]:null},previousAttributes:function(){return c.clone(this._previousAttributes)},fetch:function(a){a=a?c.clone(a):{},void 0===a.parse&&(a.parse=!0);var b=this,d=a.success;return a.success=function(c){return b.set(b.parse(c,a),a)?(d&&d(b,c,a),void b.trigger("sync",b,c,a)):!1},J(this,a),this.sync("read",this,a)},save:function(a,b,d){var e,f,g,h=this.attributes;if(null==a||"object"==typeof a?(e=a,d=b):(e={})[a]=b,d=c.extend({validate:!0},d),e&&!d.wait){if(!this.set(e,d))return!1}else if(!this._validate(e,d))return!1;e&&d.wait&&(this.attributes=c.extend({},h,e)),void 0===d.parse&&(d.parse=!0);var i=this,j=d.success;return d.success=function(a){i.attributes=h;var b=i.parse(a,d);return d.wait&&(b=c.extend(e||{},b)),c.isObject(b)&&!i.set(b,d)?!1:(j&&j(i,a,d),void i.trigger("sync",i,a,d))},J(this,d),f=this.isNew()?"create":d.patch?"patch":"update","patch"===f&&(d.attrs=e),g=this.sync(f,this,d),e&&d.wait&&(this.attributes=h),g},destroy:function(a){a=a?c.clone(a):{};var b=this,d=a.success,e=function(){b.trigger("destroy",b,b.collection,a)};if(a.success=function(c){(a.wait||b.isNew())&&e(),d&&d(b,c,a),b.isNew()||b.trigger("sync",b,c,a)},this.isNew())return a.success(),!1;J(this,a);var f=this.sync("delete",this,a);return a.wait||e(),f},url:function(){var a=c.result(this,"urlRoot")||c.result(this.collection,"url")||I();return this.isNew()?a:a.replace(/([^\/])$/,"$1/")+encodeURIComponent(this.id)},parse:function(a){return a},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(a){return this._validate({},c.extend(a||{},{validate:!0}))},_validate:function(a,b){if(!b.validate||!this.validate)return!0;a=c.extend({},this.attributes,a);var d=this.validationError=this.validate(a,b)||null;return d?(this.trigger("invalid",this,d,c.extend(b,{validationError:d})),!1):!0}});var n=["keys","values","pairs","invert","pick","omit"];c.each(n,function(a){c[a]&&(m.prototype[a]=function(){var b=g.call(arguments);return b.unshift(this.attributes),c[a].apply(c,b)})});var o=b.Collection=function(a,b){b||(b={}),b.model&&(this.model=b.model),void 0!==b.comparator&&(this.comparator=b.comparator),this._reset(),this.initialize.apply(this,arguments),a&&this.reset(a,c.extend({silent:!0},b))
},p={add:!0,remove:!0,merge:!0},q={add:!0,remove:!1};c.extend(o.prototype,h,{model:m,initialize:function(){},toJSON:function(a){return this.map(function(b){return b.toJSON(a)})},sync:function(){return b.sync.apply(this,arguments)},add:function(a,b){return this.set(a,c.extend({merge:!1},b,q))},remove:function(a,b){var d=!c.isArray(a);a=d?[a]:c.clone(a),b||(b={});for(var e=0,f=a.length;f>e;e++){var g=a[e]=this.get(a[e]);if(g){delete this._byId[g.id],delete this._byId[g.cid];var h=this.indexOf(g);this.models.splice(h,1),this.length--,b.silent||(b.index=h,g.trigger("remove",g,this,b)),this._removeReference(g,b)}}return d?a[0]:a},set:function(a,b){b=c.defaults({},b,p),b.parse&&(a=this.parse(a,b));var d=!c.isArray(a);a=d?a?[a]:[]:a.slice();for(var e,f,g,h,i,j=b.at,k=this.comparator&&null==j&&b.sort!==!1,l=c.isString(this.comparator)?this.comparator:null,m=[],n=[],o={},q=b.add,r=b.merge,s=b.remove,t=!k&&q&&s?[]:!1,u=0,v=a.length;v>u;u++){if(g=a[u]||{},e=this._isModel(g)?f=g:g[this.model.prototype.idAttribute||"id"],h=this.get(e))s&&(o[h.cid]=!0),r&&(g=g===f?f.attributes:g,b.parse&&(g=h.parse(g,b)),h.set(g,b),k&&!i&&h.hasChanged(l)&&(i=!0)),a[u]=h;else if(q){if(f=a[u]=this._prepareModel(g,b),!f)continue;m.push(f),this._addReference(f,b)}f=h||f,f&&(!t||!f.isNew()&&o[f.id]||t.push(f),o[f.id]=!0)}if(s){for(var u=0,v=this.length;v>u;u++)o[(f=this.models[u]).cid]||n.push(f);n.length&&this.remove(n,b)}if(m.length||t&&t.length)if(k&&(i=!0),this.length+=m.length,null!=j)for(var u=0,v=m.length;v>u;u++)this.models.splice(j+u,0,m[u]);else{t&&(this.models.length=0);for(var w=t||m,u=0,v=w.length;v>u;u++)this.models.push(w[u])}if(i&&this.sort({silent:!0}),!b.silent){for(var u=0,v=m.length;v>u;u++)(f=m[u]).trigger("add",f,this,b);(i||t&&t.length)&&this.trigger("sort",this,b)}return d?a[0]:a},reset:function(a,b){b||(b={});for(var d=0,e=this.models.length;e>d;d++)this._removeReference(this.models[d],b);return b.previousModels=this.models,this._reset(),a=this.add(a,c.extend({silent:!0},b)),b.silent||this.trigger("reset",this,b),a},push:function(a,b){return this.add(a,c.extend({at:this.length},b))},pop:function(a){var b=this.at(this.length-1);return this.remove(b,a),b},unshift:function(a,b){return this.add(a,c.extend({at:0},b))},shift:function(a){var b=this.at(0);return this.remove(b,a),b},slice:function(){return g.apply(this.models,arguments)},get:function(a){return null==a?void 0:this._byId[a]||this._byId[a.id]||this._byId[a.cid]},at:function(a){return this.models[a]},where:function(a,b){return c.isEmpty(a)?b?void 0:[]:this[b?"find":"filter"](function(b){for(var c in a)if(a[c]!==b.get(c))return!1;return!0})},findWhere:function(a){return this.where(a,!0)},sort:function(a){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return a||(a={}),c.isString(this.comparator)||1===this.comparator.length?this.models=this.sortBy(this.comparator,this):this.models.sort(c.bind(this.comparator,this)),a.silent||this.trigger("sort",this,a),this},pluck:function(a){return c.invoke(this.models,"get",a)},fetch:function(a){a=a?c.clone(a):{},void 0===a.parse&&(a.parse=!0);var b=a.success,d=this;return a.success=function(c){var e=a.reset?"reset":"set";d[e](c,a),b&&b(d,c,a),d.trigger("sync",d,c,a)},J(this,a),this.sync("read",this,a)},create:function(a,b){if(b=b?c.clone(b):{},!(a=this._prepareModel(a,b)))return!1;b.wait||this.add(a,b);var d=this,e=b.success;return b.success=function(a,c){b.wait&&d.add(a,b),e&&e(a,c,b)},a.save(null,b),a},parse:function(a){return a},clone:function(){return new this.constructor(this.models,{model:this.model,comparator:this.comparator})},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(a,b){if(this._isModel(a))return a.collection||(a.collection=this),a;b=b?c.clone(b):{},b.collection=this;var d=new this.model(a,b);return d.validationError?(this.trigger("invalid",this,d.validationError,b),!1):d},_isModel:function(a){return a instanceof m},_addReference:function(a){this._byId[a.cid]=a,null!=a.id&&(this._byId[a.id]=a),a.on("all",this._onModelEvent,this)},_removeReference:function(a){this===a.collection&&delete a.collection,a.off("all",this._onModelEvent,this)},_onModelEvent:function(a,b,c,d){("add"!==a&&"remove"!==a||c===this)&&("destroy"===a&&this.remove(b,d),b&&a==="change:"+b.idAttribute&&(delete this._byId[b.previous(b.idAttribute)],null!=b.id&&(this._byId[b.id]=b)),this.trigger.apply(this,arguments))}});var r=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","difference","indexOf","shuffle","lastIndexOf","isEmpty","chain","sample","partition"];c.each(r,function(a){c[a]&&(o.prototype[a]=function(){var b=g.call(arguments);return b.unshift(this.models),c[a].apply(c,b)})});var s=["groupBy","countBy","sortBy","indexBy"];c.each(s,function(a){c[a]&&(o.prototype[a]=function(b,d){var e=c.isFunction(b)?b:function(a){return a.get(b)};return c[a](this.models,e,d)})});var t=b.View=function(a){this.cid=c.uniqueId("view"),a||(a={}),c.extend(this,c.pick(a,v)),this._ensureElement(),this.initialize.apply(this,arguments)},u=/^(\S+)\s*(.*)$/,v=["model","collection","el","id","attributes","className","tagName","events"];c.extend(t.prototype,h,{tagName:"div",$:function(a){return this.$el.find(a)},initialize:function(){},render:function(){return this},remove:function(){return this._removeElement(),this.stopListening(),this},_removeElement:function(){this.$el.remove()},setElement:function(a){return this.undelegateEvents(),this._setElement(a),this.delegateEvents(),this},_setElement:function(a){this.$el=a instanceof b.$?a:b.$(a),this.el=this.$el[0]},delegateEvents:function(a){if(!a&&!(a=c.result(this,"events")))return this;this.undelegateEvents();for(var b in a){var d=a[b];if(c.isFunction(d)||(d=this[a[b]]),d){var e=b.match(u);this.delegate(e[1],e[2],c.bind(d,this))}}return this},delegate:function(a,b,c){this.$el.on(a+".delegateEvents"+this.cid,b,c)},undelegateEvents:function(){return this.$el&&this.$el.off(".delegateEvents"+this.cid),this},undelegate:function(a,b,c){this.$el.off(a+".delegateEvents"+this.cid,b,c)},_createElement:function(a){return document.createElement(a)},_ensureElement:function(){if(this.el)this.setElement(c.result(this,"el"));else{var a=c.extend({},c.result(this,"attributes"));this.id&&(a.id=c.result(this,"id")),this.className&&(a["class"]=c.result(this,"className")),this.setElement(this._createElement(c.result(this,"tagName"))),this._setAttributes(a)}},_setAttributes:function(a){this.$el.attr(a)}}),b.sync=function(a,d,e){var f=x[a];c.defaults(e||(e={}),{emulateHTTP:b.emulateHTTP,emulateJSON:b.emulateJSON});var g={type:f,dataType:"json"};if(e.url||(g.url=c.result(d,"url")||I()),null!=e.data||!d||"create"!==a&&"update"!==a&&"patch"!==a||(g.contentType="application/json",g.data=JSON.stringify(e.attrs||d.toJSON(e))),e.emulateJSON&&(g.contentType="application/x-www-form-urlencoded",g.data=g.data?{model:g.data}:{}),e.emulateHTTP&&("PUT"===f||"DELETE"===f||"PATCH"===f)){g.type="POST",e.emulateJSON&&(g.data._method=f);var h=e.beforeSend;e.beforeSend=function(a){return a.setRequestHeader("X-HTTP-Method-Override",f),h?h.apply(this,arguments):void 0}}"GET"===g.type||e.emulateJSON||(g.processData=!1),"PATCH"===g.type&&w&&(g.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")});var i=e.error;e.error=function(a,b,c){e.textStatus=b,e.errorThrown=c,i&&i.apply(this,arguments)};var j=e.xhr=b.ajax(c.extend(g,e));return d.trigger("request",d,j,e),j};var w=!("undefined"==typeof window||!window.ActiveXObject||window.XMLHttpRequest&&(new XMLHttpRequest).dispatchEvent),x={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};b.ajax=function(){return b.$.ajax.apply(b.$,arguments)};var y=b.Router=function(a){a||(a={}),a.routes&&(this.routes=a.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},z=/\((.*?)\)/g,A=/(\(\?)?:\w+/g,B=/\*\w+/g,C=/[\-{}\[\]+?.,\\\^$|#\s]/g;c.extend(y.prototype,h,{initialize:function(){},route:function(a,d,e){c.isRegExp(a)||(a=this._routeToRegExp(a)),c.isFunction(d)&&(e=d,d=""),e||(e=this[d]);var f=this;return b.history.route(a,function(c){var g=f._extractParameters(a,c);f.execute(e,g,d)!==!1&&(f.trigger.apply(f,["route:"+d].concat(g)),f.trigger("route",d,g),b.history.trigger("route",f,d,g))}),this},execute:function(a,b){a&&a.apply(this,b)},navigate:function(a,c){return b.history.navigate(a,c),this},_bindRoutes:function(){if(this.routes){this.routes=c.result(this,"routes");for(var a,b=c.keys(this.routes);null!=(a=b.pop());)this.route(a,this.routes[a])}},_routeToRegExp:function(a){return a=a.replace(C,"\\$&").replace(z,"(?:$1)?").replace(A,function(a,b){return b?a:"([^/?]+)"}).replace(B,"([^?]*?)"),new RegExp("^"+a+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(a,b){var d=a.exec(b).slice(1);return c.map(d,function(a,b){return b===d.length-1?a||null:a?decodeURIComponent(a):null})}});var D=b.History=function(){this.handlers=[],c.bindAll(this,"checkUrl"),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},E=/^[#\/]|\s+$/g,F=/^\/+|\/+$/g,G=/#.*$/;D.started=!1,c.extend(D.prototype,h,{interval:50,atRoot:function(){var a=this.location.pathname.replace(/[^\/]$/,"$&/");return a===this.root&&!this.location.search},getHash:function(a){var b=(a||this).location.href.match(/#(.*)$/);return b?b[1]:""},getPath:function(){var a=decodeURI(this.location.pathname+this.location.search),b=this.root.slice(0,-1);return a.indexOf(b)||(a=a.slice(b.length)),a.slice(1)},getFragment:function(a){return null==a&&(a=this._hasPushState||!this._wantsHashChange?this.getPath():this.getHash()),a.replace(E,"")},start:function(a){if(D.started)throw new Error("Backbone.history has already been started");D.started=!0,this.options=c.extend({root:"/"},this.options,a),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._hasHashChange="onhashchange"in window,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState),this.fragment=this.getFragment();var b=window.addEventListener||function(a,b){return attachEvent("on"+a,b)};if(this.root=("/"+this.root+"/").replace(F,"/"),!(this._hasHashChange||!this._wantsHashChange||this._wantsPushState&&this._hasPushState)){var d=document.createElement("iframe");d.src="javascript:0",d.style.display="none",d.tabIndex=-1;var e=document.body;this.iframe=e.insertBefore(d,e.firstChild).contentWindow,this.navigate(this.fragment)}if(this._hasPushState?b("popstate",this.checkUrl,!1):this._wantsHashChange&&this._hasHashChange&&!this.iframe?b("hashchange",this.checkUrl,!1):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot())return this.location.replace(this.root+"#"+this.getPath()),!0;this._hasPushState&&this.atRoot()&&this.navigate(this.getHash(),{replace:!0})}return this.options.silent?void 0:this.loadUrl()},stop:function(){var a=window.removeEventListener||function(a,b){return detachEvent("on"+a,b)};this._hasPushState?a("popstate",this.checkUrl,!1):this._wantsHashChange&&this._hasHashChange&&!this.iframe&&a("hashchange",this.checkUrl,!1),this.iframe&&(document.body.removeChild(this.iframe.frameElement),this.iframe=null),this._checkUrlInterval&&clearInterval(this._checkUrlInterval),D.started=!1},route:function(a,b){this.handlers.unshift({route:a,callback:b})},checkUrl:function(){var a=this.getFragment();return a===this.fragment&&this.iframe&&(a=this.getHash(this.iframe)),a===this.fragment?!1:(this.iframe&&this.navigate(a),void this.loadUrl())},loadUrl:function(a){return a=this.fragment=this.getFragment(a),c.any(this.handlers,function(b){return b.route.test(a)?(b.callback(a),!0):void 0})},navigate:function(a,b){if(!D.started)return!1;b&&b!==!0||(b={trigger:!!b});var c=this.root+(a=this.getFragment(a||""));if(a=decodeURI(a.replace(G,"")),this.fragment!==a){if(this.fragment=a,""===a&&"/"!==c&&(c=c.slice(0,-1)),this._hasPushState)this.history[b.replace?"replaceState":"pushState"]({},document.title,c);else{if(!this._wantsHashChange)return this.location.assign(c);this._updateHash(this.location,a,b.replace),this.iframe&&a!==this.getHash(this.iframe)&&(b.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,a,b.replace))}return b.trigger?this.loadUrl(a):void 0}},_updateHash:function(a,b,c){if(c){var d=a.href.replace(/(javascript:|#).*$/,"");a.replace(d+"#"+b)}else a.hash="#"+b}}),b.history=new D;var H=function(a,b){var d,e=this;d=a&&c.has(a,"constructor")?a.constructor:function(){return e.apply(this,arguments)},c.extend(d,e,b);var f=function(){this.constructor=d};return f.prototype=e.prototype,d.prototype=new f,a&&c.extend(d.prototype,a),d.__super__=e.prototype,d};m.extend=o.extend=y.extend=t.extend=D.extend=H;var I=function(){throw new Error('A "url" property or function must be specified')},J=function(a,b){var c=b.error;b.error=function(d){c&&c(a,d,b),a.trigger("error",a,d,b)}};return b});var Marionette=function(a,b,c){"use strict";function d(a,b){var c=new Error(a);throw c.name=b||"Error",c}!function(a,b){var c=a.ChildViewContainer;return a.ChildViewContainer=function(a,b){var c=function(a){this._views={},this._indexByModel={},this._indexByCustom={},this._updateLength(),b.each(a,this.add,this)};b.extend(c.prototype,{add:function(a,b){var c=a.cid;return this._views[c]=a,a.model&&(this._indexByModel[a.model.cid]=c),b&&(this._indexByCustom[b]=c),this._updateLength(),this},findByModel:function(a){return this.findByModelCid(a.cid)},findByModelCid:function(a){var b=this._indexByModel[a];return this.findByCid(b)},findByCustom:function(a){var b=this._indexByCustom[a];return this.findByCid(b)},findByIndex:function(a){return b.values(this._views)[a]},findByCid:function(a){return this._views[a]},remove:function(a){var c=a.cid;return a.model&&delete this._indexByModel[a.model.cid],b.any(this._indexByCustom,function(a,b){return a===c?(delete this._indexByCustom[b],!0):void 0},this),delete this._views[c],this._updateLength(),this},call:function(a){this.apply(a,b.tail(arguments))},apply:function(a,c){b.each(this._views,function(d){b.isFunction(d[a])&&d[a].apply(d,c||[])})},_updateLength:function(){this.length=b.size(this._views)}});var d=["forEach","each","map","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","toArray","first","initial","rest","last","without","isEmpty","pluck"];return b.each(d,function(a){c.prototype[a]=function(){var c=b.values(this._views),d=[c].concat(b.toArray(arguments));return b[a].apply(b,d)}}),c}(a,b),a.ChildViewContainer.VERSION="0.1.4",a.ChildViewContainer.noConflict=function(){return a.ChildViewContainer=c,this},a.ChildViewContainer}(b,c),function(a,b){var c=a.Wreqr,d=a.Wreqr={};return a.Wreqr.VERSION="1.3.1",a.Wreqr.noConflict=function(){return a.Wreqr=c,this},d.Handlers=function(a,b){var c=function(a){this.options=a,this._wreqrHandlers={},b.isFunction(this.initialize)&&this.initialize(a)};return c.extend=a.Model.extend,b.extend(c.prototype,a.Events,{setHandlers:function(a){b.each(a,function(a,c){var d=null;b.isObject(a)&&!b.isFunction(a)&&(d=a.context,a=a.callback),this.setHandler(c,a,d)},this)},setHandler:function(a,b,c){var d={callback:b,context:c};this._wreqrHandlers[a]=d,this.trigger("handler:add",a,b,c)},hasHandler:function(a){return!!this._wreqrHandlers[a]},getHandler:function(a){var b=this._wreqrHandlers[a];if(b)return function(){var a=Array.prototype.slice.apply(arguments);return b.callback.apply(b.context,a)}},removeHandler:function(a){delete this._wreqrHandlers[a]},removeAllHandlers:function(){this._wreqrHandlers={}}}),c}(a,b),d.CommandStorage=function(){var c=function(a){this.options=a,this._commands={},b.isFunction(this.initialize)&&this.initialize(a)};return b.extend(c.prototype,a.Events,{getCommands:function(a){var b=this._commands[a];return b||(b={command:a,instances:[]},this._commands[a]=b),b},addCommand:function(a,b){var c=this.getCommands(a);c.instances.push(b)},clearCommands:function(a){var b=this.getCommands(a);b.instances=[]}}),c}(),d.Commands=function(a){return a.Handlers.extend({storageType:a.CommandStorage,constructor:function(b){this.options=b||{},this._initializeStorage(this.options),this.on("handler:add",this._executeCommands,this);var c=Array.prototype.slice.call(arguments);a.Handlers.prototype.constructor.apply(this,c)},execute:function(a,b){a=arguments[0],b=Array.prototype.slice.call(arguments,1),this.hasHandler(a)?this.getHandler(a).apply(this,b):this.storage.addCommand(a,b)},_executeCommands:function(a,c,d){var e=this.storage.getCommands(a);b.each(e.instances,function(a){c.apply(d,a)}),this.storage.clearCommands(a)},_initializeStorage:function(a){var c,d=a.storageType||this.storageType;c=b.isFunction(d)?new d:d,this.storage=c}})}(d),d.RequestResponse=function(a){return a.Handlers.extend({request:function(){var a=arguments[0],b=Array.prototype.slice.call(arguments,1);return this.hasHandler(a)?this.getHandler(a).apply(this,b):void 0}})}(d),d.EventAggregator=function(a,b){var c=function(){};return c.extend=a.Model.extend,b.extend(c.prototype,a.Events),c}(a,b),d.Channel=function(){var c=function(b){this.vent=new a.Wreqr.EventAggregator,this.reqres=new a.Wreqr.RequestResponse,this.commands=new a.Wreqr.Commands,this.channelName=b};return b.extend(c.prototype,{reset:function(){return this.vent.off(),this.vent.stopListening(),this.reqres.removeAllHandlers(),this.commands.removeAllHandlers(),this},connectEvents:function(a,b){return this._connect("vent",a,b),this},connectCommands:function(a,b){return this._connect("commands",a,b),this},connectRequests:function(a,b){return this._connect("reqres",a,b),this},_connect:function(a,c,d){if(c){d=d||this;var e="vent"===a?"on":"setHandler";b.each(c,function(c,f){this[a][e](f,b.bind(c,d))},this)}}}),c}(d),d.radio=function(a){var c=function(){this._channels={},this.vent={},this.commands={},this.reqres={},this._proxyMethods()};b.extend(c.prototype,{channel:function(a){if(!a)throw new Error("Channel must receive a name");return this._getChannel(a)},_getChannel:function(b){var c=this._channels[b];return c||(c=new a.Channel(b),this._channels[b]=c),c},_proxyMethods:function(){b.each(["vent","commands","reqres"],function(a){b.each(d[a],function(b){this[a][b]=e(this,a,b)},this)},this)}});var d={vent:["on","off","trigger","once","stopListening","listenTo","listenToOnce"],commands:["execute","setHandler","setHandlers","removeHandler","removeAllHandlers"],reqres:["request","setHandler","setHandlers","removeHandler","removeAllHandlers"]},e=function(a,b,c){return function(d){var e=a._getChannel(d)[b],f=Array.prototype.slice.call(arguments,1);return e[c].apply(e,f)}};return new c}(d),a.Wreqr}(b,c);var e={};b.Marionette=e,e.$=b.$;var f=Array.prototype.slice;return e.extend=b.Model.extend,e.getOption=function(a,b){if(a&&b){var c;return c=a.options&&b in a.options&&void 0!==a.options[b]?a.options[b]:a[b]}},e.normalizeMethods=function(a){var b,d={};return c.each(a,function(a,e){b=a,c.isFunction(b)||(b=this[b]),b&&(d[e]=b)},this),d},e.normalizeUIKeys=function(a,b){return"undefined"!=typeof a?(c.each(c.keys(a),function(c){var d=/@ui.[a-zA-Z_$0-9]*/g;c.match(d)&&(a[c.replace(d,function(a){return b[a.slice(4)]})]=a[c],delete a[c])}),a):void 0},e.actAsCollection=function(a,b){var d=["forEach","each","map","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","toArray","first","initial","rest","last","without","isEmpty","pluck"];c.each(d,function(d){a[d]=function(){var a=c.values(c.result(this,b)),e=[a].concat(c.toArray(arguments));return c[d].apply(c,e)}})},e.triggerMethod=function(){function a(a,b,c){return c.toUpperCase()}var b=/(^|:)(\w)/gi,d=function(d){var e="on"+d.replace(b,a),f=this[e];return c.isFunction(this.trigger)&&this.trigger.apply(this,arguments),c.isFunction(f)?f.apply(this,c.tail(arguments)):void 0};return d}(),e.MonitorDOMRefresh=function(a){function b(a){a._isShown=!0,e(a)}function d(a){a._isRendered=!0,e(a)}function e(a){a._isShown&&a._isRendered&&f(a)&&c.isFunction(a.triggerMethod)&&a.triggerMethod("dom:refresh")}function f(b){return a.contains(b.el)}return function(a){a.listenTo(a,"show",function(){b(a)}),a.listenTo(a,"render",function(){d(a)})}}(document.documentElement),function(a){function b(a,b,e,f){var g=f.split(/\s+/);c.each(g,function(c){var f=a[c];f||d("Method '"+c+"' was configured as an event handler, but does not exist."),a.listenTo(b,e,f)})}function e(a,b,c,d){a.listenTo(b,c,d)}function f(a,b,d,e){var f=e.split(/\s+/);c.each(f,function(c){var e=a[c];a.stopListening(b,d,e)})}function g(a,b,c,d){a.stopListening(b,c,d)}function h(a,b,d,e,f){b&&d&&(c.isFunction(d)&&(d=d.call(a)),c.each(d,function(d,g){c.isFunction(d)?e(a,b,g,d):f(a,b,g,d)}))}a.bindEntityEvents=function(a,c,d){h(a,c,d,e,b)},a.unbindEntityEvents=function(a,b,c){h(a,b,c,g,f)}}(e),e.Callbacks=function(){this._deferred=e.$.Deferred(),this._callbacks=[]},c.extend(e.Callbacks.prototype,{add:function(a,b){this._callbacks.push({cb:a,ctx:b}),this._deferred.done(function(c,d){b&&(c=b),a.call(c,d)})},run:function(a,b){this._deferred.resolve(b,a)},reset:function(){var a=this._callbacks;this._deferred=e.$.Deferred(),this._callbacks=[],c.each(a,function(a){this.add(a.cb,a.ctx)},this)}}),e.Controller=function(a){this.triggerMethod=e.triggerMethod,this.options=a||{},c.isFunction(this.initialize)&&this.initialize(this.options)},e.Controller.extend=e.extend,c.extend(e.Controller.prototype,b.Events,{close:function(){this.stopListening();var a=Array.prototype.slice.call(arguments);this.triggerMethod.apply(this,["close"].concat(a)),this.off()}}),e.Region=function(a){if(this.options=a||{},this.el=e.getOption(this,"el"),this.el||d("An 'el' must be specified for a region.","NoElError"),this.initialize){var b=Array.prototype.slice.apply(arguments);this.initialize.apply(this,b)}},c.extend(e.Region,{buildRegion:function(a,b){var e=c.isString(a),f=c.isString(a.selector),g=c.isUndefined(a.regionType),h=c.isFunction(a);h||e||f||d("Region must be specified as a Region type, a selector string or an object with selector property");var i,j;e&&(i=a),a.selector&&(i=a.selector,delete a.selector),h&&(j=a),!h&&g&&(j=b),a.regionType&&(j=a.regionType,delete a.regionType),(e||h)&&(a={}),a.el=i;var k=new j(a);return a.parentEl&&(k.getEl=function(b){var d=a.parentEl;return c.isFunction(d)&&(d=d()),d.find(b)}),k}}),c.extend(e.Region.prototype,b.Events,{show:function(a,b){this.ensureEl();var d=b||{},f=a.isClosed||c.isUndefined(a.$el),g=a!==this.currentView,h=!!d.preventClose,i=!h&&g;return i&&this.close(),a.render(),e.triggerMethod.call(this,"before:show",a),c.isFunction(a.triggerMethod)?a.triggerMethod("before:show"):e.triggerMethod.call(a,"before:show"),(g||f)&&this.open(a),this.currentView=a,e.triggerMethod.call(this,"show",a),c.isFunction(a.triggerMethod)?a.triggerMethod("show"):e.triggerMethod.call(a,"show"),this},ensureEl:function(){this.$el&&0!==this.$el.length||(this.$el=this.getEl(this.el))},getEl:function(a){return e.$(a)},open:function(a){this.$el.empty().append(a.el)},close:function(){var a=this.currentView;a&&!a.isClosed&&(a.close?a.close():a.remove&&a.remove(),e.triggerMethod.call(this,"close",a),delete this.currentView)},attachView:function(a){this.currentView=a},reset:function(){this.close(),delete this.$el}}),e.Region.extend=e.extend,e.RegionManager=function(a){var b=a.Controller.extend({constructor:function(b){this._regions={},a.Controller.prototype.constructor.call(this,b)},addRegions:function(a,b){var d={};return c.each(a,function(a,e){c.isString(a)&&(a={selector:a}),a.selector&&(a=c.defaults({},a,b));var f=this.addRegion(e,a);d[e]=f},this),d},addRegion:function(b,d){var e,f=c.isObject(d),g=c.isString(d),h=!!d.selector;return e=g||f&&h?a.Region.buildRegion(d,a.Region):c.isFunction(d)?a.Region.buildRegion(d,a.Region):d,this._store(b,e),this.triggerMethod("region:add",b,e),e},get:function(a){return this._regions[a]},removeRegion:function(a){var b=this._regions[a];this._remove(a,b)},removeRegions:function(){c.each(this._regions,function(a,b){this._remove(b,a)},this)},closeRegions:function(){c.each(this._regions,function(a){a.close()},this)},close:function(){this.removeRegions(),a.Controller.prototype.close.apply(this,arguments)},_store:function(a,b){this._regions[a]=b,this._setLength()},_remove:function(a,b){b.close(),b.stopListening(),delete this._regions[a],this._setLength(),this.triggerMethod("region:remove",a,b)},_setLength:function(){this.length=c.size(this._regions)}});return a.actAsCollection(b.prototype,"_regions"),b}(e),e.TemplateCache=function(a){this.templateId=a},c.extend(e.TemplateCache,{templateCaches:{},get:function(a){var b=this.templateCaches[a];return b||(b=new e.TemplateCache(a),this.templateCaches[a]=b),b.load()},clear:function(){var a,b=f.call(arguments),c=b.length;if(c>0)for(a=0;c>a;a++)delete this.templateCaches[b[a]];else this.templateCaches={}}}),c.extend(e.TemplateCache.prototype,{load:function(){if(this.compiledTemplate)return this.compiledTemplate;var a=this.loadTemplate(this.templateId);return this.compiledTemplate=this.compileTemplate(a),this.compiledTemplate},loadTemplate:function(a){var b=e.$(a).html();return b&&0!==b.length||d("Could not find template: '"+a+"'","NoTemplateError"),b},compileTemplate:function(a){return c.template(a)}}),e.Renderer={render:function(a,b){a||d("Cannot render the template since it's false, null or undefined.","TemplateNotFoundError");var c;return(c="function"==typeof a?a:e.TemplateCache.get(a))(b)}},e.View=b.View.extend({constructor:function(a){c.bindAll(this,"render"),this.options=c.extend({},c.result(this,"options"),c.isFunction(a)?a.call(this):a),this.events=this.normalizeUIKeys(c.result(this,"events")),c.isObject(this.behaviors)&&new e.Behaviors(this),b.View.prototype.constructor.apply(this,arguments),e.MonitorDOMRefresh(this),this.listenTo(this,"show",this.onShowCalled)},triggerMethod:e.triggerMethod,normalizeMethods:e.normalizeMethods,getTemplate:function(){return e.getOption(this,"template")},mixinTemplateHelpers:function(a){a=a||{};var b=e.getOption(this,"templateHelpers");return c.isFunction(b)&&(b=b.call(this)),c.extend(a,b)},normalizeUIKeys:function(a){var b=c.result(this,"ui");return e.normalizeUIKeys(a,b)},configureTriggers:function(){if(this.triggers){var a={},b=this.normalizeUIKeys(c.result(this,"triggers"));return c.each(b,function(b,d){var e=c.isObject(b),f=e?b.event:b;a[d]=function(a){if(a){var c=a.preventDefault,d=a.stopPropagation,g=e?b.preventDefault:c,h=e?b.stopPropagation:d;g&&c&&c.apply(a),h&&d&&d.apply(a)}var i={view:this,model:this.model,collection:this.collection};this.triggerMethod(f,i)}},this),a}},delegateEvents:function(a){this._delegateDOMEvents(a),e.bindEntityEvents(this,this.model,e.getOption(this,"modelEvents")),e.bindEntityEvents(this,this.collection,e.getOption(this,"collectionEvents"))},_delegateDOMEvents:function(a){a=a||this.events,c.isFunction(a)&&(a=a.call(this));var d={},e=c.result(this,"behaviorEvents")||{},f=this.configureTriggers();c.extend(d,e,a,f),b.View.prototype.delegateEvents.call(this,d)},undelegateEvents:function(){var a=Array.prototype.slice.call(arguments);b.View.prototype.undelegateEvents.apply(this,a),e.unbindEntityEvents(this,this.model,e.getOption(this,"modelEvents")),e.unbindEntityEvents(this,this.collection,e.getOption(this,"collectionEvents"))},onShowCalled:function(){},close:function(){if(!this.isClosed){var a=Array.prototype.slice.call(arguments),b=this.triggerMethod.apply(this,["before:close"].concat(a));b!==!1&&(this.isClosed=!0,this.triggerMethod.apply(this,["close"].concat(a)),this.unbindUIElements(),this.remove())}},bindUIElements:function(){if(this.ui){this._uiBindings||(this._uiBindings=this.ui);var a=c.result(this,"_uiBindings");this.ui={},c.each(c.keys(a),function(b){var c=a[b];this.ui[b]=this.$(c)},this)}},unbindUIElements:function(){this.ui&&this._uiBindings&&(c.each(this.ui,function(a,b){delete this.ui[b]},this),this.ui=this._uiBindings,delete this._uiBindings)}}),e.ItemView=e.View.extend({constructor:function(){e.View.prototype.constructor.apply(this,arguments)},serializeData:function(){var a={};return this.model?a=this.model.toJSON():this.collection&&(a={items:this.collection.toJSON()}),a},render:function(){this.isClosed=!1,this.triggerMethod("before:render",this),this.triggerMethod("item:before:render",this);var a=this.serializeData();a=this.mixinTemplateHelpers(a);var b=this.getTemplate(),c=e.Renderer.render(b,a);return this.$el.html(c),this.bindUIElements(),this.triggerMethod("render",this),this.triggerMethod("item:rendered",this),this},close:function(){this.isClosed||(this.triggerMethod("item:before:close"),e.View.prototype.close.apply(this,arguments),this.triggerMethod("item:closed"))}}),e.CollectionView=e.View.extend({itemViewEventPrefix:"itemview",constructor:function(){this._initChildViewStorage(),e.View.prototype.constructor.apply(this,arguments),this._initialEvents(),this.initRenderBuffer()},initRenderBuffer:function(){this.elBuffer=document.createDocumentFragment(),this._bufferedChildren=[]},startBuffering:function(){this.initRenderBuffer(),this.isBuffering=!0},endBuffering:function(){this.isBuffering=!1,this.appendBuffer(this,this.elBuffer),this._triggerShowBufferedChildren(),this.initRenderBuffer()},_triggerShowBufferedChildren:function(){this._isShown&&(c.each(this._bufferedChildren,function(a){c.isFunction(a.triggerMethod)?a.triggerMethod("show"):e.triggerMethod.call(a,"show")}),this._bufferedChildren=[])},_initialEvents:function(){this.collection&&(this.listenTo(this.collection,"add",this.addChildView),this.listenTo(this.collection,"remove",this.removeItemView),this.listenTo(this.collection,"reset",this.render))},addChildView:function(a){this.closeEmptyView();var b=this.getItemView(a),c=this.collection.indexOf(a);this.addItemView(a,b,c)},onShowCalled:function(){this.children.each(function(a){c.isFunction(a.triggerMethod)?a.triggerMethod("show"):e.triggerMethod.call(a,"show")})},triggerBeforeRender:function(){this.triggerMethod("before:render",this),this.triggerMethod("collection:before:render",this)},triggerRendered:function(){this.triggerMethod("render",this),this.triggerMethod("collection:rendered",this)},render:function(){return this.isClosed=!1,this.triggerBeforeRender(),this._renderChildren(),this.triggerRendered(),this},_renderChildren:function(){this.startBuffering(),this.closeEmptyView(),this.closeChildren(),this.isEmpty(this.collection)?this.showEmptyView():this.showCollection(),this.endBuffering()},showCollection:function(){var a;this.collection.each(function(b,c){a=this.getItemView(b),this.addItemView(b,a,c)},this)},showEmptyView:function(){var a=this.getEmptyView();if(a&&!this._showingEmptyView){this._showingEmptyView=!0;var c=new b.Model;this.addItemView(c,a,0)}},closeEmptyView:function(){this._showingEmptyView&&(this.closeChildren(),delete this._showingEmptyView)},getEmptyView:function(){return e.getOption(this,"emptyView")},getItemView:function(){var a=e.getOption(this,"itemView");return a||d("An `itemView` must be specified","NoItemViewError"),a},addItemView:function(a,b,d){var f=e.getOption(this,"itemViewOptions");c.isFunction(f)&&(f=f.call(this,a,d));var g=this.buildItemView(a,b,f);return this.addChildViewEventForwarding(g),this.triggerMethod("before:item:added",g),this.children.add(g),this.renderItemView(g,d),this._isShown&&!this.isBuffering&&(c.isFunction(g.triggerMethod)?g.triggerMethod("show"):e.triggerMethod.call(g,"show")),this.triggerMethod("after:item:added",g),g},addChildViewEventForwarding:function(a){var b=e.getOption(this,"itemViewEventPrefix");this.listenTo(a,"all",function(){var d=f.call(arguments),g=d[0],h=this.normalizeMethods(this.getItemEvents());d[0]=b+":"+g,d.splice(1,0,a),"undefined"!=typeof h&&c.isFunction(h[g])&&h[g].apply(this,d),e.triggerMethod.apply(this,d)
},this)},getItemEvents:function(){return c.isFunction(this.itemEvents)?this.itemEvents.call(this):this.itemEvents},renderItemView:function(a,b){a.render(),this.appendHtml(this,a,b)},buildItemView:function(a,b,d){var e=c.extend({model:a},d);return new b(e)},removeItemView:function(a){var b=this.children.findByModel(a);this.removeChildView(b),this.checkEmpty()},removeChildView:function(a){a&&(a.close?a.close():a.remove&&a.remove(),this.stopListening(a),this.children.remove(a)),this.triggerMethod("item:removed",a)},isEmpty:function(){return!this.collection||0===this.collection.length},checkEmpty:function(){this.isEmpty(this.collection)&&this.showEmptyView()},appendBuffer:function(a,b){a.$el.append(b)},appendHtml:function(a,b){a.isBuffering?(a.elBuffer.appendChild(b.el),a._bufferedChildren.push(b)):a.$el.append(b.el)},_initChildViewStorage:function(){this.children=new b.ChildViewContainer},close:function(){this.isClosed||(this.triggerMethod("collection:before:close"),this.closeChildren(),this.triggerMethod("collection:closed"),e.View.prototype.close.apply(this,arguments))},closeChildren:function(){this.children.each(function(a){this.removeChildView(a)},this),this.checkEmpty()}}),e.CompositeView=e.CollectionView.extend({constructor:function(){e.CollectionView.prototype.constructor.apply(this,arguments)},_initialEvents:function(){this.once("render",function(){this.collection&&(this.listenTo(this.collection,"add",this.addChildView),this.listenTo(this.collection,"remove",this.removeItemView),this.listenTo(this.collection,"reset",this._renderChildren))})},getItemView:function(){var a=e.getOption(this,"itemView")||this.constructor;return a||d("An `itemView` must be specified","NoItemViewError"),a},serializeData:function(){var a={};return this.model&&(a=this.model.toJSON()),a},render:function(){this.isRendered=!0,this.isClosed=!1,this.resetItemViewContainer(),this.triggerBeforeRender();var a=this.renderModel();return this.$el.html(a),this.bindUIElements(),this.triggerMethod("composite:model:rendered"),this._renderChildren(),this.triggerMethod("composite:rendered"),this.triggerRendered(),this},_renderChildren:function(){this.isRendered&&(this.triggerMethod("composite:collection:before:render"),e.CollectionView.prototype._renderChildren.call(this),this.triggerMethod("composite:collection:rendered"))},renderModel:function(){var a={};a=this.serializeData(),a=this.mixinTemplateHelpers(a);var b=this.getTemplate();return e.Renderer.render(b,a)},appendBuffer:function(a,b){var c=this.getItemViewContainer(a);c.append(b)},appendHtml:function(a,b){if(a.isBuffering)a.elBuffer.appendChild(b.el),a._bufferedChildren.push(b);else{var c=this.getItemViewContainer(a);c.append(b.el)}},getItemViewContainer:function(a){if("$itemViewContainer"in a)return a.$itemViewContainer;var b,f=e.getOption(a,"itemViewContainer");if(f){var g=c.isFunction(f)?f.call(a):f;b="@"===g.charAt(0)&&a.ui?a.ui[g.substr(4)]:a.$(g),b.length<=0&&d("The specified `itemViewContainer` was not found: "+a.itemViewContainer,"ItemViewContainerMissingError")}else b=a.$el;return a.$itemViewContainer=b,b},resetItemViewContainer:function(){this.$itemViewContainer&&delete this.$itemViewContainer}}),e.Layout=e.ItemView.extend({regionType:e.Region,constructor:function(a){a=a||{},this._firstRender=!0,this._initializeRegions(a),e.ItemView.prototype.constructor.call(this,a)},render:function(){return this.isClosed&&this._initializeRegions(),this._firstRender?this._firstRender=!1:this.isClosed||this._reInitializeRegions(),e.ItemView.prototype.render.apply(this,arguments)},close:function(){this.isClosed||(this.regionManager.close(),e.ItemView.prototype.close.apply(this,arguments))},addRegion:function(a,b){var c={};return c[a]=b,this._buildRegions(c)[a]},addRegions:function(a){return this.regions=c.extend({},this.regions,a),this._buildRegions(a)},removeRegion:function(a){return delete this.regions[a],this.regionManager.removeRegion(a)},getRegion:function(a){return this.regionManager.get(a)},_buildRegions:function(a){var b=this,c={regionType:e.getOption(this,"regionType"),parentEl:function(){return b.$el}};return this.regionManager.addRegions(a,c)},_initializeRegions:function(a){var b;this._initRegionManager(),b=c.isFunction(this.regions)?this.regions(a):this.regions||{},this.addRegions(b)},_reInitializeRegions:function(){this.regionManager.closeRegions(),this.regionManager.each(function(a){a.reset()})},_initRegionManager:function(){this.regionManager=new e.RegionManager,this.listenTo(this.regionManager,"region:add",function(a,b){this[a]=b,this.trigger("region:add",a,b)}),this.listenTo(this.regionManager,"region:remove",function(a,b){delete this[a],this.trigger("region:remove",a,b)})}}),e.Behavior=function(a,b){function c(b,c){this.view=c,this.defaults=a.result(this,"defaults")||{},this.options=a.extend({},this.defaults,b),this.$=function(){return this.view.$.apply(this.view,arguments)},this.initialize.apply(this,arguments)}return a.extend(c.prototype,b.Events,{initialize:function(){},close:function(){this.stopListening()},triggerMethod:e.triggerMethod}),c.extend=e.extend,c}(c,b),e.Behaviors=function(a,b){function c(a){this.behaviors=c.parseBehaviors(a,b.result(a,"behaviors")),c.wrap(a,this.behaviors,["bindUIElements","unbindUIElements","delegateEvents","undelegateEvents","behaviorEvents","triggerMethod","setElement","close"])}var d={setElement:function(a,c){a.apply(this,b.tail(arguments,2)),b.each(c,function(a){a.$el=this.$el},this)},close:function(a,c){var d=b.tail(arguments,2);a.apply(this,d),b.invoke(c,"close",d)},bindUIElements:function(a,c){a.apply(this),b.invoke(c,a)},unbindUIElements:function(a,c){a.apply(this),b.invoke(c,a)},triggerMethod:function(a,c){var d=b.tail(arguments,2);a.apply(this,d),b.each(c,function(b){a.apply(b,d)})},delegateEvents:function(c,d){var e=b.tail(arguments,2);c.apply(this,e),b.each(d,function(b){a.bindEntityEvents(b,this.model,a.getOption(b,"modelEvents")),a.bindEntityEvents(b,this.collection,a.getOption(b,"collectionEvents"))},this)},undelegateEvents:function(c,d){var e=b.tail(arguments,2);c.apply(this,e),b.each(d,function(b){a.unbindEntityEvents(b,this.model,a.getOption(b,"modelEvents")),a.unbindEntityEvents(b,this.collection,a.getOption(b,"collectionEvents"))},this)},behaviorEvents:function(c,d){var e={},f=b.result(this,"ui");return b.each(d,function(c,d){var g={},h=b.clone(b.result(c,"events"))||{},i=b.result(c,"ui"),j=b.extend({},f,i);h=a.normalizeUIKeys(h,j),b.each(b.keys(h),function(a){var e=new Array(d+2).join(" "),f=a+e,i=b.isFunction(h[a])?h[a]:c[h[a]];g[f]=b.bind(i,c)}),e=b.extend(e,g)}),e}};return b.extend(c,{behaviorsLookup:function(){throw new Error("You must define where your behaviors are stored. See https://github.com/marionettejs/backbone.marionette/blob/master/docs/marionette.behaviors.md#behaviorslookup")},getBehaviorClass:function(a,d){return a.behaviorClass?a.behaviorClass:b.isFunction(c.behaviorsLookup)?c.behaviorsLookup.apply(this,arguments)[d]:c.behaviorsLookup[d]},parseBehaviors:function(a,d){return b.map(d,function(b,d){var e=c.getBehaviorClass(b,d);return new e(b,a)})},wrap:function(a,c,e){b.each(e,function(e){a[e]=b.partial(d[e],a[e],c)})}}),c}(e,c),e.AppRouter=b.Router.extend({constructor:function(a){b.Router.prototype.constructor.apply(this,arguments),this.options=a||{};var c=e.getOption(this,"appRoutes"),d=this._getController();this.processAppRoutes(d,c),this.on("route",this._processOnRoute,this)},appRoute:function(a,b){var c=this._getController();this._addAppRoute(c,a,b)},_processOnRoute:function(a,b){var d=c.invert(this.appRoutes)[a];c.isFunction(this.onRoute)&&this.onRoute(a,d,b)},processAppRoutes:function(a,b){if(b){var d=c.keys(b).reverse();c.each(d,function(c){this._addAppRoute(a,c,b[c])},this)}},_getController:function(){return e.getOption(this,"controller")},_addAppRoute:function(a,b,e){var f=a[e];f||d("Method '"+e+"' was not found on the controller"),this.route(b,e,c.bind(f,a))}}),e.Application=function(a){this._initRegionManager(),this._initCallbacks=new e.Callbacks,this.vent=new b.Wreqr.EventAggregator,this.commands=new b.Wreqr.Commands,this.reqres=new b.Wreqr.RequestResponse,this.submodules={},c.extend(this,a),this.triggerMethod=e.triggerMethod},c.extend(e.Application.prototype,b.Events,{execute:function(){this.commands.execute.apply(this.commands,arguments)},request:function(){return this.reqres.request.apply(this.reqres,arguments)},addInitializer:function(a){this._initCallbacks.add(a)},start:function(a){this.triggerMethod("initialize:before",a),this._initCallbacks.run(a,this),this.triggerMethod("initialize:after",a),this.triggerMethod("start",a)},addRegions:function(a){return this._regionManager.addRegions(a)},closeRegions:function(){this._regionManager.closeRegions()},removeRegion:function(a){this._regionManager.removeRegion(a)},getRegion:function(a){return this._regionManager.get(a)},module:function(a,b){var c=e.Module.getClass(b),d=f.call(arguments);return d.unshift(this),c.create.apply(c,d)},_initRegionManager:function(){this._regionManager=new e.RegionManager,this.listenTo(this._regionManager,"region:add",function(a,b){this[a]=b}),this.listenTo(this._regionManager,"region:remove",function(a){delete this[a]})}}),e.Application.extend=e.extend,e.Module=function(a,b,d){this.moduleName=a,this.options=c.extend({},this.options,d),this.initialize=d.initialize||this.initialize,this.submodules={},this._setupInitializersAndFinalizers(),this.app=b,this.startWithParent=!0,this.triggerMethod=e.triggerMethod,c.isFunction(this.initialize)&&this.initialize(this.options,a,b)},e.Module.extend=e.extend,c.extend(e.Module.prototype,b.Events,{initialize:function(){},addInitializer:function(a){this._initializerCallbacks.add(a)},addFinalizer:function(a){this._finalizerCallbacks.add(a)},start:function(a){this._isInitialized||(c.each(this.submodules,function(b){b.startWithParent&&b.start(a)}),this.triggerMethod("before:start",a),this._initializerCallbacks.run(a,this),this._isInitialized=!0,this.triggerMethod("start",a))},stop:function(){this._isInitialized&&(this._isInitialized=!1,e.triggerMethod.call(this,"before:stop"),c.each(this.submodules,function(a){a.stop()}),this._finalizerCallbacks.run(void 0,this),this._initializerCallbacks.reset(),this._finalizerCallbacks.reset(),e.triggerMethod.call(this,"stop"))},addDefinition:function(a,b){this._runModuleDefinition(a,b)},_runModuleDefinition:function(a,d){if(a){var f=c.flatten([this,this.app,b,e,e.$,c,d]);a.apply(this,f)}},_setupInitializersAndFinalizers:function(){this._initializerCallbacks=new e.Callbacks,this._finalizerCallbacks=new e.Callbacks}}),c.extend(e.Module,{create:function(a,b,d){var e=a,g=f.call(arguments);g.splice(0,3),b=b.split(".");var h=b.length,i=[];return i[h-1]=d,c.each(b,function(b,c){var f=e;e=this._getModule(f,b,a,d),this._addModuleDefinition(f,e,i[c],g)},this),e},_getModule:function(a,b,d,e){var f=c.extend({},e),g=this.getClass(e),h=a[b];return h||(h=new g(b,d,f),a[b]=h,a.submodules[b]=h),h},getClass:function(a){var b=e.Module;return a?a.prototype instanceof b?a:a.moduleClass||b:b},_addModuleDefinition:function(a,b,c,d){var e=this._getDefine(c),f=this._getStartWithParent(c,b);e&&b.addDefinition(e,d),this._addStartWithParent(a,b,f)},_getStartWithParent:function(a,b){var d;return c.isFunction(a)&&a.prototype instanceof e.Module?(d=b.constructor.prototype.startWithParent,c.isUndefined(d)?!0:d):c.isObject(a)?(d=a.startWithParent,c.isUndefined(d)?!0:d):!0},_getDefine:function(a){return!c.isFunction(a)||a.prototype instanceof e.Module?c.isObject(a)?a.define:null:a},_addStartWithParent:function(a,b,c){b.startWithParent=b.startWithParent&&c,b.startWithParent&&!b.startWithParentIsConfigured&&(b.startWithParentIsConfigured=!0,a.addInitializer(function(a){b.startWithParent&&b.start(a)}))}}),e}(this,Backbone,_),TAFFY,exports,T;!function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w;if(!TAFFY)for(e="2.7",f=1,g="000000",h=1e3,i={},j=function(a){return TAFFY.isArray(a)||TAFFY.isObject(a)?a:JSON.parse(a)},s=function(a,b){return t(a,function(a){return b.indexOf(a)>=0})},t=function(a,b,c){var d=[];return null==a?d:Array.prototype.filter&&a.filter===Array.prototype.filter?a.filter(b,c):(k(a,function(a,e,f){b.call(c,a,e,f)&&(d[d.length]=a)}),d)},w=function(a){return"[object RegExp]"===Object.prototype.toString.call(a)},v=function(a){var b=T.isArray(a)?[]:T.isObject(a)?{}:null;if(null===a)return a;for(var c in a)b[c]=w(a[c])?a[c].toString():T.isArray(a[c])||T.isObject(a[c])?v(a[c]):a[c];return b},u=function(a){var b=JSON.stringify(a);return null===b.match(/regex/)?b:JSON.stringify(v(a))},k=function(a,b,c){var d,e,f,g;if(a&&(T.isArray(a)&&1===a.length||!T.isArray(a)))b(T.isArray(a)?a[0]:a,0);else for(f=0,a=T.isArray(a)?a:[a],g=a.length;g>f&&(e=a[f],T.isUndefined(e)&&!c||(d=b(e,f),d!==T.EXIT));f++);},l=function(a,b){var c,d,e=0;for(d in a)if(a.hasOwnProperty(d)&&(c=b(a[d],d,e++),c===T.EXIT))break},i.extend=function(a,b){i[a]=function(){return b.apply(this,arguments)}},m=function(a){var b;return T.isString(a)&&/[t][0-9]*[r][0-9]*/i.test(a)?!0:T.isObject(a)&&a.___id&&a.___s?!0:T.isArray(a)?(b=!0,k(a,function(a){return m(a)?void 0:(b=!1,TAFFY.EXIT)}),b):!1},o=function(a,b){var c=!0;return k(b,function(b){switch(T.typeOf(b)){case"function":if(!b.apply(a))return c=!1,TAFFY.EXIT;break;case"array":c=1===b.length?o(a,b[0]):2===b.length?o(a,b[0])||o(a,b[1]):3===b.length?o(a,b[0])||o(a,b[1])||o(a,b[2]):4===b.length?o(a,b[0])||o(a,b[1])||o(a,b[2])||o(a,b[3]):!1,b.length>4&&k(b,function(b){o(a,b)&&(c=!0)})}}),c},n=function(a){var b=[];return T.isString(a)&&/[t][0-9]*[r][0-9]*/i.test(a)&&(a={___id:a}),T.isArray(a)?(k(a,function(a){b.push(n(a))}),a=function(){var a=this,c=!1;return k(b,function(b){o(a,b)&&(c=!0)}),c}):T.isObject(a)?(T.isObject(a)&&a.___id&&a.___s&&(a={___id:a.___id}),l(a,function(a,c){T.isObject(a)||(a={is:a}),l(a,function(a,d){var e,f=[];e="hasAll"===d?function(a,b){b(a)}:k,e(a,function(a){var b,e=!0;b=function(){var b,f=this[c],g="==",h="!=",i="===",j="<",k=">",l="<=",m=">=",n="!==";return"undefined"==typeof f?!1:(0===d.indexOf("!")&&d!==h&&d!==n&&(e=!1,d=d.substring(1,d.length)),b="regex"===d?a.test(f):"lt"===d||d===j?a>f:"gt"===d||d===k?f>a:"lte"===d||d===l?a>=f:"gte"===d||d===m?f>=a:"left"===d?0===f.indexOf(a):"leftnocase"===d?0===f.toLowerCase().indexOf(a.toLowerCase()):"right"===d?f.substring(f.length-a.length)===a:"rightnocase"===d?f.toLowerCase().substring(f.length-a.length)===a.toLowerCase():"like"===d?f.indexOf(a)>=0:"likenocase"===d?f.toLowerCase().indexOf(a.toLowerCase())>=0:d===i||"is"===d?f===a:d===g?f==a:d===n?f!==a:d===h?f!=a:"isnocase"===d?f.toLowerCase?f.toLowerCase()===a.toLowerCase():f===a:"has"===d?T.has(f,a):"hasall"===d?T.hasAll(f,a):"contains"===d?TAFFY.isArray(f)&&f.indexOf(a)>-1:-1!==d.indexOf("is")||TAFFY.isNull(f)||TAFFY.isUndefined(f)||TAFFY.isObject(a)||TAFFY.isArray(a)?T[d]&&T.isFunction(T[d])&&0===d.indexOf("is")?T[d](f)===a:T[d]&&T.isFunction(T[d])?T[d](f,a):!1:a===f[d],b=b&&!e?!1:b||e?b:!0)},f.push(b)}),b.push(1===f.length?f[0]:function(){var a=this,b=!1;return k(f,function(c){c.apply(a)&&(b=!0)}),b})})}),a=function(){var a=this,c=!0;return c=(1!==b.length||b[0].apply(a))&&(2!==b.length||b[0].apply(a)&&b[1].apply(a))&&(3!==b.length||b[0].apply(a)&&b[1].apply(a)&&b[2].apply(a))&&(4!==b.length||b[0].apply(a)&&b[1].apply(a)&&b[2].apply(a)&&b[3].apply(a))?!0:!1,b.length>4&&k(b,function(b){o(a,b)||(c=!1)}),c}):T.isFunction(a)?a:void 0},q=function(a,b){var c=function(a,c){var d=0;return T.each(b,function(b){var e,f,g,h,i;if(e=b.split(" "),f=e[0],g=1===e.length?"logical":e[1],"logical"===g)h=p(a[f]),i=p(c[f]),T.each(h.length<=i.length?h:i,function(a,b){return h[b]<i[b]?(d=-1,TAFFY.EXIT):h[b]>i[b]?(d=1,TAFFY.EXIT):void 0});else if("logicaldesc"===g)h=p(a[f]),i=p(c[f]),T.each(h.length<=i.length?h:i,function(a,b){return h[b]>i[b]?(d=-1,TAFFY.EXIT):h[b]<i[b]?(d=1,TAFFY.EXIT):void 0});else{if("asec"===g&&a[f]<c[f])return d=-1,T.EXIT;if("asec"===g&&a[f]>c[f])return d=1,T.EXIT;if("desc"===g&&a[f]>c[f])return d=-1,T.EXIT;if("desc"===g&&a[f]<c[f])return d=1,T.EXIT}return 0===d&&"logical"===g&&h.length<i.length?d=-1:0===d&&"logical"===g&&h.length>i.length?d=1:0===d&&"logicaldesc"===g&&h.length>i.length?d=-1:0===d&&"logicaldesc"===g&&h.length<i.length&&(d=1),0!==d?T.EXIT:void 0}),d};return a&&a.push?a.sort(c):a},function(){var a={},b=0;p=function(c){return b>h&&(a={},b=0),a["_"+c]||function(){var d,e,f,g=String(c),h=[],i="_",j="";for(d=0,e=g.length;e>d;d++)f=g.charCodeAt(d),f>=48&&57>=f||46===f?("n"!==j&&(j="n",h.push(i.toLowerCase()),i=""),i+=g.charAt(d)):("s"!==j&&(j="s",h.push(parseFloat(i)),i=""),i+=g.charAt(d));return h.push("n"===j?parseFloat(i):i.toLowerCase()),h.shift(),a["_"+c]=h,b++,h}()}}(),r=function(){this.context({results:this.getDBI().query(this.context())})},i.extend("filter",function(){var a=TAFFY.mergeObj(this.context(),{run:null}),b=[];return k(a.q,function(a){b.push(a)}),a.q=b,k(arguments,function(b){a.q.push(n(b)),a.filterRaw.push(b)}),this.getroot(a)}),i.extend("order",function(a){a=a.split(",");var b,c=[];return k(a,function(a){c.push(a.replace(/^\s*/,"").replace(/\s*$/,""))}),b=TAFFY.mergeObj(this.context(),{sort:null}),b.order=c,this.getroot(b)}),i.extend("limit",function(a){var b,c=TAFFY.mergeObj(this.context(),{});return c.limit=a,c.run&&c.sort&&(b=[],k(c.results,function(c,d){return d+1>a?TAFFY.EXIT:void b.push(c)}),c.results=b),this.getroot(c)}),i.extend("start",function(a){var b,c=TAFFY.mergeObj(this.context(),{});return c.start=a,c.run&&c.sort&&!c.limit?(b=[],k(c.results,function(c,d){d+1>a&&b.push(c)}),c.results=b):c=TAFFY.mergeObj(this.context(),{run:null,start:a}),this.getroot(c)}),i.extend("update",function(a,b,c){var d,e=!0,f={},g=arguments;return!TAFFY.isString(a)||2!==arguments.length&&3!==arguments.length?(f=a,2===g.length&&(e=b)):(f[a]=b,3===arguments.length&&(e=c)),d=this,r.call(this),k(this.context().results,function(a){var b=f;TAFFY.isFunction(b)?b=b.apply(TAFFY.mergeObj(a,{})):T.isFunction(b)&&(b=b(TAFFY.mergeObj(a,{}))),TAFFY.isObject(b)&&d.getDBI().update(a.___id,b,e)}),this.context().results.length&&this.context({run:null}),this}),i.extend("remove",function(a){var b=this,c=0;return r.call(this),k(this.context().results,function(a){b.getDBI().remove(a.___id),c++}),this.context().results.length&&(this.context({run:null}),b.getDBI().removeCommit(a)),c}),i.extend("count",function(){return r.call(this),this.context().results.length}),i.extend("callback",function(a,b){if(a){var c=this;setTimeout(function(){r.call(c),a.call(c.getroot(c.context()))},b||0)}return null}),i.extend("get",function(){return r.call(this),this.context().results}),i.extend("stringify",function(){return JSON.stringify(this.get())}),i.extend("first",function(){return r.call(this),this.context().results[0]||!1}),i.extend("last",function(){return r.call(this),this.context().results[this.context().results.length-1]||!1}),i.extend("sum",function(){var a=0,b=this;return r.call(b),k(arguments,function(c){k(b.context().results,function(b){a+=b[c]||0})}),a}),i.extend("min",function(a){var b=null;return r.call(this),k(this.context().results,function(c){(null===b||c[a]<b)&&(b=c[a])}),b}),function(){var a=function(){var a,b,c;return a=function(a,b,c){var d,e,f;switch(2===c.length?(d=a[c[0]],f="===",e=b[c[1]]):(d=a[c[0]],f=c[1],e=b[c[2]]),f){case"===":return d===e;case"!==":return d!==e;case"<":return e>d;case">":return d>e;case"<=":return e>=d;case">=":return d>=e;case"==":return d==e;case"!=":return d!=e;default:throw String(f)+" is not supported"}},b=function(a,b){var c,d,e={};for(c in a)a.hasOwnProperty(c)&&(e[c]=a[c]);for(c in b)b.hasOwnProperty(c)&&"___id"!==c&&"___s"!==c&&(d=TAFFY.isUndefined(e[c])?"":"right_",e[d+String(c)]=b[c]);return e},c=function(c){var d,e,f=arguments,g=f.length,h=[];if("function"!=typeof c.filter){if(!c.TAFFY)throw"TAFFY DB or result not supplied";d=c()}else d=c;return this.context({results:this.getDBI().query(this.context())}),TAFFY.each(this.context().results,function(c){d.each(function(d){var i,j=!0;a:for(e=1;g>e&&(i=f[e],j="function"==typeof i?i(c,d):"object"==typeof i&&i.length?a(c,d,i):!1,j);e++);j&&h.push(b(c,d))})}),TAFFY(h)()}}();i.extend("join",a)}(),i.extend("max",function(a){var b=null;return r.call(this),k(this.context().results,function(c){(null===b||c[a]>b)&&(b=c[a])}),b}),i.extend("select",function(){var a=[],b=arguments;return r.call(this),1===arguments.length?k(this.context().results,function(c){a.push(c[b[0]])}):k(this.context().results,function(c){var d=[];k(b,function(a){d.push(c[a])}),a.push(d)}),a}),i.extend("distinct",function(){var a=[],b=arguments;return r.call(this),1===arguments.length?k(this.context().results,function(c){var d=c[b[0]],e=!1;k(a,function(a){return d===a?(e=!0,TAFFY.EXIT):void 0}),e||a.push(d)}):k(this.context().results,function(c){var d=[],e=!1;k(b,function(a){d.push(c[a])}),k(a,function(a){var c=!0;return k(b,function(b,e){return d[e]!==a[e]?(c=!1,TAFFY.EXIT):void 0}),c?(e=!0,TAFFY.EXIT):void 0}),e||a.push(d)}),a}),i.extend("supplant",function(a,b){var c=[];return r.call(this),k(this.context().results,function(b){c.push(a.replace(/\{([^\{\}]*)\}/g,function(a,c){var d=b[c];return"string"==typeof d||"number"==typeof d?d:a}))}),b?c:c.join("")}),i.extend("each",function(a){return r.call(this),k(this.context().results,a),this}),i.extend("map",function(a){var b=[];return r.call(this),k(this.context().results,function(c){b.push(a(c))}),b}),T=function(a){var b,c,d,e=[],h={},p=1,r={template:!1,onInsert:!1,onUpdate:!1,onRemove:!1,onDBChange:!1,storageName:!1,forcePropertyCase:null,cacheSize:100,name:""},s=new Date,t=0,v=0,w={};return c=function(a){var b=[],d=!1;return 0===a.length?e:(k(a,function(a){T.isString(a)&&/[t][0-9]*[r][0-9]*/i.test(a)&&e[h[a]]&&(b.push(e[h[a]]),d=!0),T.isObject(a)&&a.___id&&a.___s&&e[h[a.___id]]&&(b.push(e[h[a.___id]]),d=!0),T.isArray(a)&&k(a,function(a){k(c(a),function(a){b.push(a)})})}),d&&b.length>1&&(b=[]),b)},b={dm:function(a){return a&&(s=a,w={},t=0,v=0),r.onDBChange&&setTimeout(function(){r.onDBChange.call(e)},0),r.storageName&&setTimeout(function(){localStorage.setItem("taffy_"+r.storageName,JSON.stringify(e))}),s},insert:function(a,c){var i=[],m=[],n=j(a);return k(n,function(a,d){var j,n;return T.isArray(a)&&0===d?(k(a,function(a){i.push("lower"===r.forcePropertyCase?a.toLowerCase():"upper"===r.forcePropertyCase?a.toUpperCase():a)}),!0):(T.isArray(a)?(j={},k(a,function(a,b){j[i[b]]=a}),a=j):T.isObject(a)&&r.forcePropertyCase&&(n={},l(a,function(b,c){n["lower"===r.forcePropertyCase?c.toLowerCase():"upper"===r.forcePropertyCase?c.toUpperCase():c]=a[c]}),a=n),p++,a.___id="T"+String(g+f).slice(-6)+"R"+String(g+p).slice(-6),a.___s=!0,m.push(a.___id),r.template&&(a=T.mergeObj(r.template,a)),e.push(a),h[a.___id]=e.length-1,r.onInsert&&(c||TAFFY.isUndefined(c))&&r.onInsert.call(a),void b.dm(new Date))}),d(m)},sort:function(a){return e=q(e,a.split(",")),h={},k(e,function(a,b){h[a.___id]=b}),b.dm(new Date),!0},update:function(a,c,d){var f,g,i,j,k={};r.forcePropertyCase&&(l(c,function(a,b){k["lower"===r.forcePropertyCase?b.toLowerCase():"upper"===r.forcePropertyCase?b.toUpperCase():b]=a}),c=k),f=e[h[a]],g=T.mergeObj(f,c),i={},j=!1,l(g,function(a,b){(TAFFY.isUndefined(f[b])||f[b]!==a)&&(i[b]=a,j=!0)}),j&&(r.onUpdate&&(d||TAFFY.isUndefined(d))&&r.onUpdate.call(g,e[h[a]],i),e[h[a]]=g,b.dm(new Date))},remove:function(a){e[h[a]].___s=!1},removeCommit:function(a){var c;for(c=e.length-1;c>-1;c--)e[c].___s||(r.onRemove&&(a||TAFFY.isUndefined(a))&&r.onRemove.call(e[c]),h[e[c].___id]=void 0,e.splice(c,1));h={},k(e,function(a,b){h[a.___id]=b}),b.dm(new Date)},query:function(a){var d,f,g,h,i,j;if(r.cacheSize&&(f="",k(a.filterRaw,function(a){return T.isFunction(a)?(f="nocache",TAFFY.EXIT):void 0}),""===f&&(f=u(T.mergeObj(a,{q:!1,run:!1,sort:!1})))),!a.results||!a.run||a.run&&b.dm()>a.run){if(g=[],r.cacheSize&&w[f])return w[f].i=t++,w[f].results;0===a.q.length&&0===a.index.length?(k(e,function(a){g.push(a)}),d=g):(h=c(a.index),k(h,function(b){(0===a.q.length||o(b,a.q))&&g.push(b)}),d=g)}else d=a.results;return!(a.order.length>0)||a.run&&a.sort||(d=q(d,a.order)),d.length&&(a.limit&&a.limit<d.length||a.start)&&(i=[],k(d,function(b,c){if(!a.start||a.start&&c+1>=a.start)if(a.limit){if(j=a.start?c+1-a.start:c,j<a.limit)i.push(b);else if(j>a.limit)return TAFFY.EXIT}else i.push(b)}),d=i),r.cacheSize&&"nocache"!==f&&(v++,setTimeout(function(){var a,b;v>=2*r.cacheSize&&(v=0,a=t-r.cacheSize,b={},l(function(c,d){c.i>=a&&(b[d]=c)}),w=b)},0),w[f]={i:t++,results:d}),d}},d=function(){var a,c;return a=TAFFY.mergeObj(TAFFY.mergeObj(i,{insert:void 0}),{getDBI:function(){return b},getroot:function(a){return d.call(a)},context:function(a){return a&&(c=TAFFY.mergeObj(c,a.hasOwnProperty("results")?TAFFY.mergeObj(a,{run:new Date,sort:new Date}):a)),c},extend:void 0}),c=this&&this.q?this:{limit:!1,start:!1,q:[],filterRaw:[],index:[],order:[],results:!1,run:null,sort:null,settings:r},k(arguments,function(a){m(a)?c.index.push(a):c.q.push(n(a)),c.filterRaw.push(a)}),a},f++,a&&b.insert(a),d.insert=b.insert,d.merge=function(a,c,e){var f={},g=[],h={};return e=e||!1,c=c||"id",k(a,function(a){var h;f[c]=a[c],g.push(a[c]),h=d(f).first(),h?b.update(h.___id,a,e):b.insert(a,e)}),h[c]=g,d(h)},d.TAFFY=!0,d.sort=b.sort,d.settings=function(a){return a&&(r=TAFFY.mergeObj(r,a),a.template&&d().update(a.template)),r},d.store=function(a){var b,c=!1;return localStorage&&(a&&(b=localStorage.getItem("taffy_"+a),b&&b.length>0&&(d.insert(b),c=!0),e.length>0&&setTimeout(function(){localStorage.setItem("taffy_"+r.storageName,JSON.stringify(e))})),d.settings({storageName:a})),d},d},TAFFY=T,T.each=k,T.eachin=l,T.extend=i.extend,TAFFY.EXIT="TAFFYEXIT",TAFFY.mergeObj=function(a,b){var c={};return l(a,function(b,d){c[d]=a[d]}),l(b,function(a,d){c[d]=b[d]}),c},TAFFY.has=function(a,b){var c,d=!1;if(a.TAFFY)return d=a(b),d.length>0?!0:!1;switch(T.typeOf(a)){case"object":if(T.isObject(b))l(b,function(c,e){return d!==!0||T.isUndefined(a[e])||!a.hasOwnProperty(e)?(d=!1,TAFFY.EXIT):void(d=T.has(a[e],b[e]))});else if(T.isArray(b))k(b,function(c,e){return d=T.has(a,b[e]),d?TAFFY.EXIT:void 0});else if(T.isString(b))return TAFFY.isUndefined(a[b])?!1:!0;return d;case"array":if(T.isObject(b))k(a,function(c,e){return d=T.has(a[e],b),d===!0?TAFFY.EXIT:void 0});else if(T.isArray(b))k(b,function(c,e){return k(a,function(c,f){return d=T.has(a[f],b[e]),d===!0?TAFFY.EXIT:void 0}),d===!0?TAFFY.EXIT:void 0});else if(T.isString(b)||T.isNumber(b))for(d=!1,c=0;c<a.length;c++)if(d=T.has(a[c],b))return!0;return d;case"string":if(T.isString(b)&&b===a)return!0;break;default:if(T.typeOf(a)===T.typeOf(b)&&a===b)return!0}return!1},TAFFY.hasAll=function(a,b){var c,d=TAFFY;return d.isArray(b)?(c=!0,k(b,function(b){return c=d.has(a,b),c===!1?TAFFY.EXIT:void 0}),c):d.has(a,b)},TAFFY.typeOf=function(a){var b=typeof a;return"object"===b&&(a?"number"!=typeof a.length||a.propertyIsEnumerable("length")||(b="array"):b="null"),b},TAFFY.getObjectKeys=function(a){var b=[];return l(a,function(a,c){b.push(c)}),b.sort(),b},TAFFY.isSameArray=function(a,b){return TAFFY.isArray(a)&&TAFFY.isArray(b)&&a.join(",")===b.join(",")?!0:!1},TAFFY.isSameObject=function(a,b){var c=TAFFY,d=!0;return c.isObject(a)&&c.isObject(b)&&c.isSameArray(c.getObjectKeys(a),c.getObjectKeys(b))?l(a,function(e,f){return c.isObject(a[f])&&c.isObject(b[f])&&c.isSameObject(a[f],b[f])||c.isArray(a[f])&&c.isArray(b[f])&&c.isSameArray(a[f],b[f])||a[f]===b[f]?void 0:(d=!1,TAFFY.EXIT)}):d=!1,d},a=["String","Number","Object","Array","Boolean","Null","Function","Undefined"],b=function(a){return function(b){return TAFFY.typeOf(b)===a.toLowerCase()?!0:!1}},c=0;c<a.length;c++)d=a[c],TAFFY["is"+d]=b(d)}(),"object"==typeof exports&&(exports.taffy=TAFFY),Handlebars.registerHelper("when",function(a,b){var c=new RegExp(b.hash.match);return c.test(a)?b.fn(this):b.inverse(this)}),Handlebars.registerHelper("currency",function(a){return parseFloat(a).toFixed(2).toString().replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,")}),Backbone.Marionette.TemplateCache.prototype.compileTemplate=function(a){return Handlebars.compile(a)},Backbone.Marionette.CompositeView.prototype.mixinTemplateHelpers=function(a){var b=this,c=Marionette.getOption(b,"templateHelpers"),d={};return a=a||{},_.isFunction(c)&&(c=c.call(b)),_.each(c,function(a,c){d[c]=_.isFunction(a)?a.call(b):a}),_.extend(a,d)},Store=function(a,b){"use strict";var c=new b.Application;return c.addInitializer(function(a){c.config=$.extend(!0,{configurator:{collapseOnScollLimit:50}},a.config),c.config.debug&&c.vent.on("all",function(a){console.info("[[APP.VENT]]: ",a,arguments)}),c.db={added:{},available:{}}}),c.on("initialize:after",function(){a.history&&a.history.start()}),c}(Backbone,Marionette,WOS),Store.module("CondimentsApp.AddedCondiments",function(a,b){"use strict";var c={update:function(b,c,d){a.Controller.update(b,c,d)}};a.addInitializer(function(){b.vent.on("addedcondiments:quantitychange",c.update)})},WOS),Store.module("CondimentsApp.AddedCondiments",function(a,b){"use strict";a.Controller={update:function(a,c,d){b.commands.execute("addedcondiments:entity:update",a,c,d)}}},WOS),Store.module("CondimentsApp.AvailableCondiments",function(a,b){"use strict";var c={list:function(b){a.Controller.list(b)}};a.addInitializer(function(){b.vent.on("condiments:loaded",c.list)})},WOS),Store.module("CondimentsApp.AvailableCondiments",function(a,b,c,d,e,f){"use strict";a.Controller={list:function(a){var c=f.bind(function(c,d){var e=this._getView(c,d);e.on("addedcondiments:quantitychange",function(a,c,d,e){b.vent.trigger("addedcondiments:quantitychange",c,d,e)}),a.availableItemsRegion.show(e)},this);e.when(b.request("addedcondiments:entity:findAll"),b.request("availablecondiments:entity:findAll")).then(c)},_getView:function(b,c){return new a.ListView({collection:c,addedCondimentsCollection:b})}}},WOS),Store.module("CondimentsApp.AvailableCondiments",function(a,b,c,d,e,f,g){"use strict";a.ItemView=d.ItemView.extend({tagName:"tr",template:"#productset-template",events:{"click .action-decrease":"changeQuantity","click .action-increase":"changeQuantity","change .form-control":"changeQuantity"},ui:{quantityinput:".form-control"},onShow:function(){g.Components.QuantityInput.init(this.$el),this.updateQuantity(null,this.options.addedCondimentsCollection)},initialize:function(){this.listenTo(this.options.addedCondimentsCollection,"add remove",this.updateQuantity)},changeQuantity:function(){var a=this.ui.quantityinput,b=parseInt(a.data("oldvalue"),10),c=parseInt(a.data("newvalue"),10),d=c-b,e=c;this.$el.toggleClass("selected",!!e),this.trigger("quantitychange",this.model,d,e)},updateQuantity:function(a,b){var c=b.where({productCode:this.model.get("productCode")}),d=c.length;this.ui.quantityinput.val(d),this.ui.quantityinput.data("newvalue",d),this.ui.quantityinput.data("oldvalue",d),this.$el.toggleClass("selected",!!d)}}),a.ListView=d.CompositeView.extend({template:"#productsets-template",itemView:a.ItemView,itemViewEventPrefix:"addedcondiments",itemViewContainer:"tbody",itemViewOptions:function(){return{addedCondimentsCollection:this.options.addedCondimentsCollection}}})},WOS),Store.module("CondimentsApp",function(a,b,c,d){"use strict";var e=d.AppRouter.extend({appRoutes:{"choose-condiments":"chooseCondiments"}}),f={chooseCondiments:function(){a.Controller.chooseCondiments()}};a.addInitializer(function(){b.addInitializer(function(){new e({controller:f}),b.addRegions({menuRegion:"#food-menu",productCardsRegion:"#product-cards",configuratorRegion:"#product-configurator",orderWidgetRegion:"#order-widget",choicesModalsRegion:"#modals-choices"}),b.commands.execute("availablecondiments:entity:reset"),b.commands.execute("addedcondiments:entity:reset")}),b.vent.on("condiments:closed",function(){b.commands.execute("addedcondiments:entity:reset"),b.commands.execute("availablecondiments:entity:reset")}),b.vent.trigger("app:started","condiments")})},WOS),Store.module("CondimentsApp",function(a,b,c,d,e,f){"use strict";a.Controller={chooseCondiments:function(){var a=f.bind(this._showView,this);
b.vent.trigger("app:loading:start"),e.when(b.request("addedcondiments:entity:findAll"),b.request("availablecondiments:entity:findAll")).then(a).always(function(){b.vent.trigger("app:loading:end")})},cancelOrder:function(a){b.vent.trigger("condiments:cancelorder",a),this._hideView()},saveOrder:function(a){var d=f.bind(function(){c.history.navigate(""),b.vent.trigger("condiments:saveorder",a),location.reload()},this);b.vent.trigger("app:loading:start"),e.when(b.request("addedcondiments:save")).then(d)},_showView:function(c,d){if(d.length){var e=new a.View({addedCondimentsCollection:c,isNewOrder:!c.length});e.on("condiments:loaded",function(a){b.vent.trigger("condiments:loaded",a)}),e.on("condiments:cancelorder",f.bind(a.Controller.cancelOrder,this)),e.on("condiments:saveorder",f.bind(a.Controller.saveOrder,this)),b.configuratorRegion.show(e)}},_hideView:function(){b.configuratorRegion.close(),c.history.navigate(""),b.vent.trigger("condiments:closed")}}},WOS),Store.module("CondimentsApp",function(a,b,c,d,e,f,g){"use strict";a.View=d.Layout.extend({template:"#condiments-configurator-template",templateHelpers:function(){return{isNewOrder:this.options.isNewOrder}},regions:{availableItemsRegion:"#available-sets"},ui:{header:".configurator-header",body:".configurator-body",footer:".configurator-footer",quantity:".added-quantity",btnSave:".action-saveorder"},triggers:{"click .action-cancel":"condiments:cancelorder","click .action-saveorder":"condiments:saveorder"},initialize:function(){this.listenTo(this.options.addedCondimentsCollection,"add remove reset",this.updateQuantity),this.listenTo(this.options.addedCondimentsCollection,"add remove reset",this.toggleSaveButton)},onShow:function(){e("body").addClass("show-configurator show-condiments-configurator"),e(window).on("scroll.configurator",f.bind(this.onScroll,this)),document.body.scrollTop=document.documentElement.scrollTop=0,this.updateQuantity(),this.toggleSaveButton(),this.trigger("condiments:loaded",this)},onClose:function(){e("body").removeClass("show-configurator show-condiments-configurator"),e(window).off("scroll.configurator")},onScroll:g.Poll(function(){var a=e(window).scrollTop();this.ui.header[a<b.config.configurator.collapseOnScollLimit?"removeClass":"addClass"]("collapsed"),this.ui.body[a<b.config.configurator.collapseOnScollLimit?"removeClass":"addClass"]("expanded")},25),updateQuantity:function(){this.ui.quantity.text(this.options.addedCondimentsCollection.length)},toggleSaveButton:function(){this.ui.btnSave[this.options.addedCondimentsCollection.length?"removeClass":"addClass"]("disabled"),this.ui.btnSave.prop("disabled",!this.options.addedCondimentsCollection.length)}})},WOS),Store.module("ConfiguratorApp.AddedMeals",function(a,b){"use strict";var c={list:function(b){a.Controller.list(b)},update:function(b,c,d){a.Controller.update(b,c,d)}};a.addInitializer(function(){b.vent.on("configurator:loaded",c.list),b.vent.on("addedmeals:quantitychange",c.update)})},WOS),Store.module("ConfiguratorApp.AddedMeals",function(a,b,c,d,e,f){"use strict";a.Controller={list:function(a){var c=f.bind(function(c){var d=this._getView(c);d.on("addedmeals:meal:removed",function(a,c){b.vent.trigger("addedmeals:meal:removed",a,c)}),d.on("addedmeals:view:loaded",function(a){b.vent.trigger("addedmeals:view:loaded",a)}),d.on("addedmeals:view:customization:view:selectionchanged",function(a){b.vent.trigger("addedmeals:view:customization:view:selectionchanged",a)}),a.addedItemsRegion.show(d)},this);e.when(b.request("addedmeals:entity:findAll")).then(c)},update:function(a,c,d){b.commands.execute("addedmeals:entity:update",a,c,d)},_getView:function(b){return new a.ListView({collection:b})}}},WOS),Store.module("ConfiguratorApp.AddedMeals",function(a,b,c,d,e,f,g){"use strict";a.ItemView=d.Layout.extend({className:"selected-meal-item",template:"#addedset-template",regions:{componentsRegion:".components-column",choicesRegion:".choices-column",customizeRegion:".meal-customization",customizeDetailsRegion:".customization-details"},ui:{toggleCustomization:".action-customize",header:".header-info-column"},initialize:function(){this.customising=!1},events:{"click .action-delete":"destroy","click .action-customize":"toggleCustomization"},onShow:function(){this.trigger("loaded"),g.Components.Popovers.init(this.ui.header)},destroy:function(a){a.preventDefault(),this.model.destroy()},toggleCustomization:function(){this[this.customizing?"hideCustomization":"showCustomization"](),this.customizing=!this.customizing},showCustomization:function(){this.$el.addClass("selected-meal-expanded"),this.ui.toggleCustomization.find("span").text(this.ui.toggleCustomization.data("expanded-text"))},hideCustomization:function(){this.$el.removeClass("selected-meal-expanded"),this.ui.toggleCustomization.find("span").text(this.ui.toggleCustomization.data("collapsed-text"))}}),a.EmptyView=d.ItemView.extend({template:"#addedsetempty-template"}),a.ListView=d.CollectionView.extend({itemView:a.ItemView,emptyView:a.EmptyView,itemViewEventPrefix:"addedmeals:view",collectionEvents:{remove:"mealRemoved"},mealRemoved:function(a,b){this.trigger("addedmeals:meal:removed",a,b)}})},WOS),Store.module("ConfiguratorApp.AvailableChoices",function(a,b){"use strict";var c={list:function(b,c){a.Controller.list(b,c)}};a.addInitializer(function(){b.vent.on("addedmeals:choice:changing",function(a,b){c.list(a,b)})})},WOS),Store.module("ConfiguratorApp.AvailableChoices",function(a,b,c,d,e,f){"use strict";a.Controller={list:function(a,c){var d=f.bind(function(a,d){if("radioList"==d.displayType){var g=this._getRadioListView(d,a,c.model);g.on("availablechoices:view:hidden",g.close),g.on("availablechoices:choices:save",function(a,d,e){b.commands.execute("addedchoices:entity:update",a,d,e),c.view.trigger("changed")}),b.choicesModalsRegion.show(g)}else e.when(b.request("addedchoices:entity:findAllByListId",c.model)).then(f.bind(function(e){var f=this._getQuantityPickerListView(d,a,e,c.model);f.on("availablechoices:view:hidden",f.close),f.on("availablechoices:choices:save",function(a,d,e){b.commands.execute("addedchoices:entity:update",a,d,e),c.view.trigger("changed")}),b.choicesModalsRegion.show(f)},this))},this);b.vent.trigger("app:loading:start"),e.when(b.request("availablechoices:entity:findAll",c.model)).then(d).always(function(){b.vent.trigger("app:loading:end")})},_getRadioListView:function(b,c,d){return new a.RadioListView({collection:c,model:d,displayOptions:b})},_getQuantityPickerListView:function(b,c,d,e){return new a.QuantityPickerListView({collection:c,addedChoicesCollection:d,model:e,displayOptions:b})}}},WOS),Store.module("ConfiguratorApp.AvailableChoices",function(a,b,c,d,e,f,g){"use strict";a.RadioItemView=d.ItemView.extend({template:"#available-choice-template",triggers:{"ifChecked :radio":"selected"},ui:{radio:"input:radio",radioGroup:".radio"},onRender:function(){setTimeout(f.bind(function(){g.Forms.InputStates.init(this.ui.radioGroup)},this),1)},onShow:function(){this.model.get("productCode")==this.options.productCode&&this.ui.radio.iCheck("check")}}),a.RadioListView=d.CompositeView.extend({template:"#available-choices-template",templateHelpers:function(){return{columnsToDisplay:this.getColumnsToDisplay()}},className:"modal-available-choices modal fade",itemView:a.RadioItemView,itemViewOptions:function(){return{productCode:this.model.get("selectedSolutionCode")}},itemViewContainer:".available-choices-list",itemViewEventPrefix:"availablechoice",itemEvents:{selected:"onChoiceSelected"},events:{"click .btn-submit":"onSave"},ui:{radioGroups:".radio",choiceImage:".choice-image",dialog:".modal-dialog",choicesContainer:".available-choices-list"},initialize:function(){this.$el.on("hidden.bs.modal",f.bind(function(){this.trigger("availablechoices:view:hidden")},this))},onShow:function(){this.$el.modal("show")},onChoiceSelected:function(a,b,c){this.selectedChoice=c.model,this.ui.choiceImage.attr("src",c.model.get("images")[0].imageUrl)},onSave:function(a){if(a.preventDefault(),this.selectedChoice){var b=e.extend(!0,{},this.model.toJSON()),c={mealid:b.mealid,productCode:b.productCode,selectedSolutionCode:this.selectedChoice.get("productCode"),selectedSolutionCartName:this.selectedChoice.get("cartName"),selectedSolutionPath:this.selectedChoice.get("solutionPath"),selectedQuantity:1,included:this.selectedChoice.get("included"),addons:this.selectedChoice.get("addons"),choices:this.selectedChoice.get("choices"),components:this.selectedChoice.get("components")};this.trigger("availablechoices:choices:save",[c],b,!1)}this.$el.modal("hide")},getColumnsToDisplay:function(){var a=Math.ceil(this.collection.length/8);return a>3?3:a},appendHtml:function(a,b,c){for(var d=this.getItemViewContainer(a),f=this.getColumnsToDisplay(),g="col-xs-"+(12/f).toString(),h=Math.ceil(this.collection.length/f),i=0;f>i;i++){var j=d.find(".column-"+i);j.length||(j=e('<div class="choices-column '+g+" column-"+i+'"></div>')),d.append(j)}var k=Math.floor(c/h);d.find(".choices-column").eq(k).append(b.el)}}),a.QuantityPickerItemView=d.ItemView.extend({template:"#available-choice-quantity-picker-template",className:"col-xs-6",ui:{title:".product-title",quantityinput:".form-control",increase:".action-increase",decrease:".action-decrease"},triggers:{"click @ui.increase":"quantitychanged","click @ui.decrease":"quantitychanged","change @ui.quantityinput":"quantitychanged"},initialize:function(){this.listenTo(this.options.addedChoicesCollection,"add remove",this.updateQuantity)},onShow:function(){g.Components.QuantityInput.init(this.$el),this.updateQuantity(null,this.options.addedChoicesCollection)},adjustHeight:function(a){this.ui.title.css("height",a)},getHeight:function(){return this.ui.title.css("height","auto").innerHeight()},getQuantity:function(){return parseInt(this.ui.quantityinput.val(),10)},updateQuantity:function(a,b){var c=b.where({selectedSolutionCode:this.model.get("productCode")}),d=c.length;this.setQuantity(d)},setQuantity:function(a){this.ui.quantityinput.val(a),this.ui.quantityinput.data("newvalue",a),this.ui.quantityinput.data("oldvalue",a)},setNoSelection:function(a){this.setQuantity(0),this.ui.increase.prop("disabled",a),this.ui.decrease.prop("disabled",a),this.ui.quantityinput.prop("disabled",a),this.trigger("quantitychanged")}}),a.QuantityPickerListView=d.CompositeView.extend({itemView:a.QuantityPickerItemView,template:"#available-choices-quantity-picker-template",templateHelpers:{noSelection:function(){return this.options.displayOptions.noSelection},quantity:function(){var a=this.model.get("minQuantity"),b=this.model.get("maxQuantity");return a==b?a:[a,b].join(" - ")}},className:"modal-available-choices modal fade",itemViewContainer:".available-choices-list",itemViewEventPrefix:"availablechoice",itemViewOptions:function(){return{addedChoicesCollection:this.options.addedChoicesCollection}},initialize:function(){this.$el.on("hidden.bs.modal",f.bind(function(){this.trigger("availablechoices:view:hidden")},this)),this.selectNone=!1},ui:{selectNone:".clear-selection input:checkbox",instruction:".note .instruction",submitButton:".btn-submit",dialog:".modal-dialog"},itemEvents:{quantitychanged:"validate"},events:{"ifChanged @ui.selectNone":"clearSelection","click @ui.submitButton":"onSave"},onShow:function(){this.$el.on("shown.bs.modal.quantitypicker",f.bind(this.adjustHeight,this)).modal("show"),setTimeout(f.bind(function(){g.Forms.InputStates.init(this.ui.selectNone.parent())},this),1)},onClose:function(){this.$el.off("shown.bs.modal.quantitypicker")},adjustHeight:function(){var a=0;this.children.each(function(b){var c=b.getHeight();c>a&&(a=c)}),this.children.each(function(b){b.adjustHeight(a)})},clearSelection:function(a){var b=e(a.target).prop("checked");this.selectNone=b,this.children.each(function(a){a.setNoSelection(b)})},validate:function(){var a=0,b=this.model.get("minQuantity"),c=this.model.get("maxQuantity");this.children.each(function(b){a+=b.getQuantity()});var d=a>=b&&c>=a;return this.ui.instruction.toggleClass("error",!d),d||this.$el.animate({scrollTop:0}),d},onSave:function(a){a.preventDefault();var b=this.validate();if(b){var c=[],d=e.extend(!0,{},this.model.toJSON()),f=this.model.get("mealid"),g=this.model.get("productCode"),h=this.model.get("selectedSolutionPath");this.children.each(function(a){var b=a.getQuantity(),f={mealid:d.mealid,productCode:d.productCode,selectedSolutionCode:a.model.get("productCode"),selectedSolutionCartName:a.model.get("cartName"),selectedSolutionPath:a.model.get("solutionPath"),selectedQuantity:1,included:a.model.get("included"),addons:a.model.get("addons"),choices:a.model.get("choices"),components:a.model.get("components")};if(b)for(var g=0;b>g;g++)c.push(e.extend(!0,{},f))}),c.length||c.push({mealid:f,productCode:g,selectedSolutionCode:0,selectedSolutionCartName:this.options.displayOptions.noSelection,selectedSolutionPath:h.substring(0,h.lastIndexOf("|"))+"|null",selectedQuantity:0,included:[],addons:[]}),this.$el.modal("hide"),this.trigger("availablechoices:choices:save",c,d,!0)}}})},WOS),Store.module("ConfiguratorApp.AddedMeals.Choices",function(a,b){"use strict";var c={list:function(b){a.Controller.list(b)}};a.addInitializer(function(){b.vent.on("addedmeals:view:loaded addedmeals:choice:changed",function(a){setTimeout(function(){c.list(a)},50)})})},WOS),Store.module("ConfiguratorApp.AddedMeals.Choices",function(a,b,c,d,e,f){"use strict";a.Controller={list:function(a){var c=f.bind(function(c){var d=this._getView(c);d.on("addedmeals:choice:changing",function(a,c){b.vent.trigger("addedmeals:choice:changing",a,c)}),d.on("addedmeals:choice:changed",function(c,d){b.vent.trigger("addedmeals:choice:changed",a,c,d)}),a.choicesRegion.show(d)},this);e.when(b.request("addedchoices:entity:findAllByMeal",a.model)).then(c)},_getView:function(b){return new a.ListView({collection:b})}}},WOS),Store.module("ConfiguratorApp.AddedMeals.Choices",function(a,b,c,d){"use strict";a.ItemView=d.Layout.extend({template:"#addedset-choice-template",ui:{changeLink:".action-change"},regions:{availableChoices:".modal-available-choices"},triggers:{"click .action-change":"changing"},modelEvents:{change:"render onChanged"},onChanged:function(){this.trigger("changed")}}),a.ListView=d.CollectionView.extend({itemView:a.ItemView,className:"fooditem",itemViewEventPrefix:"addedmeals:choice"})},WOS),Store.module("ConfiguratorApp.AddedMeals.Components",function(a,b){"use strict";var c={list:function(b){a.Controller.list(b)}};a.addInitializer(function(){b.vent.on("addedmeals:view:loaded addedmeals:choice:changed",function(a){setTimeout(function(){c.list(a)},50)})})},WOS),Store.module("ConfiguratorApp.AddedMeals.Components",function(a,b,c,d,e,f){"use strict";a.Controller={list:function(a){if(a.model.get("components").length||a.model.get("choices").length){var c=f.bind(function(b){var c=this._getView(b);a.componentsRegion.show(c)},this);e.when(b.request("addedcomponents:entity:findAllByMeal",a.model)).then(c)}},_getView:function(b){return new a.ListView({collection:b})}}},WOS),Store.module("ConfiguratorApp.AddedMeals.Components",function(a,b,c,d){"use strict";a.ItemView=d.ItemView.extend({template:"#addedset-component-template",className:"fooditem"}),a.ListView=d.CollectionView.extend({itemView:a.ItemView})},WOS),Store.module("ConfiguratorApp.AddedMeals.Customization",function(a,b){"use strict";var c={list:function(b){a.Controller.list(b)}};a.addInitializer(function(){b.config.enableGrilling&&b.vent.on("addedmeals:view:loaded addedmeals:choice:changed",function(a){setTimeout(function(){c.list(a)},50)})})},WOS),Store.module("ConfiguratorApp.AddedMeals.Customization",function(a,b,c,d,e,f){"use strict";a.Controller={list:function(a){var c=f.bind(function(c){var d=this._getView(c);d.on("addedmeals:customization:view:loaded",function(a){b.vent.trigger("addedmeals:customization:view:loaded",a)}),d.on("addedmeals:customization:view:selectionchanged",function(){a.trigger("customization:view:selectionchanged")}),a.customizeRegion.show(d)},this);e.when(b.request("customizableitems:entity:findAllByMeal",a.model)).then(c)},_getView:function(b){return new a.ListView({collection:b})}}},WOS),Store.module("ConfiguratorApp.AddedMeals.Customization",function(a,b,c,d){"use strict";a.ItemView=d.Layout.extend({className:"customize-item",template:"#customize-item-template",regions:{includedRegion:".customization-options-included",addonsRegion:".customization-options-addons"},ui:{toggle:".item-toggle",body:".customize-item-body"},onShow:function(){this.trigger("loaded")},expand:function(){this.toggle(!0)},collapse:function(){this.toggle(!1)},toggle:function(a){this.ui.toggle[a?"removeClass":"addClass"]("collapsed"),this.ui.body[a?"addClass":"removeClass"]("in")}}),a.EmptyView=d.ItemView.extend({template:"#customize-items-empty-template"}),a.ListView=d.CompositeView.extend({itemView:a.ItemView,emptyView:a.EmptyView,template:"#customize-items-template",itemViewContainer:".customize-items",itemViewEventPrefix:"addedmeals:customization:view",onShow:function(){this.collection.length&&this.children.first().expand()}})},WOS),Store.module("ConfiguratorApp.AddedMeals.Customization.Options",function(a,b){"use strict";var c={list:function(b){a.Controller.list(b)}};a.addInitializer(function(){b.vent.on("addedmeals:customization:view:loaded",function(a){setTimeout(function(){c.list(a)},50)})})},WOS),Store.module("ConfiguratorApp.AddedMeals.Customization.Options",function(a,b,c,d,e,f){"use strict";a.Controller={list:function(a){var c=f.bind(function(b,c){var d=this._getView(b),e=this._getView(c);d.on("addedmeals:customization:options:view:selectionchanged",function(){a.trigger("selectionchanged")}),e.on("addedmeals:customization:options:view:selectionchanged",function(){a.trigger("selectionchanged")}),a.includedRegion.show(d),a.addonsRegion.show(e)},this);e.when(b.request("customizableitemoptions:entity:findAllByMealItem",a.model)).then(c)},_getView:function(b){return new a.ListView({collection:b})}}},WOS),Store.module("ConfiguratorApp.AddedMeals.Customization.Options",function(a,b,c,d,e,f,g){"use strict";a.ItemView=d.ItemView.extend({className:"customize-item-option",template:"#customize-item-option-template",ui:{select:"select"},events:{"change @ui.select":"onSelectionChanged"},onShow:function(){this.ui.select.val(this.model.get("selected")),g.Forms.CustomSelect.init(this.$el)},onClose:function(){g.Forms.CustomSelect.destroy(this.ui.select)},onSelectionChanged:function(){this.model.save({selected:this.ui.select.val()}),this.trigger("selectionchanged")}}),a.ListView=d.CollectionView.extend({itemView:a.ItemView,itemViewEventPrefix:"addedmeals:customization:options:view"})},WOS),Store.module("ConfiguratorApp.AddedMeals.Details",function(a,b){"use strict";var c={list:function(b){a.Controller.list(b)}};a.addInitializer(function(){b.config.enableGrilling&&b.vent.on("addedmeals:view:loaded addedmeals:choice:changed addedmeals:view:customization:view:selectionchanged",function(a){setTimeout(function(){c.list(a)},50)})})},WOS),Store.module("ConfiguratorApp.AddedMeals.Details",function(a,b,c,d,e,f){"use strict";a.Controller={list:function(a){var c=f.bind(function(c){var d=this._getView(c);d.on("addedmeals:details:view:loaded",function(a){b.vent.trigger("addedmeals:details:view:loaded",a)}),a.customizeDetailsRegion.show(d)},this);e.when(b.request("customizableitems:entity:findAllByMeal",a.model)).then(c)},_getView:function(b){return new a.ListView({collection:b})}}},WOS),Store.module("ConfiguratorApp.AddedMeals.Details",function(a,b,c,d){"use strict";a.ItemView=d.Layout.extend({template:"#customize-item-details-template",regions:{includedRegion:"span.options-included",addonsRegion:"span.options-addons"},onShow:function(){this.trigger("loaded")}}),a.EmptyView=d.ItemView.extend({template:"#customize-item-details-empty-template"}),a.ListView=d.CollectionView.extend({tagName:"span",itemView:a.ItemView,emptyView:a.EmptyView,itemViewEventPrefix:"addedmeals:details:view"})},WOS),Store.module("ConfiguratorApp.AddedMeals.Details.Options",function(a,b){"use strict";var c={list:function(b){a.Controller.list(b)}};a.addInitializer(function(){b.vent.on("addedmeals:details:view:loaded",function(a){setTimeout(function(){c.list(a)},50)})})},WOS),Store.module("ConfiguratorApp.AddedMeals.Details.Options",function(a,b,c,d,e,f){"use strict";a.Controller={list:function(a){var c=f.bind(function(b,c){var d=this._getView(b),e=this._getView(c);a.includedRegion.show(d),a.addonsRegion.show(e)},this);e.when(b.request("customizableitemoptions:entity:findAllByMealItem",a.model)).then(c)},_getView:function(b){return new a.ListView({collection:b})}}},WOS),Store.module("ConfiguratorApp.AddedMeals.Details.Options",function(a,b,c,d){"use strict";a.ItemView=d.ItemView.extend({template:"#customize-item-details-option-template",tagName:"span"}),a.ListView=d.CollectionView.extend({itemView:a.ItemView,tagName:"span"})},WOS),Store.module("ConfiguratorApp.AvailableMeals",function(a,b){"use strict";var c={list:function(b){a.Controller.list(b)}};a.addInitializer(function(){b.vent.on("configurator:loaded",c.list)})},WOS),Store.module("ConfiguratorApp.AvailableMeals",function(a,b,c,d,e,f){"use strict";a.Controller={list:function(a){var c=f.bind(function(c,d){var e=this._getView(c,d);e.on("addedmeals:quantitychange",function(a,c,d,e){b.vent.trigger("addedmeals:quantitychange",c,d,e)}),a.availableItemsRegion.show(e)},this);e.when(b.request("availablemeals:entity:findAll",a.model.get("productCode")),b.request("addedmeals:entity:findAll")).then(c)},_getView:function(b,c){return new a.ListView({collection:b,addedMealsCollection:c})}}},WOS),Store.module("ConfiguratorApp.AvailableMeals",function(a,b,c,d,e,f,g){"use strict";a.ItemView=d.ItemView.extend({tagName:"tr",template:"#productset-template",events:{"click @ui.quantitydecrease":"changeQuantity","click @ui.quantityincrease":"changeQuantity","change @ui.quantityinput":"changeQuantity"},ui:{quantityinput:".form-control",quantityincrease:".btn-increase",quantitydecrease:".btn-decrease"},onShow:function(){g.Components.QuantityInput.init(this.$el,{pattern:"9"}),this.updateQuantity(null,this.options.addedMealsCollection),this.setState(this.model.get("availability"))},initialize:function(){this.listenTo(this.options.addedMealsCollection,"add remove",this.updateQuantity)},changeQuantity:function(){var a=this.ui.quantityinput,b=parseInt(a.data("oldvalue"),10),c=parseInt(a.data("newvalue"),10),d=c-b,e=c;this.$el.toggleClass("selected",!!e),this.trigger("quantitychange",this.model,d,e)},updateQuantity:function(a,b){var c=b.where({productCode:this.model.get("productCode")}),d=c.length;this.ui.quantityinput.val(d),this.ui.quantityinput.data("newvalue",d),this.ui.quantityinput.data("oldvalue",d),this.$el.toggleClass("selected",!!d)},setState:function(a){this.$el.toggleClass("disabled",!a),this.ui.quantityinput.prop("disabled",!a),this.ui.quantityincrease.toggleClass("disabled",!a),this.ui.quantitydecrease.toggleClass("disabled",!a)}}),a.ListView=d.CompositeView.extend({template:"#productsets-template",itemView:a.ItemView,itemViewEventPrefix:"addedmeals",itemViewContainer:"tbody",itemViewOptions:function(){return{addedMealsCollection:this.options.addedMealsCollection}}})},WOS),Store.module("ConfiguratorApp",function(a,b,c,d){"use strict";var e=d.AppRouter.extend({appRoutes:{"add/:productCode":"createOrder","edit/:cartId":"editOrder"}}),f={browseCategory:function(){},createOrder:function(b){var c=isNaN(b)?b:parseInt(b,10);a.Controller.createOrder(c)},editOrder:function(b){var c=isNaN(b)?b:parseInt(b,10);a.Controller.editOrder(c)}};a.addInitializer(function(){b.addInitializer(function(){new e({controller:f}),b.addRegions({menuRegion:"#food-menu",productCardsRegion:"#product-cards",configuratorRegion:"#product-configurator",orderWidgetRegion:"#order-widget",choicesModalsRegion:"#modals-choices"}),b.commands.execute("availablemeals:entity:reset"),b.commands.execute("availablechoices:entity:reset"),b.commands.execute("availableupsells:entity:reset"),b.commands.execute("addedmeals:entity:reset")}),b.vent.on("configurator:closed",function(){b.commands.execute("addedmeals:entity:reset"),b.commands.execute("availablemeals:entity:reset"),b.commands.execute("availableupsells:entity:reset")}),b.vent.trigger("app:started","configurator")})},WOS),Store.module("ConfiguratorApp",function(a,b,c,d,e,f){"use strict";a.Controller={createOrder:function(a){this.cartId=null;var c=f.bind(this._showView,this);b.vent.trigger("app:loading:start"),e.when(b.request("availablemeals:entity:findOne",a),b.request("addedmeals:entity:findAll")).then(c).always(function(){b.vent.trigger("app:loading:end")})},editOrder:function(a){this.cartId=a;var c=f.bind(this._showView,this);b.vent.trigger("app:loading:start"),e.when(b.request("addedmeals:entity:findAllByCartId",a)).then(c).always(function(){b.vent.trigger("app:loading:end")})},cancelOrder:function(a){b.vent.trigger("configurator:cancelorder",a),this._hideView()},saveOrder:function(a){var d=f.bind(function(){c.history.navigate(""),b.vent.trigger("configurator:saveorder",a),b.config.debug||location.reload()},this);b.vent.trigger("app:loading:start"),e.when(b.request("cart:save",this.cartId,a.model.id)).then(d)},_showView:function(c,d){if(c){var e=new a.View({model:c,addedMealsCollection:d,isNewOrder:!this.cartId});e.on("configurator:loaded",function(a){b.vent.trigger("configurator:loaded",a)}),e.on("configurator:cancelorder",f.bind(a.Controller.cancelOrder,this)),e.on("configurator:saveorder",f.bind(a.Controller.saveOrder,this)),b.configuratorRegion.show(e)}},_hideView:function(){b.configuratorRegion.close(),c.history.navigate(""),b.vent.trigger("configurator:closed")}}},WOS),Store.module("ConfiguratorApp",function(a,b,c,d,e,f,g){"use strict";a.View=d.Layout.extend({template:"#configurator-template",templateHelpers:function(){return{isNewOrder:this.options.isNewOrder}},regions:{availableItemsRegion:"#available-sets",addedItemsRegion:"#added-sets",upsellsRegion:"#upsell-section"},ui:{header:".configurator-header",body:".configurator-body",footer:".configurator-footer",quantity:".added-quantity",btnSave:".action-saveorder"},triggers:{"click .action-cancel":"configurator:cancelorder","click .action-saveorder":"configurator:saveorder"},initialize:function(){this.listenTo(this.options.addedMealsCollection,"add remove",this.updateQuantity),this.listenTo(this.options.addedMealsCollection,"add remove",this.toggleSaveButton)},onShow:function(){e("body").addClass("show-configurator"),g.Components.Popovers.init(this.ui.header),e(window).on("scroll.configurator",f.bind(this.onScroll,this)),document.body.scrollTop=document.documentElement.scrollTop=0,this.updateQuantity(),this.toggleSaveButton(),this.trigger("configurator:loaded",this)},onClose:function(){e("body").removeClass("show-configurator"),e(window).off("scroll.configurator")},onScroll:g.Poll(function(){var a=e(window).scrollTop();this.ui.header[a<b.config.configurator.collapseOnScollLimit?"removeClass":"addClass"]("collapsed"),this.ui.body[a<b.config.configurator.collapseOnScollLimit?"removeClass":"addClass"]("expanded")},25),updateQuantity:function(){this.ui.quantity.text(this.options.addedMealsCollection.length)},toggleSaveButton:function(){this.ui.btnSave[this.options.addedMealsCollection.length?"removeClass":"addClass"]("disabled"),this.ui.btnSave.prop("disabled",!this.options.addedMealsCollection.length)}})},WOS),Store.module("ConfiguratorApp.Upsells",function(a,b){"use strict";var c={list:function(b){a.Controller.list(b)},update:function(b,c,d){a.Controller.update(b,c,d)}};a.addInitializer(function(){b.vent.on("configurator:loaded",c.list),b.vent.on("addedupsells:quantitychange",c.update)})},WOS),Store.module("ConfiguratorApp.Upsells",function(a,b,c,d,e,f){"use strict";a.Controller={list:function(a){var c=f.bind(function(c){if(c.length){var d=this._getView(c);d.on("addedupsells:quantitychange",function(a,c,d,e){b.vent.trigger("addedupsells:quantitychange",c,d,e)}),a.upsellsRegion.show(d)}},this);e.when(b.request("availableupsells:entity:findAll",a.model.get("productCode"))).then(c)},update:function(a,c,d){b.commands.execute("addedupsells:entity:update",a,c,d)},_getView:function(b){return new a.ListView({collection:b})}}},WOS),Store.module("ConfiguratorApp.Upsells",function(a,b,c,d,e,f,g){"use strict";a.ItemView=d.ItemView.extend({template:"#upsellitem-template",className:"colsize-5 colsize-5-1of5",ui:{title:".product-title",quantityinput:".form-control"},events:{"click .action-decrease":"changeQuantity","click .action-increase":"changeQuantity","change .form-control":"changeQuantity"},onShow:function(){g.Components.QuantityInput.init(this.$el)},changeQuantity:function(){var a=this.ui.quantityinput,b=parseInt(a.data("oldvalue"),10),c=parseInt(a.data("newvalue"),10),d=c-b,e=c;this.trigger("quantitychange",this.model,d,e)},adjustHeight:function(a){this.ui.title.css("height",a)},getHeight:function(){return this.ui.title.css("height","auto").innerHeight()}}),a.ListView=d.CompositeView.extend({template:"#upsellsection-template",itemViewContainer:"#upsell-items .colsize-5-row",itemView:a.ItemView,itemViewEventPrefix:"addedupsells",onShow:function(){e(window).on("resize.configurator",f.bind(this.adjustHeight,this)),this.adjustHeight()},onClose:function(){e(window).off("resize.configurator")},adjustHeight:function(){var a=0;this.children.each(function(b){var c=b.getHeight();c>a&&(a=c)}),this.children.each(function(b){b.adjustHeight(a)})}})},WOS),Store.module("LoadingApp",function(a,b){"use strict";var c={showLoader:function(){a.Controller.showLoader()},hideLoader:function(){a.Controller.hideLoader()}};a.addInitializer(function(){b.vent.on("app:loading:start",c.showLoader),b.vent.on("app:loading:end",c.hideLoader)})},WOS),Store.module("LoadingApp",function(a){"use strict";a.Controller={showLoader:function(){var a=this._getView();a.showView()},hideLoader:function(){var a=this._getView();a.hideView()},_getView:function(){return this.loadingView||(this.loadingView=new a.ItemView({})),this.loadingView}}},WOS),Store.module("LoadingApp",function(a,b,c,d){"use strict";a.ItemView=d.Layout.extend({el:"#loading-view",showView:function(){this.$el.removeClass("hidden")},hideView:function(){this.$el.addClass("hidden")}})},WOS),Store.module("PromotionApp.AddedPromotionalItems",function(a,b){"use strict";var c={list:function(b){a.Controller.list(b)},update:function(b,c,d){a.Controller.update(b,c,d)}};a.addInitializer(function(){b.vent.on("promotion:loaded",c.list),b.vent.on("addedpromotionalitems:quantitychange",c.update)})},WOS),Store.module("PromotionApp.AddedPromotionalItems",function(a,b,c,d,e,f){"use strict";a.Controller={list:function(a){var c=f.bind(function(c){var d=this._getView(c);d.on("addedpromotionalitems:meal:removed",function(a,c){b.vent.trigger("addedpromotionalitems:meal:removed",a,c)}),d.on("addedpromotionalitems:view:loaded",function(a){b.vent.trigger("addedpromotionalitems:view:loaded",a)}),d.on("addedpromotionalitems:view:customization:view:selectionchanged",function(a){b.vent.trigger("addedpromotionalitems:view:customization:view:selectionchanged",a)}),a.addedItemsRegion.show(d)},this);e.when(b.request("addedpromotionalitems:entity:findAll")).then(c)},update:function(a,c,d){b.commands.execute("addedpromotionalitems:entity:update",a,c,d)},_getView:function(b){return new a.ListView({collection:b})}}},WOS),Store.module("PromotionApp.AddedPromotionalItems",function(a,b,c,d,e,f,g){"use strict";a.ItemView=d.Layout.extend({className:"selected-meal-item",template:"#addedpromotionalset-template",regions:{componentsRegion:".components-column",choicesRegion:".choices-column",customizeRegion:".meal-customization",customizeDetailsRegion:".customization-details"},ui:{toggleCustomization:".action-customize",header:".header-info-column"},initialize:function(){this.customising=!1},events:{"click .action-delete":"destroy","click .action-customize":"toggleCustomization"},onShow:function(){this.trigger("loaded"),g.Components.Popovers.init(this.ui.header)
},destroy:function(a){a.preventDefault(),this.model.destroy()},toggleCustomization:function(){this[this.customizing?"hideCustomization":"showCustomization"](),this.customizing=!this.customizing},showCustomization:function(){this.$el.addClass("selected-meal-expanded"),this.ui.toggleCustomization.find("span").text(this.ui.toggleCustomization.data("expanded-text"))},hideCustomization:function(){this.$el.removeClass("selected-meal-expanded"),this.ui.toggleCustomization.find("span").text(this.ui.toggleCustomization.data("collapsed-text"))}}),a.EmptyView=d.ItemView.extend({template:"#addedpromotionalsetempty-template"}),a.ListView=d.CollectionView.extend({itemView:a.ItemView,emptyView:a.EmptyView,itemViewEventPrefix:"addedpromotionalitems:view",collectionEvents:{remove:"mealRemoved"},mealRemoved:function(a,b){this.trigger("addedpromotionalitems:meal:removed",a,b)}})},WOS),Store.module("PromotionApp.AvailableChoices",function(a,b){"use strict";var c={list:function(b,c){a.Controller.list(b,c)}};a.addInitializer(function(){b.vent.on("addedpromotionalitems:choice:changing",function(a,b){c.list(a,b)})})},WOS),Store.module("PromotionApp.AvailableChoices",function(a,b,c,d,e,f){"use strict";a.Controller={list:function(a,c){var d=f.bind(function(a,d){if("radioList"==d.displayType){var g=this._getRadioListView(d,a,c.model);g.on("availablechoices:view:hidden",g.close),g.on("availablechoices:choices:save",function(a,d,e){b.commands.execute("addedpromotionalchoices:entity:update",a,d,e),c.view.trigger("changed")}),b.choicesModalsRegion.show(g)}else e.when(b.request("addedpromotionalchoices:entity:findAllByListId",c.model)).then(f.bind(function(e){var f=this._getQuantityPickerListView(d,a,e,c.model);f.on("availablechoices:view:hidden",f.close),f.on("availablechoices:choices:save",function(a,d,e){b.commands.execute("addedpromotionalchoices:entity:update",a,d,e),c.view.trigger("changed")}),b.choicesModalsRegion.show(f)},this))},this);b.vent.trigger("app:loading:start"),e.when(b.request("availablechoices:entity:findAll",c.model)).then(d).always(function(){b.vent.trigger("app:loading:end")})},_getRadioListView:function(b,c,d){return new a.RadioListView({collection:c,model:d,displayOptions:b})},_getQuantityPickerListView:function(b,c,d,e){return new a.QuantityPickerListView({collection:c,addedChoicesCollection:d,model:e,displayOptions:b})}}},WOS),Store.module("PromotionApp.AvailableChoices",function(a,b,c,d,e,f,g){"use strict";a.RadioItemView=d.ItemView.extend({template:"#available-choice-template",triggers:{"ifChecked :radio":"selected"},ui:{radio:"input:radio",radioGroup:".radio"},onRender:function(){setTimeout(f.bind(function(){g.Forms.InputStates.init(this.ui.radioGroup)},this),1)},onShow:function(){this.model.get("productCode")==this.options.productCode&&this.ui.radio.iCheck("check")}}),a.RadioListView=d.CompositeView.extend({template:"#available-choices-template",templateHelpers:function(){return{columnsToDisplay:this.getColumnsToDisplay()}},className:"modal-available-choices modal fade",itemView:a.RadioItemView,itemViewOptions:function(){return{productCode:this.model.get("selectedSolutionCode")}},itemViewContainer:".available-choices-list",itemViewEventPrefix:"availablechoice",itemEvents:{selected:"onChoiceSelected"},events:{"click .btn-submit":"onSave"},ui:{radioGroups:".radio",choiceImage:".choice-image",dialog:".modal-dialog",choicesContainer:".available-choices-list"},initialize:function(){this.$el.on("hidden.bs.modal",f.bind(function(){this.trigger("availablechoices:view:hidden")},this))},onShow:function(){this.$el.modal("show")},onChoiceSelected:function(a,b,c){this.selectedChoice=c.model,this.ui.choiceImage.attr("src",c.model.get("images")[0].imageUrl)},onSave:function(a){if(a.preventDefault(),this.selectedChoice){var b=e.extend(!0,{},this.model.toJSON()),c={mealid:b.mealid,productCode:b.productCode,selectedSolutionCode:this.selectedChoice.get("productCode"),selectedSolutionCartName:this.selectedChoice.get("cartName"),selectedSolutionPath:this.selectedChoice.get("solutionPath"),selectedQuantity:1,included:this.selectedChoice.get("included"),addons:this.selectedChoice.get("addons"),choices:this.selectedChoice.get("choices"),components:this.selectedChoice.get("components")};this.trigger("availablechoices:choices:save",[c],b,!1)}this.$el.modal("hide")},getColumnsToDisplay:function(){var a=Math.ceil(this.collection.length/8);return a>3?3:a},appendHtml:function(a,b,c){for(var d=this.getItemViewContainer(a),f=this.getColumnsToDisplay(),g="col-xs-"+(12/f).toString(),h=Math.ceil(this.collection.length/f),i=0;f>i;i++){var j=d.find(".column-"+i);j.length||(j=e('<div class="choices-column '+g+" column-"+i+'"></div>')),d.append(j)}var k=Math.floor(c/h);d.find(".choices-column").eq(k).append(b.el)}}),a.QuantityPickerItemView=d.ItemView.extend({template:"#available-choice-quantity-picker-template",className:"col-xs-6",ui:{title:".product-title",quantityinput:".form-control",increase:".action-increase",decrease:".action-decrease"},triggers:{"click @ui.increase":"quantitychanged","click @ui.decrease":"quantitychanged","change @ui.quantityinput":"quantitychanged"},initialize:function(){this.listenTo(this.options.addedChoicesCollection,"add remove",this.updateQuantity)},onShow:function(){g.Components.QuantityInput.init(this.$el),this.updateQuantity(null,this.options.addedChoicesCollection)},adjustHeight:function(a){this.ui.title.css("height",a)},getHeight:function(){return this.ui.title.css("height","auto").innerHeight()},getQuantity:function(){return parseInt(this.ui.quantityinput.val(),10)},updateQuantity:function(a,b){var c=b.where({selectedSolutionCode:this.model.get("productCode")}),d=c.length;this.setQuantity(d)},setQuantity:function(a){this.ui.quantityinput.val(a),this.ui.quantityinput.data("newvalue",a),this.ui.quantityinput.data("oldvalue",a)},setNoSelection:function(a){this.setQuantity(0),this.ui.increase.prop("disabled",a),this.ui.decrease.prop("disabled",a),this.ui.quantityinput.prop("disabled",a),this.trigger("quantitychanged")}}),a.QuantityPickerListView=d.CompositeView.extend({itemView:a.QuantityPickerItemView,template:"#available-promotional-choices-quantity-picker-template",templateHelpers:{noSelection:function(){return this.options.displayOptions.noSelection},quantity:function(){var a=this.model.get("minQuantity"),b=this.model.get("maxQuantity");return a==b?a:[a,b].join(" - ")}},className:"modal-available-choices modal fade",itemViewContainer:".available-choices-list",itemViewEventPrefix:"availablechoice",itemViewOptions:function(){return{addedChoicesCollection:this.options.addedChoicesCollection}},initialize:function(){this.$el.on("hidden.bs.modal",f.bind(function(){this.trigger("availablechoices:view:hidden")},this)),this.selectNone=!1},ui:{selectNone:".clear-selection input:checkbox",instruction:".note .instruction",submitButton:".btn-submit",dialog:".modal-dialog"},itemEvents:{quantitychanged:"validate"},events:{"ifChanged @ui.selectNone":"clearSelection","click @ui.submitButton":"onSave"},onShow:function(){this.$el.on("shown.bs.modal.quantitypicker",f.bind(this.adjustHeight,this)).modal("show"),setTimeout(f.bind(function(){g.Forms.InputStates.init(this.ui.selectNone.parent())},this),1)},onClose:function(){this.$el.off("shown.bs.modal.quantitypicker")},adjustHeight:function(){var a=0;this.children.each(function(b){var c=b.getHeight();c>a&&(a=c)}),this.children.each(function(b){b.adjustHeight(a)})},clearSelection:function(a){var b=e(a.target).prop("checked");this.selectNone=b,this.children.each(function(a){a.setNoSelection(b)})},validate:function(){var a=0,b=this.model.get("minQuantity"),c=this.model.get("maxQuantity");this.children.each(function(b){a+=b.getQuantity()});var d=a>=b&&c>=a;return this.ui.instruction.toggleClass("error",!d),d||this.$el.animate({scrollTop:0}),d},onSave:function(a){a.preventDefault();var b=this.validate();if(b){var c=[],d=e.extend(!0,{},this.model.toJSON()),f=this.model.get("mealid"),g=this.model.get("productCode"),h=this.model.get("selectedSolutionPath");this.children.each(function(a){var b=a.getQuantity(),f={mealid:d.mealid,productCode:d.productCode,selectedSolutionCode:a.model.get("productCode"),selectedSolutionCartName:a.model.get("cartName"),selectedSolutionPath:a.model.get("solutionPath"),selectedQuantity:1,included:a.model.get("included"),addons:a.model.get("addons"),choices:a.model.get("choices"),components:a.model.get("components")};if(b)for(var g=0;b>g;g++)c.push(e.extend(!0,{},f))}),c.length||c.push({mealid:f,productCode:g,selectedSolutionCode:0,selectedSolutionCartName:this.options.displayOptions.noSelection,selectedSolutionPath:h.substring(0,h.lastIndexOf("|"))+"|null",selectedQuantity:0,included:[],addons:[]}),this.$el.modal("hide"),this.trigger("availablechoices:choices:save",c,d,!0)}}})},WOS),Store.module("PromotionApp.AddedPromotionalItems.Choices",function(a,b){"use strict";var c={list:function(b){a.Controller.list(b)}};a.addInitializer(function(){b.vent.on("addedpromotionalitems:view:loaded addedpromotionalitems:choice:changed",function(a){setTimeout(function(){c.list(a)},50)})})},WOS),Store.module("PromotionApp.AddedPromotionalItems.Choices",function(a,b,c,d,e,f){"use strict";a.Controller={list:function(a){var c=f.bind(function(c){var d=this._getView(c);d.on("addedpromotionalitems:choice:changing",function(a,c){b.vent.trigger("addedpromotionalitems:choice:changing",a,c)}),d.on("addedpromotionalitems:choice:changed",function(c,d){b.vent.trigger("addedpromotionalitems:choice:changed",a,c,d)}),a.choicesRegion.show(d)},this);e.when(b.request("addedpromotionalchoices:entity:findAllByMeal",a.model)).then(c)},_getView:function(b){return new a.ListView({collection:b})}}},WOS),Store.module("PromotionApp.AddedPromotionalItems.Choices",function(a,b,c,d){"use strict";a.ItemView=d.Layout.extend({template:"#addedset-choice-template",ui:{changeLink:".action-change"},regions:{availableChoices:".modal-available-choices"},triggers:{"click .action-change":"changing"},modelEvents:{change:"render onChanged"},onChanged:function(){this.trigger("changed")}}),a.ListView=d.CollectionView.extend({itemView:a.ItemView,className:"fooditem",itemViewEventPrefix:"addedpromotionalitems:choice"})},WOS),Store.module("PromotionApp.AddedPromotionalItems.Components",function(a,b){"use strict";var c={list:function(b){a.Controller.list(b)}};a.addInitializer(function(){b.vent.on("addedpromotionalitems:view:loaded addedpromotionalitems:choice:changed",function(a){setTimeout(function(){c.list(a)},50)})})},WOS),Store.module("PromotionApp.AddedPromotionalItems.Components",function(a,b,c,d,e,f){"use strict";a.Controller={list:function(a){if(a.model.get("components").length||a.model.get("choices").length){var c=f.bind(function(b){var c=this._getView(b);a.componentsRegion.show(c)},this);e.when(b.request("addedpromotionalcomponents:entity:findAllByMeal",a.model)).then(c)}},_getView:function(b){return new a.ListView({collection:b})}}},WOS),Store.module("PromotionApp.AddedPromotionalItems.Components",function(a,b,c,d){"use strict";a.ItemView=d.ItemView.extend({template:"#addedset-component-template",className:"fooditem"}),a.ListView=d.CollectionView.extend({itemView:a.ItemView})},WOS),Store.module("PromotionApp.AddedPromotionalItems.Customization",function(a,b){"use strict";var c={list:function(b){a.Controller.list(b)}};a.addInitializer(function(){b.config.enableGrilling&&b.vent.on("addedpromotionalitems:view:loaded addedpromotionalitems:choice:changed",function(a){setTimeout(function(){c.list(a)},50)})})},WOS),Store.module("PromotionApp.AddedPromotionalItems.Customization",function(a,b,c,d,e,f){"use strict";a.Controller={list:function(a){var c=f.bind(function(c){var d=this._getView(c);d.on("addedpromotionalitems:customization:view:loaded",function(a){b.vent.trigger("addedpromotionalitems:customization:view:loaded",a)}),d.on("addedpromotionalitems:customization:view:selectionchanged",function(){a.trigger("customization:view:selectionchanged")}),a.customizeRegion.show(d)},this);e.when(b.request("customizablepromotionalitems:entity:findAllByMeal",a.model)).then(c)},_getView:function(b){return new a.ListView({collection:b})}}},WOS),Store.module("PromotionApp.AddedPromotionalItems.Customization",function(a,b,c,d){"use strict";a.ItemView=d.Layout.extend({className:"customize-item",template:"#customize-item-template",regions:{includedRegion:".customization-options-included",addonsRegion:".customization-options-addons"},ui:{toggle:".item-toggle",body:".customize-item-body"},onShow:function(){this.trigger("loaded")},expand:function(){this.toggle(!0)},collapse:function(){this.toggle(!1)},toggle:function(a){this.ui.toggle[a?"removeClass":"addClass"]("collapsed"),this.ui.body[a?"addClass":"removeClass"]("in")}}),a.EmptyView=d.ItemView.extend({template:"#customize-items-empty-template"}),a.ListView=d.CompositeView.extend({itemView:a.ItemView,emptyView:a.EmptyView,template:"#customize-items-template",itemViewContainer:".customize-items",itemViewEventPrefix:"addedpromotionalitems:customization:view",onShow:function(){this.collection.length&&this.children.first().expand()}})},WOS),Store.module("PromotionApp.AddedPromotionalItems.Customization.Options",function(a,b){"use strict";var c={list:function(b){a.Controller.list(b)}};a.addInitializer(function(){b.vent.on("addedpromotionalitems:customization:view:loaded",function(a){setTimeout(function(){c.list(a)},50)})})},WOS),Store.module("PromotionApp.AddedPromotionalItems.Customization.Options",function(a,b,c,d,e,f){"use strict";a.Controller={list:function(a){var c=f.bind(function(b,c){var d=this._getView(b),e=this._getView(c);d.on("addedpromotionalitems:customization:options:view:selectionchanged",function(){a.trigger("selectionchanged")}),e.on("addedpromotionalitems:customization:options:view:selectionchanged",function(){a.trigger("selectionchanged")}),a.includedRegion.show(d),a.addonsRegion.show(e)},this);e.when(b.request("customizablepromotionalitemoptions:entity:findAllByMealItem",a.model)).then(c)},_getView:function(b){return new a.ListView({collection:b})}}},WOS),Store.module("PromotionApp.AddedPromotionalItems.Customization.Options",function(a,b,c,d,e,f,g){"use strict";a.ItemView=d.ItemView.extend({className:"customize-item-option",template:"#customize-item-option-template",ui:{select:"select"},events:{"change @ui.select":"onSelectionChanged"},onShow:function(){this.ui.select.val(this.model.get("selected")),g.Forms.CustomSelect.init(this.$el)},onClose:function(){g.Forms.CustomSelect.destroy(this.ui.select)},onSelectionChanged:function(){this.model.save({selected:this.ui.select.val()}),this.trigger("selectionchanged")}}),a.ListView=d.CollectionView.extend({itemView:a.ItemView,itemViewEventPrefix:"addedpromotionalitems:customization:options:view"})},WOS),Store.module("PromotionApp.AddedPromotionalItems.Details",function(a,b){"use strict";var c={list:function(b){a.Controller.list(b)}};a.addInitializer(function(){b.config.enableGrilling&&b.vent.on("addedpromotionalitems:view:loaded addedpromotionalitems:choice:changed addedpromotionalitems:view:customization:view:selectionchanged",function(a){setTimeout(function(){c.list(a)},50)})})},WOS),Store.module("PromotionApp.AddedPromotionalItems.Details",function(a,b,c,d,e,f){"use strict";a.Controller={list:function(a){var c=f.bind(function(c){var d=this._getView(c);d.on("addedpromotionalitems:details:view:loaded",function(a){b.vent.trigger("addedpromotionalitems:details:view:loaded",a)}),a.customizeDetailsRegion.show(d)},this);e.when(b.request("customizablepromotionalitems:entity:findAllByMeal",a.model)).then(c)},_getView:function(b){return new a.ListView({collection:b})}}},WOS),Store.module("PromotionApp.AddedPromotionalItems.Details",function(a,b,c,d){"use strict";a.ItemView=d.Layout.extend({template:"#customize-item-details-template",regions:{includedRegion:"span.options-included",addonsRegion:"span.options-addons"},onShow:function(){this.trigger("loaded")}}),a.EmptyView=d.ItemView.extend({template:"#customize-item-details-empty-template"}),a.ListView=d.CollectionView.extend({tagName:"span",itemView:a.ItemView,emptyView:a.EmptyView,itemViewEventPrefix:"addedpromotionalitems:details:view"})},WOS),Store.module("PromotionApp.AddedPromotionalItems.Details.Options",function(a,b,c,d,e,f){"use strict";a.Controller={list:function(){var a=f.bind(function(a,b){var c=this._getView(a),d=this._getView(b);addedMealDetailsView.includedRegion.show(c),addedMealDetailsView.addonsRegion.show(d)},this);e.when(b.request("customizablepromotionalitemoptions:entity:findAllByMealItem",addedMealDetailsView.model)).then(a)},_getView:function(b){return new a.ListView({collection:b})}}},WOS),Store.module("PromotionApp.AddedPromotionalItems.Details.Options",function(a,b,c,d){"use strict";a.ItemView=d.ItemView.extend({template:"#customize-item-details-option-template",tagName:"span"}),a.ListView=d.CollectionView.extend({itemView:a.ItemView,tagName:"span"})},WOS),Store.module("PromotionApp.AddedPromotionalItems.Details.Options",function(a,b){"use strict";var c={list:function(b){a.Controller.list(b)}};a.addInitializer(function(){b.vent.on("addedpromotionalitems:details:view:loaded",function(a){setTimeout(function(){c.list(a)},50)})})},WOS),Store.module("PromotionApp.AvailableItems",function(a,b){"use strict";var c={list:function(b){a.Controller.list(b)}};a.addInitializer(function(){b.vent.on("promotion:loaded",c.list)})},WOS),Store.module("PromotionApp.AvailableItems",function(a,b,c,d,e,f){"use strict";a.Controller={list:function(a){var c=f.bind(function(c,d){var e=this._getView(c[0],d);e.on("addedpromotionalitems:quantitychange",function(a,c,d,e){b.vent.trigger("addedpromotionalitems:quantitychange",c,d,e)}),a.availableItemsRegion.show(e)},this);e.when(b.request("availablepromotionalitems:entity:findAll",a.model.get("promoId")),b.request("addedpromotionalitems:entity:findAll")).then(c)},_getView:function(b,c){return new a.ListView({collection:b,addedPromotionalItemsCollection:c})}}},WOS),Store.module("PromotionApp.AvailableItems",function(a,b,c,d,e,f,g){"use strict";a.ItemView=d.ItemView.extend({tagName:"tr",template:"#productset-template",events:{"click @ui.quantitydecrease":"changeQuantity","click @ui.quantityincrease":"changeQuantity","change @ui.quantityinput":"changeQuantity"},ui:{quantityinput:".form-control",quantityincrease:".btn-increase",quantitydecrease:".btn-decrease"},onShow:function(){g.Components.QuantityInput.init(this.$el,{pattern:"99"}),this.updateQuantity(null,this.options.addedPromotionalItemsCollection),this.setState(this.model.get("availability"))},initialize:function(){this.listenTo(this.options.addedPromotionalItemsCollection,"add remove",this.updateQuantity)},changeQuantity:function(){var a=this.ui.quantityinput,b=parseInt(a.data("oldvalue"),10),c=parseInt(a.data("newvalue"),10),d=c-b,e=c;this.$el.toggleClass("selected",!!e),this.trigger("quantitychange",this.model,d,e)},updateQuantity:function(a,b){var c=b.where({productCode:this.model.get("productCode")}),d=c.length;if(0!=c.length){var e=b.get(c[0].cid);d=e.get("selectedQuantity")}this.ui.quantityinput.val(d),this.ui.quantityinput.data("newvalue",d),this.ui.quantityinput.data("oldvalue",d),this.$el.toggleClass("selected",!!d)},setState:function(a){this.$el.toggleClass("disabled",!a),this.ui.quantityinput.prop("disabled",!a),this.ui.quantityincrease.toggleClass("disabled",!a),this.ui.quantitydecrease.toggleClass("disabled",!a)}}),a.ListView=d.CompositeView.extend({template:"#productsets-template",itemView:a.ItemView,itemViewEventPrefix:"addedpromotionalitems",itemViewContainer:"tbody",itemViewOptions:function(){return{addedPromotionalItemsCollection:this.options.addedPromotionalItemsCollection}}})},WOS),Store.module("PromotionApp",function(a,b,c,d){"use strict";var e=d.AppRouter.extend({appRoutes:{"promotion/:promoId/new":"createOrder","promotion/:promoId/edit":"editOrder"}}),f={createOrder:function(b){var c=isNaN(b)?b:parseInt(b,10);a.Controller.createOrder(c)},editOrder:function(b){var c=isNaN(b)?b:parseInt(b,10);a.Controller.editOrder(c)}};a.addInitializer(function(){b.addInitializer(function(){new e({controller:f}),b.addRegions({menuRegion:"#food-menu",productCardsRegion:"#product-cards",configuratorRegion:"#product-configurator",orderWidgetRegion:"#order-widget",choicesModalsRegion:"#modals-choices"}),b.commands.execute("availablepromotionalitems:entity:reset"),b.commands.execute("addedpromotionalitems:entity:reset")}),b.vent.on("promotion:closed",function(){b.commands.execute("addedpromotionalitems:entity:reset"),b.commands.execute("availablepromotionalitems:entity:reset")}),b.vent.trigger("app:started","promotion")})},WOS),Store.module("PromotionApp",function(a,b,c,d,e,f){"use strict";a.Controller={createOrder:function(a){this.cartId=null;var c=f.bind(this._showView,this);b.vent.trigger("app:loading:start"),e.when(b.request("availablepromotionalitems:entity:findAll",a),b.request("addedpromotionalitems:entity:findAll")).then(c).always(function(){b.vent.trigger("app:loading:end")})},editOrder:function(a){this.cartId=a;var c=f.bind(this._showView,this);b.vent.trigger("app:loading:start"),e.when(b.request("addedpromotionalitems:entity:findAllByCartId",a)).then(c).always(function(){b.vent.trigger("app:loading:end")})},saveOrder:function(a){var d=f.bind(function(){c.history.navigate(""),b.vent.trigger("promotion:saveorder",a),b.config.debug||location.reload()},this);b.vent.trigger("app:loading:start"),e.when(b.request("promotionalcart:save",this.cartId,a.view.options.promoId)).then(d)},cancelOrder:function(a){b.vent.trigger("promotion:cancelorder",a),this._hideView()},_showView:function(c,d){var e=new a.View({model:c[0],maxQuantity:c[1],promoId:c[2],addedPromotionalItemsCollection:d,isNewOrder:!this.cartId});e.on("promotion:loaded",function(a){b.vent.trigger("promotion:loaded",a)}),e.on("promotion:cancelorder",f.bind(a.Controller.cancelOrder,this)),e.on("promotion:saveorder",f.bind(a.Controller.saveOrder,this)),b.configuratorRegion.show(e)},_hideView:function(){b.configuratorRegion.close(),c.history.navigate(""),b.vent.trigger("promotion:closed")}}},WOS),Store.module("PromotionApp",function(a,b,c,d,e,f,g){"use strict";a.View=d.Layout.extend({template:"#promotion-configurator-template",templateHelpers:function(){return{isNewOrder:this.options.isNewOrder,maxQuantity:this.options.maxQuantity,promoId:this.options.promoId}},regions:{availableItemsRegion:"#available-sets",addedItemsRegion:"#added-sets"},ui:{header:".configurator-header",body:".configurator-body",footer:".configurator-footer",quantity:".added-quantity",btnSave:".action-saveorder"},triggers:{"click .action-cancel":"promotion:cancelorder","click .action-saveorder":"promotion:saveorder"},initialize:function(){this.listenTo(this.options.addedPromotionalItemsCollection,"add remove",this.updateQuantity),this.listenTo(this.options.addedPromotionalItemsCollection,"add remove change:selectedQuantity",this.toggleSaveButton)},onShow:function(){e("body").addClass("show-configurator show-promotion-configurator"),e(window).on("scroll.configurator",f.bind(this.onScroll,this)),document.body.scrollTop=document.documentElement.scrollTop=0,this.updateQuantity(),this.toggleSaveButton(),this.trigger("promotion:loaded",this)},onClose:function(){e("body").removeClass("show-configurator show-promotion-configurator"),e(window).off("scroll.configurator")},onScroll:g.Poll(function(){var a=e(window).scrollTop();this.ui.header[a<b.config.configurator.collapseOnScollLimit?"removeClass":"addClass"]("collapsed"),this.ui.body[a<b.config.configurator.collapseOnScollLimit?"removeClass":"addClass"]("expanded")},25),updateQuantity:function(){},toggleSaveButton:function(){var a=0;this.options.addedPromotionalItemsCollection.length>0&&f.each(this.options.addedPromotionalItemsCollection.models,function(b){a+=b.get("selectedQuantity")});var b=this.options.addedPromotionalItemsCollection.length&&a<=this.options.maxQuantity;this.ui.btnSave[b?"removeClass":"addClass"]("disabled"),this.ui.btnSave.prop("disabled",!b)}})},WOS),Store.module("Entities",function(a,b,c){a.Model=c.Model.extend({}),a.Collection=c.Collection.extend({initialize:function(a,b){this.options=b}})}),Store.module("Entities",function(a,b,c,d,e,f){"use strict";var g=b.Entities.Model.extend({idAttribute:"___id",services:{create:function(a,c){var d=e.Deferred();d.done(function(a){b.commands.execute("customizableitemoptions:entity:insert:choice",a)}),d.done(c.success);var f=b.db.added.choices.insert(e.extend(!0,{},a.toJSON())).first();return d.resolve(f),d.promise()},read:function(a,c){var d=e.Deferred(),f=b.db.added.choices(a.id).first();return d.done(c.success),d.resolve(f),d.promise()},update:function(a,c){var d=e.Deferred(),f=b.db.added.choices(a.id).update(a.toJSON()).first();return d.done(function(a){b.commands.execute("customizableitemoptions:entity:destroy:choice",a),b.commands.execute("customizableitemoptions:entity:insert:choice",a)}),d.done(c.success),d.resolve(f),d.promise()},"delete":function(a,c){var d=e.Deferred(),f=b.db.added.choices(a.id).remove();return d.done(function(a){b.commands.execute("customizableitemoptions:entity:destroy:choice",a),b.commands.execute("addedcomponents:entity:destroyBySolutionPath",a.selectedSolutionPath)}),d.done(c.success),f&&d.resolve(a.toJSON()),d.promise()}},sync:function(a,b,c){return b.services[a.toLowerCase()].call(b,b,c)}}),h=b.Entities.Collection.extend({model:g,sync:function(a,b,c){return b.services[a.toLowerCase()].call(b,b,c)},services:{read:function(a,c){var d=e.Deferred(),f=b.db.added.choices().order("selectedSolutionPath asec").get();return d.done(c.success),d.resolve(f),d.promise()}}}),i={_getChoices:function(a){var b=new h;b.on("reset",a),b.fetch({reset:!0})},findAllByMeal:function(a){var b=e.Deferred();return this._getChoices(function(c){var d=c.where({mealid:a.id}),e=new h(d);b.resolve(e)}),b.promise()},findAllByListId:function(a){var b=e.Deferred();return this._getChoices(function(c){var d=c.where({mealid:a.get("mealid"),productCode:a.get("productCode")}),e=new h(d);b.resolve(e)}),b.promise()},update:function(a,c,d){var h=b.db.added.choices().filter({mealid:c.mealid,productCode:c.productCode}).first(),i=h.minQuantity,j=h.maxQuantity,k=c.selectedSolutionPath;d&&(k=k.substring(0,k.lastIndexOf("|")));var l=b.db.added.choices().filter({selectedSolutionPath:{leftnocase:k},mealid:{"===":c.mealid}}).get();f.each(l,f.bind(function(a){this._getChoices(function(b){var c=b.get(a.___id);c.destroy()})},this)),f.each(a,function(a){a.minQuantity=i,a.maxQuantity=j;var c=new g(a);c.save(),a.hasOwnProperty("choices")&&a.choices.length&&f.each(a.choices,function(b){for(var c=b.defaultQuantity,d={selectedSolutionCartName:b.defaultSolutionCartName,selectedSolutionCode:b.defaultSolutionCode,selectedSolutionPath:b.defaultSolutionPath,selectedQuantity:1},f=0;c>f;f++){var h=new g(e.extend(!0,b,{mealid:a.mealid},d));h.save()}}),a.hasOwnProperty("components")&&a.components.length&&f.each(a.components,function(c){c.mealid=a.mealid,b.commands.execute("addedcomponents:entity:insert",c)})})},insertByMeal:function(a){f.each(a.choices,function(b){b.mealid=a.___id;for(var c=b.selectedQuantity,d=0;c>d;d++){var f=new g(e.extend(!0,{},b,{selectedSolutionCode:b.defaultSolutionCode||b.selectedSolutionCode,selectedSolutionCartName:b.defaultSolutionCartName||b.selectedSolutionCartName,selectedSolutionPath:b.defaultSolutionPath||b.selectedSolutionPath}));f.save()}})},destroy:function(a){this._getChoices(function(b){var c=b.where({mealid:a}),d=new h(c);d.each(function(a){a.destroy()})})}};b.reqres.setHandlers({"addedchoices:entity:findAllByMeal":function(a){return i.findAllByMeal(a)},"addedchoices:entity:findAllByListId":function(a){return i.findAllByListId(a)}}),b.commands.setHandlers({"addedchoices:entity:update":function(a,b,c){i.update(a,b,c)},"addedchoices:entity:insertbymeal":function(a){i.insertByMeal(a)},"addedchoices:entity:destroy":function(a){i.destroy(a)}})}),Store.module("Entities",function(a,b,c,d,e,f){"use strict";var g=b.Entities.Model.extend({idAttribute:"___id",services:{create:function(a,c){var d=e.Deferred();d.done(function(a){b.commands.execute("customizableitemoptions:entity:insert:component",a)}),d.done(c.success);var f=b.db.added.components.insert(e.extend(!0,{},a.toJSON())).first();return d.resolve(f),d.promise()},read:function(a,c){var d=e.Deferred(),f=b.db.added.components(a.id).first();return d.done(c.success),d.resolve(f),d.promise()},update:function(a,c){var d=e.Deferred(),f=b.db.added.components(a.id).update(a.toJSON()).first();return d.done(function(a){b.commands.execute("customizableitemoptions:entity:destroy:component",a),b.commands.execute("customizableitemoptions:entity:insert:component",a)}),d.done(c.success),d.resolve(f),d.promise()},"delete":function(a,c){var d=e.Deferred(),f=b.db.added.components(a.id).remove();return d.done(function(a){b.commands.execute("customizableitemoptions:entity:destroy:component",a)}),d.done(c.success),f&&d.resolve(a.toJSON()),d.promise()}},sync:function(a,b,c){return b.services[a.toLowerCase()].call(b,b,c)}}),h=b.Entities.Collection.extend({model:g,sync:function(a,b,c){return b.services[a.toLowerCase()].call(b,b,c)},services:{read:function(a,c){var d=e.Deferred(),f=b.db.added.components().order("selectedSolutionPath asec").get();return d.done(c.success),d.resolve(f),d.promise()}}}),i={_getComponents:function(a){var b=new h;b.on("reset",a),b.fetch({reset:!0})},findAllByMeal:function(a){var b=e.Deferred();return this._getComponents(function(c){var d=c.where({mealid:a.id}),e=new h(d);b.resolve(e)}),b.promise()},insertByMeal:function(a){if(a.components.length||a.choices.length)f.each(a.components,function(b){b.mealid=a.___id;for(var c=b.selectedQuantity,d=0;c>d;d++){var f=new g(e.extend(!0,{},b));f.save()}});else{var b=new g({productCode:a.productCode,cartName:a.cartName,selectedSolutionPath:a.productCode,selectedQuantity:1,mealid:a.___id,included:a.included,addons:a.addons});b.save()}},insert:function(a){for(var b=a.selectedQuantity,c=0;b>c;c++){var d=new g(e.extend(!0,{},a));d.save()}},destroy:function(a){this._getComponents(function(b){var c=b.where({mealid:a}),d=new h(c);d.each(function(a){a.destroy()})})},destroyBySolutionPath:function(a){this._getComponents(function(b){var c=b.filter(function(b){return b.get("defaultSolutionPath")&&0==b.get("defaultSolutionPath").indexOf(a)}),d=new h(c);d.each(function(a){a.destroy()})})}};b.reqres.setHandlers({"addedcomponents:entity:findAllByMeal":function(a){return i.findAllByMeal(a)}}),b.commands.setHandlers({"addedcomponents:entity:insertbymeal":function(a){i.insertByMeal(a)},"addedcomponents:entity:insert":function(a){i.insert(a)},"addedcomponents:entity:destroy":function(a){i.destroy(a)},"addedcomponents:entity:destroyBySolutionPath":function(a){i.destroyBySolutionPath(a)}})}),Store.module("Entities",function(a,b,c,d,e,f,g,h){"use strict";var i,j=b.Entities.Model.extend({idAttribute:"___id",services:{create:function(a,c){var d=e.Deferred(),f=b.db.added.condiments.insert(e.extend(!0,{},a.toJSON())).first();return d.done(c.success),d.resolve(f),d.promise()},read:function(a,c){var d=e.Deferred(),f=b.db.added.condiments(a.id);return d.done(c.success),d.resolve(f),d.promise()},update:function(a,c){var d=e.Deferred(),f=b.db.added.condiments(a.id).update(a.toJSON()).first();return d.done(c.success),d.resolve(f),d.promise()},"delete":function(a,c){var d=e.Deferred(),f=b.db.added.condiments(a.id).remove();return f&&d.resolve(a.toJSON()),d.done(c.success),d.promise()}},sync:function(a,b,c){return b.services[a.toLowerCase()].call(b,b,c)}}),k=b.Entities.Collection.extend({model:j,services:{read:function(a,c){var d=e.Deferred(),f=b.db.added.condiments().get();return d.done(c.success),d.resolve(f),d.promise()}},sync:function(a,b,c){return b.services[a.toLowerCase()].call(b,b,c)}}),l={_getCondiments:function(a){var c=e.Deferred();return e.ajax(b.config.api.condiments.edit).done(function(c){var d=c.cartItems;b.commands.execute("addedcondiments:entity:reset"),e.when(b.request("availablecondiments:entity:findAll")).done(function(){f.each(d,function(a){var c=b.db.available.condiments().filter({productCode:a.productCode}).first();
delete c.___id;for(var d=e.extend(!0,{},c,a),f=0;f<a.selectedQuantity;f++){var g=e.extend(!0,{},d);g.selectedQuantity=1,i.create(g)}}),a.call(i,i)})}),c.promise()},findAll:function(){var a=e.Deferred();return this._getCondiments(function(){a.resolve(i)}),a.promise()},update:function(a,b){var c=a.unset("___id").toJSON();if(b>0)for(var d=0;b>d;d++)i.create(e.extend(!0,{},c));else{var g=i.where({productCode:a.get("productCode")}),h=f.last(g,Math.abs(b));f.each(h,function(a){a.destroy()})}},save:function(){var a=e.Deferred(),c={};c.status={refCartId:null,refProductCode:null};var d=f.map(i.toJSON(),function(a){return{productCode:a.productCode,selectedQuantity:1}});return c.condimentItems=d,b.config.debug&&(console.log("Saving: "),console.dir(c)),e.ajax(b.config.api.condiments.save,{data:JSON.stringify(c),type:"POST",dataType:"json",contentType:"application/json",complete:function(){a.resolve()}}),a.promise()},init:function(){b.db.added.condiments=h()},reset:function(){this.init(),i&&i.reset()}};a.addInitializer(function(){l.init(),i=new k(b.db.added.condiments().get())}),b.reqres.setHandlers({"addedcondiments:entity:findAll":function(){return l.findAll()},"addedcondiments:save":function(){return l.save()}}),b.commands.setHandlers({"addedcondiments:entity:update":function(a,b,c){l.update(a,b,c)},"addedcondiments:entity:init":function(){l.init()},"addedcondiments:entity:reset":function(){l.reset()}})},WOS,TAFFY),Store.module("Entities",function(a,b,c,d,e,f,g,h){"use strict";var i,j=b.Entities.Model.extend({idAttribute:"___id",sync:function(a,b,c){return b.services[a.toLowerCase()].call(b,b,c)},services:{create:function(a,c){var d=e.Deferred();d.done(function(a){b.commands.execute("addedchoices:entity:insertbymeal",a),b.commands.execute("addedcomponents:entity:insertbymeal",a)}),d.done(c.success);var f=b.db.added.meals.insert(e.extend(!0,{},a.toJSON())).first();return d.resolve(f),d.promise()},read:function(a,c){var d=e.Deferred(),f=b.db.added.meals(a.id);return d.done(c.success),d.resolve(f),d.promise()},update:function(a,c){var d=e.Deferred(),f=b.db.added.meals(a.id).update(a.toJSON()).first();return d.done(c.success),d.resolve(f),d.promise()},"delete":function(a,c){var d=e.Deferred(),f=b.db.added.meals(a.id).remove();return d.done(c.success),f&&(b.commands.execute("addedchoices:entity:destroy",{mealid:a.id}),b.commands.execute("addedcomponents:entity:destroy",{mealid:a.id}),d.resolve(a.toJSON())),d.promise()}}}),k=b.Entities.Collection.extend({model:j,sync:function(a,b,c){return b.services[a.toLowerCase()].call(b,b,c)},services:{read:function(a,c){var d=e.Deferred(),f=b.db.added.meals().get();return d.done(c.success),d.resolve(f),d.promise()}}}),l={_getMeals:function(a){var b=new k;b.on("reset",a),b.fetch({reset:!0})},_getMealsByCartId:function(a,c){e.ajax(b.config.api.cart.edit,{data:{cartId:a}}).done(function(a){e.when(b.request("availablemeals:entity:findOne",a.status.refProductCode)).then(function(d){var g=a.cartItems;f.each(g,function(a){var c=e.extend(!0,{},b.db.available.meals().filter({productCode:a.productCode}).first());delete c.___id,delete c.choices,delete c.components;for(var d=e.extend(!0,{},c,a),f=0;f<a.selectedQuantity;f++){var g=e.extend(!0,{},d);g.selectedQuantity=1,i.create(g)}}),c.call(i,i,d)})})},findAll:function(){var a=e.Deferred();return a.resolve(i),a.promise()},findAllByCartId:function(a){var b=e.Deferred();return this._getMealsByCartId(a,function(a,c){b.resolve(c,i)}),b.promise()},update:function(a,b){var c=a.unset("___id").toJSON();if(b>0)for(var d=0;b>d;d++)i.create(e.extend(!0,{},c));else{var g=i.where({productCode:a.get("productCode")}),h=f.last(g,Math.abs(b));f.each(h,function(a){a.destroy()})}},init:function(){b.db.added.meals=h(),b.db.added.choices=h(),b.db.added.components=h(),b.db.added.customization=h()},reset:function(){this.init(),i&&i.reset()}};a.addInitializer(function(){l.init(),i=new k,i.fetch()}),b.reqres.setHandlers({"addedmeals:entity:findAll":function(){return l.findAll()},"addedmeals:entity:findAllByCartId":function(a){return l.findAllByCartId(a)}}),b.commands.setHandlers({"addedmeals:entity:update":function(a,b,c){l.update(a,b,c)},"addedmeals:entity:init":function(){l.init()},"addedmeals:entity:reset":function(){l.reset()}})},WOS,TAFFY),Store.module("Entities",function(a,b,c,d,e,f){"use strict";var g=b.Entities.Model.extend({idAttribute:"___id",services:{create:function(a,c){var d=e.Deferred();d.done(function(a){b.commands.execute("customizablepromotionalitemoptions:entity:insert:choice",a)}),d.done(c.success);var f=b.db.added.promotionalChoices.insert(e.extend(!0,{},a.toJSON())).first();return d.resolve(f),d.promise()},read:function(a,c){var d=e.Deferred(),f=b.db.added.promotionalChoices(a.id).first();return d.done(c.success),d.resolve(f),d.promise()},update:function(a,c){var d=e.Deferred(),f=b.db.added.promotionalChoices(a.id).update(a.toJSON()).first();return d.done(function(a){b.commands.execute("customizablepromotionalitemoptions:entity:destroy:choice",a),b.commands.execute("customizablepromotionalitemoptions:entity:insert:choice",a)}),d.done(c.success),d.resolve(f),d.promise()},"delete":function(a,c){var d=e.Deferred(),f=b.db.added.promotionalChoices(a.id).remove();return d.done(function(a){b.commands.execute("customizablepromotionalitemoptions:entity:destroy:choice",a),b.commands.execute("addedpromotionalcomponents:entity:destroyBySolutionPath",a.selectedSolutionPath)}),d.done(c.success),f&&d.resolve(a.toJSON()),d.promise()}},sync:function(a,b,c){return b.services[a.toLowerCase()].call(b,b,c)}}),h=b.Entities.Collection.extend({model:g,sync:function(a,b,c){return b.services[a.toLowerCase()].call(b,b,c)},services:{read:function(a,c){var d=e.Deferred(),f=b.db.added.promotionalChoices().order("selectedSolutionPath asec").get();return d.done(c.success),d.resolve(f),d.promise()}}}),i={_getChoices:function(a){var b=new h;b.on("reset",a),b.fetch({reset:!0})},findAllByMeal:function(a){var b=e.Deferred();return this._getChoices(function(c){var d=c.where({mealid:a.id}),e=new h(d);b.resolve(e)}),b.promise()},findAllByListId:function(a){var b=e.Deferred();return this._getChoices(function(c){var d=c.where({mealid:a.get("mealid"),productCode:a.get("productCode")}),e=new h(d);b.resolve(e)}),b.promise()},update:function(a,c,d){var h=b.db.added.promotionalChoices().filter({mealid:c.mealid,productCode:c.productCode}).first(),i=h.minQuantity,j=h.maxQuantity,k=c.selectedSolutionPath;d&&(k=k.substring(0,k.lastIndexOf("|")));var l=b.db.added.promotionalChoices().filter({selectedSolutionPath:{leftnocase:k},mealid:{"===":c.mealid}}).get();f.each(l,f.bind(function(a){this._getChoices(function(b){var c=b.get(a.___id);c.destroy()})},this)),f.each(a,function(a){a.minQuantity=i,a.maxQuantity=j;var c=new g(a);c.save(),a.hasOwnProperty("choices")&&a.choices.length&&f.each(a.choices,function(b){for(var c=b.defaultQuantity,d={selectedSolutionCartName:b.defaultSolutionCartName,selectedSolutionCode:b.defaultSolutionCode,selectedSolutionPath:b.defaultSolutionPath,selectedQuantity:1},f=0;c>f;f++){var h=new g(e.extend(!0,b,{mealid:a.mealid},d));h.save()}}),a.hasOwnProperty("components")&&a.components.length&&f.each(a.components,function(c){c.mealid=a.mealid,b.commands.execute("addedpromotionalcomponents:entity:insert",c)})})},insertByMeal:function(a){f.each(a.choices,function(b){b.mealid=a.___id;for(var c=b.selectedQuantity,d=0;c>d;d++){var f=new g(e.extend(!0,{},b,{selectedSolutionCode:b.defaultSolutionCode||b.selectedSolutionCode,selectedSolutionCartName:b.defaultSolutionCartName||b.selectedSolutionCartName,selectedSolutionPath:b.defaultSolutionPath||b.selectedSolutionPath}));f.save()}})},destroy:function(a){this._getChoices(function(b){var c=b.where({mealid:a}),d=new h(c);d.each(function(a){a.destroy()})})}};b.reqres.setHandlers({"addedpromotionalchoices:entity:findAllByMeal":function(a){return i.findAllByMeal(a)},"addedpromotionalchoices:entity:findAllByListId":function(a){return i.findAllByListId(a)}}),b.commands.setHandlers({"addedpromotionalchoices:entity:update":function(a,b,c){i.update(a,b,c)},"addedpromotionalchoices:entity:insertbymeal":function(a){i.insertByMeal(a)},"addedpromotionalchoices:entity:destroy":function(a){i.destroy(a)}})}),Store.module("Entities",function(a,b,c,d,e,f){"use strict";var g=b.Entities.Model.extend({idAttribute:"___id",services:{create:function(a,c){var d=e.Deferred();d.done(function(a){b.commands.execute("customizablepromotionalitemoptions:entity:insert:component",a)}),d.done(c.success);var f=b.db.added.promotionalComponents.insert(e.extend(!0,{},a.toJSON())).first();return d.resolve(f),d.promise()},read:function(a,c){var d=e.Deferred(),f=b.db.added.promotionalComponents(a.id).first();return d.done(c.success),d.resolve(f),d.promise()},update:function(a,c){var d=e.Deferred(),f=b.db.added.promotionalComponents(a.id).update(a.toJSON()).first();return d.done(function(a){b.commands.execute("customizablepromotionalitemoptions:entity:destroy:component",a),b.commands.execute("customizablepromotionalitemoptions:entity:insert:component",a)}),d.done(c.success),d.resolve(f),d.promise()},"delete":function(a,c){var d=e.Deferred(),f=b.db.added.promotionalComponents(a.id).remove();return d.done(function(a){b.commands.execute("customizablepromotionalitemoptions:entity:destroy:component",a)}),d.done(c.success),f&&d.resolve(a.toJSON()),d.promise()}},sync:function(a,b,c){return b.services[a.toLowerCase()].call(b,b,c)}}),h=b.Entities.Collection.extend({model:g,sync:function(a,b,c){return b.services[a.toLowerCase()].call(b,b,c)},services:{read:function(a,c){var d=e.Deferred(),f=b.db.added.promotionalComponents().order("selectedSolutionPath asec").get();return d.done(c.success),d.resolve(f),d.promise()}}}),i={_getComponents:function(a){var b=new h;b.on("reset",a),b.fetch({reset:!0})},findAllByMeal:function(a){var b=e.Deferred();return this._getComponents(function(c){var d=c.where({mealid:a.id}),e=new h(d);b.resolve(e)}),b.promise()},insertByMeal:function(a){if(a.components.length||a.choices.length)f.each(a.components,function(b){b.mealid=a.___id;for(var c=b.selectedQuantity,d=0;c>d;d++){var f=new g(e.extend(!0,{},b));f.save()}});else{var b=new g({productCode:a.productCode,cartName:a.cartName,selectedSolutionPath:a.productCode,selectedQuantity:1,mealid:a.___id,included:a.included,addons:a.addons});b.save()}},insert:function(a){for(var b=a.selectedQuantity,c=0;b>c;c++){var d=new g(e.extend(!0,{},a));d.save()}},destroy:function(a){this._getComponents(function(b){var c=b.where({mealid:a}),d=new h(c);d.each(function(a){a.destroy()})})},destroyBySolutionPath:function(a){this._getComponents(function(b){var c=b.filter(function(b){return b.get("defaultSolutionPath")&&0==b.get("defaultSolutionPath").indexOf(a)}),d=new h(c);d.each(function(a){a.destroy()})})}};b.reqres.setHandlers({"addedpromotionalcomponents:entity:findAllByMeal":function(a){return i.findAllByMeal(a)}}),b.commands.setHandlers({"addedpromotionalcomponents:entity:insertbymeal":function(a){i.insertByMeal(a)},"addedpromotionalcomponents:entity:insert":function(a){i.insert(a)},"addedpromotionalcomponents:entity:destroy":function(a){i.destroy(a)},"addedpromotionalcomponents:entity:destroyBySolutionPath":function(a){i.destroyBySolutionPath(a)}})}),Store.module("Entities",function(a,b,c,d,e,f,g,h){"use strict";var i,j=b.Entities.Model.extend({idAttribute:"___id",sync:function(a,b,c){return b.services[a.toLowerCase()].call(b,b,c)},services:{create:function(a,c){var d=e.Deferred();d.done(function(a){b.commands.execute("addedpromotionalchoices:entity:insertbymeal",a),b.commands.execute("addedpromotionalcomponents:entity:insertbymeal",a)}),d.done(c.success);var f=b.db.added.promotionalItems.insert(e.extend(!0,{},a.toJSON())).first();return d.resolve(f),d.promise()},read:function(a,c){var d=e.Deferred(),f=b.db.added.promotionalItems(a.id);return d.done(c.success),d.resolve(f),d.promise()},update:function(a,c){var d=e.Deferred(),f=b.db.added.promotionalItems(a.id).update(a.toJSON()).first();return d.done(c.success),d.resolve(f),d.promise()},"delete":function(a,c){var d=e.Deferred(),f=b.db.added.promotionalItems(a.id).remove();return d.done(c.success),f&&(b.commands.execute("addedpromotionalchoices:entity:destroy",{mealid:a.id}),b.commands.execute("addedpromotionalcomponents:entity:destroy",{mealid:a.id}),d.resolve(a.toJSON())),d.promise()}}}),k=b.Entities.Collection.extend({model:j,sync:function(a,b,c){return b.services[a.toLowerCase()].call(b,b,c)},services:{read:function(a,c){var d=e.Deferred(),f=b.db.added.promotionalItems().get();return d.done(c.success),d.resolve(f),d.promise()}}}),l={_getMealsByCartId:function(a,c){e.ajax(b.config.api.promotion.edit,{data:{cartId:a}}).done(function(a){e.when(b.request("availablepromotionalitems:entity:findAll",a.status.promoId)).then(function(d){var g=a.cartItems;f.each(g,function(a){var c=e.extend(!0,{},b.db.available.promotionalItems().filter({productCode:a.productCode}).first());delete c.___id,delete c.choices,delete c.components;var d=i.where({productCode:a.productCode}),f=d.length;if(0==f){var g=e.extend(!0,{},c,a),h=e.extend(!0,{},g);i.create(h)}else{var j=i.get(d[0].id);j.set("selectedQuantity",j.get("selectedQuantity")+a.selectedQuantity),j.save()}}),c.call(i,i,d,a.status.selectCount,a.status.promoId)})})},update:function(a,b,c){var d=a.unset("___id").toJSON(),g=i.where({productCode:a.get("productCode")}),h=g.length;if(b>0)if(0==h)d.selectedQuantity=c,i.create(e.extend(!0,{},d));else{var j=i.get(g[0].id);j.set("selectedQuantity",c),j.save()}else if(0==c){var g=i.where({productCode:a.get("productCode")}),k=f.last(g,Math.abs(b));f.each(k,function(a){a.destroy()})}else{var j=i.get(g[0].id);j.set("selectedQuantity",c),j.save()}},findAll:function(){var a=e.Deferred();return a.resolve(i),a.promise()},findAllByCartId:function(a){var b=e.Deferred();return this._getMealsByCartId(a,function(a,c,d,e){var f=[c,d,e];b.resolve(f,i)}),b.promise()},init:function(){b.db.added.promotionalItems=h(),b.db.added.promotionalChoices=h(),b.db.added.promotionalComponents=h(),b.db.added.promotionalCustomization=h()},reset:function(){this.init(),i&&i.reset()}};a.addInitializer(function(){l.init(),i=new k,i.fetch()}),b.reqres.setHandlers({"addedpromotionalitems:entity:findAll":function(){return l.findAll()},"addedpromotionalitems:entity:findAllByCartId":function(a){return l.findAllByCartId(a)}}),b.commands.setHandlers({"addedpromotionalitems:entity:update":function(a,b,c){l.update(a,b,c)},"addedpromotionalitems:entity:init":function(){l.init()},"addedpromotionalitems:entity:reset":function(){l.reset()}})},WOS,TAFFY),Store.module("Entities",function(a,b,c,d,e,f,g,h){"use strict";var i,j=b.Entities.Model.extend({idAttribute:"___id",services:{create:function(a,c){var d=e.Deferred(),f=b.db.added.upsells.insert(e.extend(!0,{},a.toJSON())).first();return d.done(c.success),d.resolve(f),d.promise()},read:function(a,c){var d=e.Deferred(),f=b.db.added.upsells(a.id);return d.done(c.success),d.resolve(f),d.promise()},update:function(a,c){var d=e.Deferred(),f=b.db.added.upsells(a.id).update(a.toJSON()).first();return d.done(c.success),d.resolve(f),d.promise()},"delete":function(a,c){{var d=e.Deferred();b.db.added.upsells(a.id).remove()}return d.done(c.success),d.resolve(a.toJSON()),d.promise()}},sync:function(a,b,c){return b.services[a.toLowerCase()].call(b,b,c)}}),k=b.Entities.Collection.extend({model:j,services:{read:function(a,c){var d=e.Deferred(),f=new k(b.db.added.upsells().get());return d.done(c.success),d.resolve(f),d.promise()}},sync:function(a,b,c){return b.services[a.toLowerCase()].call(b,b,c)}}),l={findAll:function(){var a=e.Deferred();return a.resolve(i),a.promise()},update:function(a,b){var c=a.unset("___id").toJSON();if(b>0)for(var d=0;b>d;d++)i.create(e.extend(!0,{},c));else{var g=i.where({productCode:a.get("productCode")}),h=f.last(g,Math.abs(b));f.each(h,function(a){a.destroy()})}},init:function(){b.db.added.upsells=h()},reset:function(){this.init(),i.reset()}};a.addInitializer(function(){l.init(),i=new k(b.db.added.upsells().get())}),b.reqres.setHandlers({"addedupsells:entity:findAll":function(){return l.findAll()}}),b.commands.setHandlers({"addedupsells:entity:update":function(a,b,c){l.update(a,b,c)},"addedupsells:entity:init":function(){l.init()},"addedupsells:entity:reset":function(){l.reset()}})},WOS,TAFFY),Store.module("Entities",function(a,b,c,d,e,f,g,h){"use strict";var i=b.Entities.Model.extend({idAttribute:"productCode"}),j=b.Entities.Collection.extend({model:i}),k={findAll:function(a){var c=e.Deferred(),d=a.get("productCode"),g=a.get("selectedSolutionPath");return e.ajax(b.config.api.availableChoices.findAll,{data:{solutionPath:g}}).then(function(a){var b=a.products,e={noSelection:a.noSelection,displayType:a.displayType},g=f.map(b,function(a){return a.listid=d,a}),h=new j(g);c.resolve(h,e)}),c.promise()},init:function(){b.db.available.choices=h()},reset:function(){this.init()}};b.reqres.setHandlers({"availablechoices:entity:findAll":function(a){return k.findAll(a)}}),b.commands.setHandlers({"availablechoices:entity:init":function(){k.init()},"availablechoices:entity:reset":function(){k.reset()}})},WOS,TAFFY),Store.module("Entities",function(a,b,c,d,e,f,g,h){"use strict";var i=b.Entities.Model.extend({idAttribute:"productCode"}),j=b.Entities.Collection.extend({model:i,sync:function(a,b,c){return b.services[a.toLowerCase()].call(b,b,c)},services:{read:function(a,c){var d=e.Deferred(),f=b.db.available.condiments().get();return d.done(c.success),d.resolve(f),d.promise()}}}),k={_getCondiments:function(){var a=e.Deferred(),c=!!b.db.available.condiments().count();return c?a.resolve(b.db.available.condiments().get()):e.ajax(b.config.api.condiments.findAll).done(function(c){var d=c.products;b.db.available.condiments.insert(d),a.resolve(d)}),a.promise()},findAll:function(){var a=e.Deferred();return this._getCondiments().done(function(b){var c=new j(b);a.resolve(c)}),a.promise()},init:function(){b.db.available.condiments=h()},reset:function(){this.init()}};b.reqres.setHandlers({"availablecondiments:entity:findAll":function(a){return k.findAll(a)}}),b.commands.setHandlers({"availablecondiments:entity:init":function(){k.init()},"availablecondiments:entity:reset":function(){k.reset()}})},WOS,TAFFY),Store.module("Entities",function(a,b,c,d,e,f,g,h){"use strict";var i=b.Entities.Model.extend({idAttribute:"productCode"}),j=b.Entities.Collection.extend({model:i,sync:function(a,b,c){return b.services[a.toLowerCase()].call(b,b,c)},services:{read:function(a,c){var d=e.Deferred(),f=b.db.available.meals().get();return d.done(c.success),d.resolve(f),d.promise()}}}),k={_getMeals:function(a){var c=e.Deferred(),d=!!b.db.available.meals().filter({productCode:a}).count();return d?c.resolve(b.db.available.meals().get()):e.ajax(b.config.api.availableMeals.findAll,{data:{productCode:a}}).done(function(d){var g=d.products;f.each(g,function(b){var c=[],d=[];f.each(b.choices,function(b){b.mealid=a,b.selectedSolutionCode=b.defaultSolutionCode,b.selectedSolutionCartName=b.defaultSolutionCartName,b.selectedSolutionPath=b.defaultSolutionPath,b.selectedQuantity=1;var d=b.defaultQuantity;delete b.defaultQuantity,delete b.defaultSolutionCode,delete b.defaultSolutionCartName,delete b.defaultSolutionPath;for(var f=0;d>f;f++)c.push(e.extend({},b))}),f.each(b.components,function(b){b.mealid=a,b.selectedQuantity=1;var c=b.defaultQuantity;delete b.defaultQuantity;for(var f=0;c>f;f++)d.push(e.extend({},b))}),b.choices=c,b.components=d}),b.db.available.meals.insert(g),c.resolve(g)}),c.promise()},findOne:function(a){var b=e.Deferred();return this.findAll(a).done(function(c){var d=c.findWhere({productCode:a});b.resolve(d)}),b.promise()},findAll:function(a){var b=e.Deferred();return this._getMeals(a).done(function(a){var c=new j(a);b.resolve(c)}),b.promise()},init:function(){b.db.available.meals=h(),b.db.available.defaultChoices=h(),b.db.available.defaultComponents=h()},reset:function(){this.init()}};b.reqres.setHandlers({"availablemeals:entity:findOne":function(a){return k.findOne(a)},"availablemeals:entity:findAll":function(a){return k.findAll(a)}}),b.commands.setHandlers({"availablemeals:entity:init":function(){k.init()},"availablemeals:entity:reset":function(){k.reset()}})},WOS,TAFFY),Store.module("Entities",function(a,b,c,d,e,f){"use strict";var g=b.Entities.Model.extend({idAttribute:"productCode"}),h=b.Entities.Collection.extend({model:g,sync:function(a,b,c){return b.services[a.toLowerCase()].call(b,b,c)},services:{read:function(a,c){var d=e.Deferred(),f=b.db.available.promotionalItems().get();return d.done(c.success),d.resolve(f),d.promise()}}}),i=0,j=0,k={_getMeals:function(a,c){var d,g=(e.Deferred(),!!b.db.available.promotionalItems().count());g?(d=b.db.available.promotionalItems().get(),c.call(d,d,i,j)):e.ajax(b.config.api.promotion.findAll,{data:{promoId:a}}).done(function(a){i=a.status.selectCount,j=a.status.promoId,d=a.products,f.each(d,function(a){var b=[],c=[];f.each(a.choices,function(a){a.mealid=a.productCode,a.selectedSolutionCode=a.defaultSolutionCode,a.selectedSolutionCartName=a.defaultSolutionCartName,a.selectedSolutionPath=a.defaultSolutionPath,a.selectedQuantity=1;var c=a.defaultQuantity;delete a.defaultQuantity,delete a.defaultSolutionCode,delete a.defaultSolutionCartName,delete a.defaultSolutionPath;for(var d=0;c>d;d++)b.push(e.extend({},a))}),f.each(a.components,function(a){a.mealid=a.productCode,a.selectedQuantity=1;var b=a.defaultQuantity;delete a.defaultQuantity;for(var d=0;b>d;d++)c.push(e.extend({},a))}),a.choices=b,a.components=c}),b.db.available.promotionalItems.insert(d),c.call(d,d,i,j)})},findAll:function(a){var b=e.Deferred();return this._getMeals(a,function(a,c,d){var e=new h(a);b.resolve(e,c,d)}),b.promise()},init:function(){b.db.available.promotionalItems=TAFFY()},reset:function(){this.init()}};a.addInitializer(function(){k.init()}),b.reqres.setHandlers({"availablepromotionalitems:entity:findAll":function(a){return k.findAll(a)}}),b.commands.setHandlers({"availablepromotionalitems:entity:init":function(){k.init()},"availablepromotionalitems:entity:reset":function(){k.reset()}})}),Store.module("Entities",function(a,b,c,d,e,f,g,h){"use strict";var i=b.Entities.Model.extend({idAttribute:"productCode"}),j=b.Entities.Collection.extend({model:i,sync:function(a,b,c){return b.services[a.toLowerCase()].call(b,b,c)},services:{read:function(a,c){var d=e.Deferred(),f=b.db.available.upsells().get();return d.done(c.success),d.resolve(f),d.promise()}}}),k={_getUpsells:function(a){var c=e.Deferred();return e.ajax(b.config.api.availableUpsells.findAll,{data:{productCode:a}}).done(function(a){var d=a.products;b.db.available.upsells.insert(d),c.resolve(d)}),c.promise()},findAll:function(a){var b=e.Deferred();return this._getUpsells(a).done(function(a){var c=new j(a);b.resolve(c)}),b.promise()},init:function(){b.db.available.upsells=h()},reset:function(){this.init()}};b.reqres.setHandlers({"availableupsells:entity:findAll":function(a){return k.findAll(a)}}),b.commands.setHandlers({"availableupsells:entity:init":function(){k.init()},"availableupsells:entity:reset":function(){k.reset()}})},WOS,TAFFY),Store.module("Entities",function(a,b,c,d,e,f){"use strict";b.reqres.setHandlers({"cart:save":function(a,c){var d=e.Deferred();return e.when(b.request("addedmeals:entity:findAll"),b.request("addedupsells:entity:findAll")).done(function(g,h){var i={status:{refCartId:a,refProductCode:c},cartItems:[],upsellItems:[]},j=g.toJSON();f.each(j,function(a){var c={productCode:a.productCode,choices:[],components:[],included:[],addons:[],solutionPath:a.solutionPath};if(a.choices.length||a.components.length){var d=b.db.added.choices().filter({mealid:a.___id}).get();f.each(d,function(a){var d={productCode:a.productCode,maxQuantity:a.maxQuantity,minQuantity:a.minQuantity,selectedQuantity:a.selectedQuantity,selectedSolutionCode:a.selectedSolutionCode,selectedSolutionPath:a.selectedSolutionPath,included:[],addons:[]},e=b.db.added.customization().filter({mealitemid:["choice",a.___id].join("_"),mealitemtype:"choice",optiongroup:"included"}).get();f.each(e,function(a){var b={name:a.name,selected:a.selected};d.included.push(b)});var g=b.db.added.customization().filter({mealitemid:["choice",a.___id].join("_"),mealitemtype:"choice",optiongroup:"addons"}).get();f.each(g,function(a){var b={name:a.name,selected:a.selected};d.addons.push(b)}),c.choices.push(d)});var e=b.db.added.components().filter({mealid:a.___id}).get();f.each(e,function(a){var d={productCode:a.productCode,selectedQuantity:a.selectedQuantity,selectedSolutionPath:a.selectedSolutionPath,included:[],addons:[]},e=b.db.added.customization().filter({mealitemid:["component",a.___id].join("_"),mealitemtype:"component",optiongroup:"included"}).get();f.each(e,function(a){var b={name:a.name,selected:a.selected};d.included.push(b)});var g=b.db.added.customization().filter({mealitemid:["component",a.___id].join("_"),mealitemtype:"component",optiongroup:"addons"}).get();f.each(g,function(a){var b={name:a.name,selected:a.selected};d.addons.push(b)}),c.components.push(d)})}else{var g=b.db.added.components().filter({mealid:a.___id}).first(),h=b.db.added.customization().filter({mealitemid:["component",g.___id].join("_"),mealitemtype:"component",optiongroup:"included"}).get();f.each(h,function(a){var b={name:a.name,selected:a.selected};c.included.push(b)});var j=b.db.added.customization().filter({mealitemid:["component",g.___id].join("_"),mealitemtype:"component",optiongroup:"addons"}).get();f.each(j,function(a){var b={name:a.name,selected:a.selected};c.addons.push(b)})}i.cartItems.push(c)});var k=h.toJSON();f.each(k,function(a){var b={productCode:a.productCode};i.upsellItems.push(b)}),b.config.debug&&(console.log("Saving: "),console.dir(i)),e.ajax(b.config.api.cart.save,{data:JSON.stringify(i),type:"POST",dataType:"json",contentType:"application/json",complete:function(){d.resolve()}})}),d.promise()}})},WOS,TAFFY),Store.module("Entities",function(a,b,c,d,e,f){"use strict";var g=b.Entities.Model.extend({idAttribute:"___id",sync:function(a,b,c){return b.services[a.toLowerCase()].call(b,b,c)},services:{create:function(a,c){var d=e.Deferred(),f=b.db.added.customization.insert(e.extend(!0,{},a.toJSON())).first();return d.done(c.success),d.resolve(f),d.promise()},read:function(a,c){var d=e.Deferred(),f=b.db.added.customization(a.id).first();return d.done(c.success),d.resolve(f),d.promise()},update:function(a,c){var d=e.Deferred(),f=b.db.added.customization(a.id).update(a.toJSON()).first();return d.done(c.success),d.resolve(f),d.promise()},"delete":function(a,c){var d=e.Deferred(),f=b.db.added.customization(a.id).remove();return d.done(c.success),f&&d.resolve(a.toJSON()),d.promise()}}}),h=b.Entities.Collection.extend({model:g,sync:function(a,b,c){return b.services[a.toLowerCase()].call(b,b,c)},services:{read:function(a,c){var d=e.Deferred(),f=b.db.added.customization().get();return d.done(c.success),d.resolve(f),d.promise()}}}),i={_getItems:function(a){var b=new h;b.on("reset",a),b.fetch({reset:!0})},findAllByMealItem:function(a){var b=e.Deferred();return this._getItems(function(c){var d=c.where({mealitemid:a.id,mealitemtype:a.get("type"),optiongroup:"included"}),e=c.where({mealitemid:a.id,mealitemtype:a.get("type"),optiongroup:"addons"}),f=new h(d),g=new h(e);b.resolve(f,g)}),b.promise()},insert:function(a,b){f.each(b.included,function(c){var d=e.extend(!0,{},{mealitemid:[a,b.___id].join("_"),mealitemtype:a,optiongroup:"included"},c),f=new g(d);f.save()}),f.each(b.addons,function(c){var d=e.extend(!0,{},{mealitemid:[a,b.___id].join("_"),mealitemtype:a,optiongroup:"addons"},c),f=new g(d);f.save()})},destroy:function(a,c){b.db.added.customization().filter({mealitemid:[a,c.___id].join("_"),mealitemtype:a}).remove()}};b.reqres.setHandlers({"customizableitemoptions:entity:findAllByMealItem":function(a){return i.findAllByMealItem(a)}}),b.commands.setHandlers({"customizableitemoptions:entity:insert:component":function(a){i.insert("component",a)},"customizableitemoptions:entity:insert:choice":function(a){i.insert("choice",a)},"customizableitemoptions:entity:destroy:component":function(a){i.destroy("component",a)},"customizableitemoptions:entity:destroy:choice":function(a){i.destroy("choice",a)}})},WOS,TAFFY),Store.module("Entities",function(a,b,c,d,e,f){"use strict";var g=b.Entities.Model.extend({idAttribute:"itemid",sync:function(a,b,c){return b.services[a.toLowerCase()].call(b,b,c)},services:{create:function(){},read:function(){},update:function(){},"delete":function(){}}}),h=b.Entities.Collection.extend({model:g}),i={findAll:function(a){var c=e.Deferred();return e.when(b.request("addedcomponents:entity:findAllByMeal",a),b.request("addedchoices:entity:findAllByMeal",a)).then(function(a,b){var d=f.filter(a.toJSON(),function(a){return a.addons.length||a.included.length}),g=f.filter(b.toJSON(),function(a){return a.addons.length||a.included.length}),i=f.map(d,function(a){return{itemid:"component_"+a.___id,addons:a.addons,included:a.included,mealid:a.mealid,productCode:a.productCode,cartName:a.cartName,type:"component"}}),j=f.map(g,function(a){return{itemid:"choice_"+a.___id,addons:a.addons,included:a.included,mealid:a.mealid,productCode:a.selectedSolutionCode,cartName:a.selectedSolutionCartName,type:"choice"}}),k=e.merge(e.merge([],i),j),l=new h(k);c.resolve(l)}),c.promise()}};b.reqres.setHandlers({"customizableitems:entity:findAllByMeal":function(a){return i.findAll(a)}})},WOS,TAFFY),Store.module("Entities",function(a,b,c,d,e,f){"use strict";var g=b.Entities.Model.extend({idAttribute:"___id",sync:function(a,b,c){return b.services[a.toLowerCase()].call(b,b,c)},services:{create:function(a,c){var d=e.Deferred(),f=b.db.added.promotionalCustomization.insert(e.extend(!0,{},a.toJSON())).first();return d.done(c.success),d.resolve(f),d.promise()},read:function(a,c){var d=e.Deferred(),f=b.db.added.promotionalCustomization(a.id).first();return d.done(c.success),d.resolve(f),d.promise()},update:function(a,c){var d=e.Deferred(),f=b.db.added.promotionalCustomization(a.id).update(a.toJSON()).first();return d.done(c.success),d.resolve(f),d.promise()},"delete":function(a,c){var d=e.Deferred(),f=b.db.added.promotionalCustomization(a.id).remove();return d.done(c.success),f&&d.resolve(a.toJSON()),d.promise()}}}),h=b.Entities.Collection.extend({model:g,sync:function(a,b,c){return b.services[a.toLowerCase()].call(b,b,c)},services:{read:function(a,c){var d=e.Deferred(),f=b.db.added.promotionalCustomization().get();return d.done(c.success),d.resolve(f),d.promise()}}}),i={_getItems:function(a){var b=new h;b.on("reset",a),b.fetch({reset:!0})},findAllByMealItem:function(a){var b=e.Deferred();return this._getItems(function(c){var d=c.where({mealitemid:a.id,mealitemtype:a.get("type"),optiongroup:"included"}),e=c.where({mealitemid:a.id,mealitemtype:a.get("type"),optiongroup:"addons"}),f=new h(d),g=new h(e);b.resolve(f,g)}),b.promise()},insert:function(a,b){f.each(b.included,function(c){var d=e.extend(!0,{},{mealitemid:[a,b.___id].join("_"),mealitemtype:a,optiongroup:"included"},c),f=new g(d);f.save()}),f.each(b.addons,function(c){var d=e.extend(!0,{},{mealitemid:[a,b.___id].join("_"),mealitemtype:a,optiongroup:"addons"},c),f=new g(d);f.save()})},destroy:function(a,c){b.db.added.promotionalCustomization().filter({mealitemid:[a,c.___id].join("_"),mealitemtype:a}).remove()}};b.reqres.setHandlers({"customizablepromotionalitemoptions:entity:findAllByMealItem":function(a){return i.findAllByMealItem(a)}}),b.commands.setHandlers({"customizablepromotionalitemoptions:entity:insert:component":function(a){i.insert("component",a)},"customizablepromotionalitemoptions:entity:insert:choice":function(a){i.insert("choice",a)},"customizablepromotionalitemoptions:entity:destroy:component":function(a){i.destroy("component",a)},"customizablepromotionalitemoptions:entity:destroy:choice":function(a){i.destroy("choice",a)}})},WOS,TAFFY),Store.module("Entities",function(a,b,c,d,e,f){"use strict";var g=b.Entities.Model.extend({idAttribute:"itemid",sync:function(a,b,c){return b.services[a.toLowerCase()].call(b,b,c)
},services:{create:function(){},read:function(){},update:function(){},"delete":function(){}}}),h=b.Entities.Collection.extend({model:g}),i={findAll:function(a){var c=e.Deferred();return e.when(b.request("addedpromotionalcomponents:entity:findAllByMeal",a),b.request("addedpromotionalchoices:entity:findAllByMeal",a)).then(function(a,b){var d=f.filter(a.toJSON(),function(a){return a.addons.length||a.included.length}),g=f.filter(b.toJSON(),function(a){return a.addons.length||a.included.length}),i=f.map(d,function(a){return{itemid:"component_"+a.___id,addons:a.addons,included:a.included,mealid:a.mealid,productCode:a.productCode,cartName:a.cartName,type:"component"}}),j=f.map(g,function(a){return{itemid:"choice_"+a.___id,addons:a.addons,included:a.included,mealid:a.mealid,productCode:a.selectedSolutionCode,cartName:a.selectedSolutionCartName,type:"choice"}}),k=e.merge(e.merge([],i),j),l=new h(k);c.resolve(l)}),c.promise()}};b.reqres.setHandlers({"customizablepromotionalitems:entity:findAllByMeal":function(a){return i.findAll(a)}})},WOS,TAFFY),Store.module("Entities",function(a,b,c,d,e,f){"use strict";b.reqres.setHandlers({"promotionalcart:save":function(a,c){var d=e.Deferred();return e.when(b.request("addedpromotionalitems:entity:findAll")).done(function(g){var h={status:{refCartId:a,promoId:c},cartItems:[]},i=g.toJSON();f.each(i,function(a){var c={productCode:a.productCode,choices:[],components:[],included:[],addons:[],promoType:a.promoType,originalPlu:a.originalPlu,rewardId:a.rewardId,solutionPath:a.solutionPath};if(a.choices.length||a.components.length){var d=b.db.added.promotionalChoices().filter({mealid:a.___id}).get();f.each(d,function(a){var d={productCode:a.productCode,maxQuantity:a.maxQuantity,minQuantity:a.minQuantity,selectedQuantity:a.selectedQuantity,selectedSolutionCode:a.selectedSolutionCode,selectedSolutionPath:a.selectedSolutionPath,included:[],addons:[]},e=b.db.added.promotionalCustomization().filter({mealitemid:["choice",a.___id].join("_"),mealitemtype:"choice",optiongroup:"included"}).get();f.each(e,function(a){var b={name:a.name,selected:a.selected};d.included.push(b)});var g=b.db.added.promotionalCustomization().filter({mealitemid:["choice",a.___id].join("_"),mealitemtype:"choice",optiongroup:"addons"}).get();f.each(g,function(a){var b={name:a.name,selected:a.selected};d.addons.push(b)}),c.choices.push(d)});var e=b.db.added.promotionalComponents().filter({mealid:a.___id}).get();f.each(e,function(a){var d={productCode:a.productCode,selectedQuantity:a.selectedQuantity,selectedSolutionPath:a.selectedSolutionPath,included:[],addons:[]},e=b.db.added.promotionalCustomization().filter({mealitemid:["component",a.___id].join("_"),mealitemtype:"component",optiongroup:"included"}).get();f.each(e,function(a){var b={name:a.name,selected:a.selected};d.included.push(b)});var g=b.db.added.promotionalCustomization().filter({mealitemid:["component",a.___id].join("_"),mealitemtype:"component",optiongroup:"addons"}).get();f.each(g,function(a){var b={name:a.name,selected:a.selected};d.addons.push(b)}),c.components.push(d)})}else{var g=b.db.added.promotionalComponents().filter({mealid:a.___id}).first(),i=b.db.added.promotionalCustomization().filter({mealitemid:["component",g.___id].join("_"),mealitemtype:"component",optiongroup:"included"}).get();f.each(i,function(a){var b={name:a.name,selected:a.selected};c.included.push(b)});var j=b.db.added.promotionalCustomization().filter({mealitemid:["component",g.___id].join("_"),mealitemtype:"component",optiongroup:"addons"}).get();f.each(j,function(a){var b={name:a.name,selected:a.selected};c.addons.push(b)})}for(var k=0;k<a.selectedQuantity;k++)h.cartItems.push(c)}),b.config.debug&&(console.log("Saving: "),console.dir(h)),e.ajax(b.config.api.promotion.save,{data:JSON.stringify(h),type:"POST",dataType:"json",contentType:"application/json",complete:function(){d.resolve()}})}),d.promise()}})},WOS,TAFFY);